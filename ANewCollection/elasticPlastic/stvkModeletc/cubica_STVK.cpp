/*
This file is part of Cubica.
 
Cubica is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

Cubica is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with Cubica.  If not, see <http://www.gnu.org/licenses/>.
*/
// STVK.cpp: implementation of the STVK class.
//
//////////////////////////////////////////////////////////////////////

#include "STVK.h"

//////////////////////////////////////////////////////////////////////
// Constructor for STVK
//////////////////////////////////////////////////////////////////////
STVK::STVK(Real lambda, Real mu) :
  _lambda(lambda), _mu(mu),
  // work arrays
  _pf_pF(12,9),
  _pF_pu(9,12)
{
  _materialName.assign("STVK");
}

//////////////////////////////////////////////////////////////////////
// make a copy
//////////////////////////////////////////////////////////////////////
MATERIAL* STVK::copy()
{
  MATERIAL* material = new STVK(_lambda, _mu);
  return material;
}

//////////////////////////////////////////////////////////////////////
// stiffness matrix implementation
//
// The Matlab code to generate the code is below. This is the only
// material model where the derivative wrt u can be done explicitly.
// The other materials make Maple run out of memory, so the derivative
// wrt F must be taken chain rule with DF/Du used to convert it wrt u.
//
// see "MATERIAL.h" for more details
/*
 lam = sym('lam');
 mu = sym('mu');
 % pre-computed area vectors
 syms b00 b01 b02 b10 b11 b12 b20 b21 b22 b30 b31 b32;
 b = [ b00 b10 b20 b30
     b01 b11 b21 b31
     b02 b12 b22 b32 ];
 % output formulas for stiffness matrices, for a single tet
 a = sym('a'); w = sym('b'); c = sym('c');
 d = sym('d'); e = sym('e'); f = sym('f');
 g = sym('g'); h = sym('h'); i = sym('i');
 j = sym('j'); k = sym('k'); l = sym('l');
 m = sym('m'); n = sym('n'); o = sym('o');
 p = sym('p'); q = sym('q'); r = sym('r');
 s = sym('s'); t = sym('t'); v = sym('u');    
 n0 = [a w c];
 n1 = [d e f];
 n2 = [g h i];
 n3 = [j k l];
 u = mytrans([a w c d e f g h i j k l]);
 x = mytrans([
     n1-n0
     n2-n0
     n3-n0
     ]);
 Xinv = [
     m n o
     p q r
     s t v
     ];
 F = x * Xinv;
 C = mytrans(F)*F;
 I = eye(3);
 E = 0.5 * (C - I);
 S = lam*trace(E)*I + 2*mu*E;    % 2nd PK
 P = F * S;  % 1st PK
 forces = P * b; % 3x4
 forces = reshape(forces, 12, 1);
 % differentiate to get stiffness
 stiffness = mu * ones(12,12);
 for i = 1:12
     for j = 1:12
         stiffness(i,j) = diff( forces(i), u(j) );
     end
 end
 maple('codegen[C]', stiffness, 'optimized')
*/
//////////////////////////////////////////////////////////////////////
MATRIX STVK::stiffness(TET& tet, bool diagonal)
{
  computeStresses(tet);
  computePFPu(tet, _pF_pu);
  MATRIX product = _pf_pF * _pF_pu;
  return product;
}

//////////////////////////////////////////////////////////////////////
// implementation of second PK stress tensor
//////////////////////////////////////////////////////////////////////
MATRIX3 STVK::secondPiolaKirchhoff(MATRIX3& F, bool diagonal)
{
	MATRIX3 C = F.transpose() * F;

	// Green-Lagrange strain tensor
	MATRIX3 E = 0.5 * (C - MATRIX3::I());

   // 2nd Piola-Kirchoff stress tensor
	MATRIX3 S = (_lambda * trace(E) * MATRIX3::I()) + (2 * _mu * E);	

	return S;
}

//////////////////////////////////////////////////////////////////////
// autogenerated as "forceDensity" from:
//
// setup_symbols_wrt_u;
// syms lam mu;
// strain_energy = 0.5*lam*trace(E)^2 + mu*dblcon(E,E);
// Rd_sym = sym('DUMMY_TEMP')*ones(1,12);
// for i = 1:12
//   Rd_sym(1,i) = - diff( strain_energy, u(i));
// end
// forceDensity = maple('codegen[C]', Rd_sym, 'optimized')
//
// see "MATERIAL.h" for more details
//////////////////////////////////////////////////////////////////////
/*
void STVK::forceDensity(TET& tet, const VEC3F* forces)
{
  VEC3F** verts = tet.vertices;
  VEC3F nodes[] = {*verts[0], *verts[1], *verts[2], *verts[3]}; 
  const double a = nodes[0][0];
	const double b = nodes[0][1];
	const double c = nodes[0][2];
	const double d = nodes[1][0];
	const double e = nodes[1][1];
	const double f = nodes[1][2];
	const double g = nodes[2][0];
	const double h = nodes[2][1];
	const double i = nodes[2][2];
	const double j = nodes[3][0];
	const double k = nodes[3][1];
	const double l = nodes[3][2];

  const MATRIX3 matInv = tet.DmInv();
	const double m = matInv(0,0);
	const double n = matInv(0,1);
	const double o = matInv(0,2);
	const double p = matInv(1,0);
	const double q = matInv(1,1);
	const double r = matInv(1,2);
	const double s = matInv(2,0);
	const double t = matInv(2,1);
	const double u = matInv(2,2);

	const double lam = _lambda;
  const double mu = _mu;

	// thanks again, Matlab
	const double t1 = d-a;
	const double t3 = g-a;
	const double t5 = j-a;
	const double t7 = t1*m+t3*p+t5*s;
	const double t8 = t7*t7;
	const double t10 = e-b;
	const double t12 = h-b;
	const double t14 = k-b;
	const double t16 = t10*m+t12*p+t14*s;
	const double t17 = t16*t16;
	const double t19 = f-c;
	const double t21 = i-c;
	const double t23 = l-c;
	const double t25 = t19*m+t21*p+t23*s;
	const double t26 = t25*t25;
	const double t31 = t1*n+t3*q+t5*t;
	const double t32 = t31*t31;
	const double t37 = t10*n+t12*q+t14*t;
	const double t38 = t37*t37;
	const double t43 = t19*n+t21*q+t23*t;
	const double t44 = t43*t43;
	const double t49 = t1*o+t3*r+t5*u;
	const double t50 = t49*t49;
	const double t55 = t10*o+t12*r+t14*u;
	const double t56 = t55*t55;
	const double t61 = t19*o+t21*r+t23*u;
	const double t62 = t61*t61;
	const double t65 = lam*(t8/2.0+t17/2.0+t26/2.0-3.0/2.0+t32/2.0+t38/2.0+t44/2.0+t50/2.0+t56/2.0+t62/2.0);
	const double t66 = -m-p-s;
	const double t68 = -n-q-t;
	const double t70 = -o-r-u;
	const double t74 = t8+t17+t26-1.0;
	const double t75 = t74*t7/2.0;
	const double t81 = t7*t31+t16*t37+t25*t43;
	const double t90 = t7*t49+t16*t55+t25*t61;
	const double t96 = t32+t38+t44-1.0;
	const double t97 = t96*t31/2.0;
	const double t103 = t31*t49+t37*t55+t43*t61;
	const double t109 = t50+t56+t62-1.0;
	const double t110 = t109*t49/2.0;
	const double t121 = t74*t16/2.0;
	const double t134 = t96*t37/2.0;
	const double t142 = t109*t55/2.0;
	const double t153 = t74*t25/2.0;
	const double t166 = t96*t43/2.0;
	const double t174 = t109*t61/2.0;

	forces[0][0] = -t65*(t7*t66+t31*t68+t49*t70)-mu*(2.0*t75*t66+t81*(t66*t31+t7*t68)+t90*(t66*t49+t7*t70)+2.0*t97*t68+t103*(t68*t49+t31*t70)+2.0*t110*t70);
	forces[0][1] = -t65*(t16*t66+t37*t68+t55*t70)-mu*(2.0*t121*t66+t81*(t66*t37+t16*t68)+t90*(t66*t55+t16*t70)+2.0*t134*t68+t103*(t68*t55+t37*t70)+2.0*t142*t70);
	forces[0][2] = -t65*(t25*t66+t43*t68+t61*t70)-mu*(2.0*t153*t66+t81*(t66*t43+t25*t68)+t90*(t66*t61+t25*t70)+2.0*t166*t68+t103*(t68*t61+t43*t70)+2.0*t174*t70);
	forces[1][0] = -t65*(t7*m+t31*n+t49*o)-mu*(2.0*t75*m+t81*(m*t31+t7*n)+t90*(m*t49+t7*o)+2.0*t97*n+t103*(n*t49+t31*o)+2.0*t110*o);
	forces[1][1] = -t65*(t16*m+t37*n+t55*o)-mu*(2.0*t121*m+t81*(m*t37+t16*n)+t90*(m*t55+t16*o)+2.0*t134*n+t103*(n*t55+t37*o)+2.0*t142*o);
	forces[1][2] = -t65*(t25*m+t43*n+t61*o)-mu*(2.0*t153*m+t81*(m*t43+t25*n)+t90*(m*t61+t25*o)+2.0*t166*n+t103*(n*t61+t43*o)+2.0*t174*o);
	forces[2][0] = -t65*(t7*p+t31*q+t49*r)-mu*(2.0*t75*p+t81*(p*t31+t7*q)+t90*(p*t49+t7*r)+2.0*t97*q+t103*(q*t49+t31*r)+2.0*t110*r);
	forces[2][1] = -t65*(t16*p+t37*q+t55*r)-mu*(2.0*t121*p+t81*(p*t37+t16*q)+t90*(p*t55+t16*r)+2.0*t134*q+t103*(q*t55+t37*r)+2.0*t142*r);
	forces[2][2] = -t65*(t25*p+t43*q+t61*r)-mu*(2.0*t153*p+t81*(p*t43+t25*q)+t90*(p*t61+t25*r)+2.0*t166*q+t103*(q*t61+t43*r)+2.0*t174*r);
	forces[3][0] = -t65*(t7*s+t31*t+t49*u)-mu*(2.0*t75*s+t81*(s*t31+t7*t)+t90*(s*t49+t7*u)+2.0*t97*t+t103*(t*t49+t31*u)+2.0*t110*u);
	forces[3][1] = -t65*(t16*s+t37*t+t55*u)-mu*(2.0*t121*s+t81*(s*t37+t16*t)+t90*(s*t55+t16*u)+2.0*t134*t+t103*(t*t55+t37*u)+2.0*t142*u);
	forces[3][2] = -t65*(t25*s+t43*t+t61*u)-mu*(2.0*t153*s+t81*(s*t43+t25*t)+t90*(s*t61+t25*u)+2.0*t166*t+t103*(t*t61+t43*u)+2.0*t174*u);
}
*/

//////////////////////////////////////////////////////////////////////
// autogenerated as "stiffnessDensity" from:
//
// setup_symbols_wrt_F;
// syms lam mu;
// strain_energy = 0.5*lam*trace(E)^2 + mu*dblcon(E,E);
// [forceDensity stiffnessDensity] = codegen_density(strain_energy,F)
//
// see "MATERIAL.h" for more details
//////////////////////////////////////////////////////////////////////
void STVK::stiffnessDensity(const Real* F, Real* stiffness, bool diagonal)
{
	const double lam = _lambda;
  const double mu = _mu;

	const double t1 = F[0]*F[0];
	const double t4 = F[1]*F[1];
	const double t6 = F[2]*F[2];
	const double t8 = F[3]*F[3];
	const double t10 = F[4]*F[4];
	const double t12 = F[5]*F[5];
	const double t14 = F[6]*F[6];
	const double t16 = F[7]*F[7];
	const double t18 = F[8]*F[8];
	const double t21 = lam*(t1/2.0+t4/2.0+t6/2.0-3.0/2.0+t8/2.0+t10/2.0+t12/2.0+t14/2.0+t16/2.0+t18/2.0);
	const double t28 = F[1]*F[0];
	const double t30 = F[4]*F[3];
	const double t31 = F[7]*F[6];
	const double t34 = -lam*F[1]*F[0]-mu*(2.0*t28+t30+t31);
	const double t35 = lam*F[2];
	const double t37 = F[2]*F[0];
	const double t39 = F[5]*F[3];
	const double t40 = F[8]*F[6];
	const double t43 = -t35*F[0]-mu*(2.0*t37+t39+t40);
	const double t44 = lam*F[3];
	const double t46 = F[0]*F[3];
	const double t48 = F[1]*F[4];
	const double t49 = F[2]*F[5];
	const double t52 = -t44*F[0]-mu*(2.0*t46+t48+t49);
	const double t53 = lam*F[4];
	const double t55 = mu*F[1];
	const double t57 = -t53*F[0]-t55*F[3];
	const double t58 = lam*F[5];
	const double t60 = mu*F[2];
	const double t62 = -t58*F[0]-t60*F[3];
	const double t63 = lam*F[6];
	const double t65 = F[0]*F[6];
	const double t67 = F[1]*F[7];
	const double t68 = F[2]*F[8];
	const double t71 = -t63*F[0]-mu*(2.0*t65+t67+t68);
	const double t72 = lam*F[7];
	const double t75 = -t72*F[0]-t55*F[6];
	const double t76 = lam*F[8];
	const double t79 = -t76*F[0]-t60*F[6];
	const double t86 = F[2]*F[1];
	const double t88 = F[5]*F[4];
	const double t89 = F[8]*F[7];
	const double t92 = -t35*F[1]-mu*(2.0*t86+t88+t89);
	const double t94 = mu*F[0];
	const double t96 = -t44*F[1]-t94*F[4];
	const double t101 = -t53*F[1]-mu*(2.0*t48+t46+t49);
	const double t104 = -t58*F[1]-t60*F[4];
	const double t107 = -t63*F[1]-t94*F[7];
	const double t112 = -t72*F[1]-mu*(2.0*t67+t65+t68);
	const double t115 = -t76*F[1]-t60*F[7];
	const double t123 = -t44*F[2]-t94*F[5];
	const double t126 = -t53*F[2]-t55*F[5];
	const double t131 = -t58*F[2]-mu*(2.0*t49+t46+t48);
	const double t134 = -t63*F[2]-t94*F[8];
	const double t137 = -t72*F[2]-t55*F[8];
	const double t142 = -t76*F[2]-mu*(2.0*t68+t65+t67);
	const double t152 = -t53*F[3]-mu*(t28+2.0*t30+t31);
	const double t157 = -t58*F[3]-mu*(t37+2.0*t39+t40);
	const double t159 = F[3]*F[6];
	const double t161 = F[4]*F[7];
	const double t162 = F[5]*F[8];
	const double t165 = -t63*F[3]-mu*(2.0*t159+t161+t162);
	const double t167 = mu*F[4];
	const double t169 = -t72*F[3]-t167*F[6];
	const double t171 = mu*F[5];
	const double t173 = -t76*F[3]-t171*F[6];
	const double t183 = -t58*F[4]-mu*(t86+2.0*t88+t89);
	const double t185 = mu*F[3];
	const double t187 = -t63*F[4]-t185*F[7];
	const double t192 = -t72*F[4]-mu*(2.0*t161+t159+t162);
	const double t195 = -t76*F[4]-t171*F[7];
	const double t203 = -t63*F[5]-t185*F[8];
	const double t206 = -t72*F[5]-t167*F[8];
	const double t211 = -t76*F[5]-mu*(2.0*t162+t159+t161);
	const double t221 = -t72*F[6]-mu*(t28+t30+2.0*t31);
	const double t226 = -t76*F[6]-mu*(t37+t39+2.0*t40);
	const double t236 = -t76*F[7]-mu*(t86+t88+2.0*t89);

	stiffness[0] = -lam*t1-t21-mu*(3.0*t1+t4+t6-1.0+t8+t14);
	stiffness[1] = t34;
	stiffness[2] = t43;
	stiffness[3] = t52;
	stiffness[4] = t57;
	stiffness[5] = t62;
	stiffness[6] = t71;
	stiffness[7] = t75;
	stiffness[8] = t79;
	stiffness[9] = t34;
	stiffness[10] = -lam*t4-t21-mu*(3.0*t4+t1+t6-1.0+t10+t16);
	stiffness[11] = t92;
	stiffness[12] = t96;
	stiffness[13] = t101;
	stiffness[14] = t104;
	stiffness[15] = t107;
	stiffness[16] = t112;
	stiffness[17] = t115;
	stiffness[18] = t43;
	stiffness[19] = t92;
	stiffness[20] = -lam*t6-t21-mu*(3.0*t6+t1+t4-1.0+t12+t18);
	stiffness[21] = t123;
	stiffness[22] = t126;
	stiffness[23] = t131;
	stiffness[24] = t134;
	stiffness[25] = t137;
	stiffness[26] = t142;
	stiffness[27] = t52;
	stiffness[28] = t96;
	stiffness[29] = t123;
	stiffness[30] = -lam*t8-t21-mu*(t1+3.0*t8+t10+t12-1.0+t14);
	stiffness[31] = t152;
	stiffness[32] = t157;
	stiffness[33] = t165;
	stiffness[34] = t169;
	stiffness[35] = t173;
	stiffness[36] = t57;
	stiffness[37] = t101;
	stiffness[38] = t126;
	stiffness[39] = t152;
	stiffness[40] = -lam*t10-t21-mu*(t4+3.0*t10+t8+t12-1.0+t16);
	stiffness[41] = t183;
	stiffness[42] = t187;
	stiffness[43] = t192;
	stiffness[44] = t195;
	stiffness[45] = t62;
	stiffness[46] = t104;
	stiffness[47] = t131;
	stiffness[48] = t157;
	stiffness[49] = t183;
	stiffness[50] = -lam*t12-t21-mu*(t6+3.0*t12+t8+t10-1.0+t18);
	stiffness[51] = t203;
	stiffness[52] = t206;
	stiffness[53] = t211;
	stiffness[54] = t71;
	stiffness[55] = t107;
	stiffness[56] = t134;
	stiffness[57] = t165;
	stiffness[58] = t187;
	stiffness[59] = t203;
	stiffness[60] = -lam*t14-t21-mu*(t1+t8+3.0*t14+t16+t18-1.0);
	stiffness[61] = t221;
	stiffness[62] = t226;
	stiffness[63] = t75;
	stiffness[64] = t112;
	stiffness[65] = t137;
	stiffness[66] = t169;
	stiffness[67] = t192;
	stiffness[68] = t206;
	stiffness[69] = t221;
	stiffness[70] = -lam*t16-t21-mu*(t4+t10+3.0*t16+t14+t18-1.0);
	stiffness[71] = t236;
	stiffness[72] = t79;
	stiffness[73] = t115;
	stiffness[74] = t142;
	stiffness[75] = t173;
	stiffness[76] = t195;
	stiffness[77] = t211;
	stiffness[78] = t226;
	stiffness[79] = t236;
	stiffness[80] = -lam*t18-t21-mu*(t6+t12+3.0*t18+t14+t16-1.0);
}

//////////////////////////////////////////////////////////////////////
// autogenerated as "forceDensity" from:
//
// setup_symbols;
// syms lam mu;
// strain_energy = 0.5*lam*trace(E)^2 + mu*dblcon(E,E);
// [forceDensity stiffnessDensity] = codegen_density(strain_energy,F)
//
// see "MATERIAL.h" for more details
//////////////////////////////////////////////////////////////////////
void STVK::forceDensity(const Real* F, Real* forces, bool diagonal)
{
	const double lam = _lambda;
	const double mu = _mu;

	const double t1 = F[0]*F[0];
	const double t3 = F[1]*F[1];
	const double t5 = F[2]*F[2];
	const double t7 = F[3]*F[3];
	const double t9 = F[4]*F[4];
	const double t11 = F[5]*F[5];
	const double t13 = F[6]*F[6];
	const double t15 = F[7]*F[7];
	const double t17 = F[8]*F[8];
	const double t20 = lam*(t1/2.0+t3/2.0+t5/2.0-3.0/2.0+t7/2.0+t9/2.0+t11/2.0+t13/2.0+t15/2.0+t17/2.0);
	const double t22 = t1+t3+t5-1.0;
	const double t27 = F[0]*F[3]+F[1]*F[4]+F[2]*F[5];
	const double t32 = F[0]*F[6]+F[1]*F[7]+F[2]*F[8];
	const double t53 = t7+t9+t11-1.0;
	const double t58 = F[3]*F[6]+F[4]*F[7]+F[5]*F[8];
	const double t80 = t13+t15+t17-1.0;

	forces[0] = -t20*F[0]-2.0*mu*(t22*F[0]/2.0+t27*F[3]/2.0+t32*F[6]/2.0);
	forces[1] = -t20*F[1]-2.0*mu*(t22*F[1]/2.0+t27*F[4]/2.0+t32*F[7]/2.0);
	forces[2] = -t20*F[2]-2.0*mu*(t22*F[2]/2.0+t27*F[5]/2.0+t32*F[8]/2.0);
	forces[3] = -t20*F[3]-2.0*mu*(t27*F[0]/2.0+t53*F[3]/2.0+t58*F[6]/2.0);
	forces[4] = -t20*F[4]-2.0*mu*(t27*F[1]/2.0+t53*F[4]/2.0+t58*F[7]/2.0);
	forces[5] = -t20*F[5]-2.0*mu*(t27*F[2]/2.0+t53*F[5]/2.0+t58*F[8]/2.0);
	forces[6] = -t20*F[6]-2.0*mu*(t32*F[0]/2.0+t58*F[3]/2.0+t80*F[6]/2.0);
	forces[7] = -t20*F[7]-2.0*mu*(t32*F[1]/2.0+t58*F[4]/2.0+t80*F[7]/2.0);
	forces[8] = -t20*F[8]-2.0*mu*(t32*F[2]/2.0+t58*F[5]/2.0+t80*F[8]/2.0);
}

void STVK::computeStresses(TET& tet)
{
  MATRIX3 F = tet.F();
  const VEC3F* areaVecs = tet.b();
  _pf_pF.clear();

  const double lam = _lambda;
  const double mu = _mu;
  
  const double f00 = F(0,0);
  const double f01 = F(0,1);
  const double f02 = F(0,2);
  const double f10 = F(1,0);
  const double f11 = F(1,1);
  const double f12 = F(1,2);
  const double f20 = F(2,0);
  const double f21 = F(2,1);
  const double f22 = F(2,2);

  const double b00 = areaVecs[0][0];
  const double b01 = areaVecs[0][1];
  const double b02 = areaVecs[0][2];
  const double b10 = areaVecs[1][0];
  const double b11 = areaVecs[1][1];
  const double b12 = areaVecs[1][2];
  const double b20 = areaVecs[2][0];
  const double b21 = areaVecs[2][1];
  const double b22 = areaVecs[2][2];
  const double b30 = areaVecs[3][0];
  const double b31 = areaVecs[3][1];
  const double b32 = areaVecs[3][2];

  const double t1 = f00*f00;
  const double t3 = f10*f10;
  const double t5 = f20*f20;
  const double t7 = f01*f01;
  const double t9 = f11*f11;
  const double t11 = f21*f21;
  const double t13 = f02*f02;
  const double t15 = f12*f12;
  const double t17 = f22*f22;
  const double t20 = lam*(t1/2.0+t3/2.0+t5/2.0-3.0/2.0+t7/2.0+t9/2.0+t11/2.0+t13/2.0+t15/2.0+t17/2.0);
  const double t23 = mu*(t1+t3+t5-1.0);
  const double t24 = lam*f00;
  const double t25 = mu*f00;
  const double t27 = t24+2.0*t25;
  const double t29 = t7*mu;
  const double t30 = t13*mu;
  const double t31 = t20+t23+f00*t27+t29+t30;
  const double t38 = mu*(f00*f01+f10*f11+f20*f21);
  const double t40 = lam*f01;
  const double t42 = t38+t25*f01+t40*f00;
  const double t49 = mu*(f00*f02+f10*f12+f20*f22);
  const double t51 = lam*f02;
  const double t53 = t49+t25*f02+t51*f00;
  const double t56 = lam*f10;
  const double t57 = mu*f10;
  const double t59 = t56+2.0*t57;
  const double t61 = mu*f01;
  const double t62 = t61*f11;
  const double t63 = mu*f02;
  const double t64 = t63*f12;
  const double t65 = f00*t59+t62+t64;
  const double t69 = t25*f11+t40*f10;
  const double t73 = t25*f12+t51*f10;
  const double t77 = mu*f20;
  const double t79 = lam*f20+2.0*t77;
  const double t81 = t61*f21;
  const double t82 = t63*f22;
  const double t83 = f00*t79+t81+t82;
  const double t87 = t25*f21+t40*f20;
  const double t91 = t25*f22+t51*f20;
  const double t95 = t1*mu;
  const double t98 = mu*(t7+t9+t11-1.0);
  const double t100 = t40+2.0*t61;
  const double t102 = t95+t20+t98+f01*t100+t30;
  const double t109 = mu*(f01*f02+f11*f12+f21*f22);
  const double t112 = t109+t61*f02+t51*f01;
  const double t117 = t24*f11+t61*f10;
  const double t119 = t25*f10;
  const double t120 = lam*f11;
  const double t121 = mu*f11;
  const double t123 = t120+2.0*t121;
  const double t125 = t119+f01*t123+t64;
  const double t129 = t61*f12+t51*f11;
  const double t134 = t24*f21+t61*f20;
  const double t136 = t25*f20;
  const double t137 = lam*f21;
  const double t138 = mu*f21;
  const double t140 = t137+2.0*t138;
  const double t142 = t136+f01*t140+t82;
  const double t146 = t61*f22+t51*f21;
  const double t153 = mu*(t13+t15+t17-1.0);
  const double t155 = t51+2.0*t63;
  const double t157 = t95+t29+t20+t153+f02*t155;
  const double t162 = t24*f12+t63*f10;
  const double t166 = t40*f12+t63*f11;
  const double t168 = lam*f12;
  const double t169 = mu*f12;
  const double t171 = t168+2.0*t169;
  const double t173 = t119+t62+f02*t171;
  const double t178 = t24*f22+t63*f20;
  const double t182 = t40*f22+t63*f21;
  const double t184 = lam*f22;
  const double t187 = t184+2.0*mu*f22;
  const double t189 = t136+t81+f02*t187;
  const double t193 = f10*t27+t62+t64;
  const double t199 = t9*mu;
  const double t200 = t15*mu;
  const double t201 = t20+t23+f10*t59+t199+t200;
  const double t205 = t38+t57*f11+t120*f10;
  const double t209 = t49+t57*f12+t168*f10;
  const double t213 = t121*f21;
  const double t214 = t169*f22;
  const double t215 = f10*t79+t213+t214;
  const double t219 = t57*f21+t120*f20;
  const double t223 = t57*f22+t168*f20;
  const double t228 = t119+f11*t100+t64;
  const double t233 = t3*mu;
  const double t235 = t233+t20+t98+f11*t123+t200;
  const double t239 = t109+t121*f12+t168*f11;
  const double t244 = t56*f21+t121*f20;
  const double t246 = t57*f20;
  const double t248 = t246+f11*t140+t214;
  const double t252 = t121*f22+t168*f21;
  const double t258 = t119+t62+f12*t155;
  const double t264 = t233+t199+t20+t153+f12*t171;
  const double t269 = t56*f22+t169*f20;
  const double t273 = t120*f22+t169*f21;
  const double t276 = t246+t213+f12*t187;
  const double t280 = f20*t27+t81+t82;
  const double t286 = f20*t59+t213+t214;
  const double t292 = t11*mu;
  const double t293 = t17*mu;
  const double t294 = t20+t23+f20*t79+t292+t293;
  const double t298 = t38+t77*f21+t137*f20;
  const double t302 = t49+t77*f22+t184*f20;
  const double t307 = t136+f21*t100+t82;
  const double t313 = t246+f21*t123+t214;
  const double t318 = t5*mu;
  const double t320 = t318+t20+t98+f21*t140+t293;
  const double t324 = t109+t138*f22+t184*f21;
  const double t330 = t136+t81+f22*t155;
  const double t336 = t246+t213+f22*t171;
  const double t342 = t318+t292+t20+t153+f22*t187;
  _pf_pF(0,0) = t31*b00+t42*b01+t53*b02;
  _pf_pF(0,1) = t65*b00+t69*b01+t73*b02;
  _pf_pF(0,2) = t83*b00+t87*b01+t91*b02;
  _pf_pF(0,3) = t42*b00+t102*b01+t112*b02;
  _pf_pF(0,4) = t117*b00+t125*b01+t129*b02;
  _pf_pF(0,5) = t134*b00+t142*b01+t146*b02;
  _pf_pF(0,6) = t53*b00+t112*b01+t157*b02;
  _pf_pF(0,7) = t162*b00+t166*b01+t173*b02;
  _pf_pF(0,8) = t178*b00+t182*b01+t189*b02;
  _pf_pF(1,0) = t193*b00+t117*b01+t162*b02;
  _pf_pF(1,1) = t201*b00+t205*b01+t209*b02;
  _pf_pF(1,2) = t215*b00+t219*b01+t223*b02;
  _pf_pF(1,3) = t69*b00+t228*b01+t166*b02;
  _pf_pF(1,4) = t205*b00+t235*b01+t239*b02;
  _pf_pF(1,5) = t244*b00+t248*b01+t252*b02;
  _pf_pF(1,6) = t73*b00+t129*b01+t258*b02;
  _pf_pF(1,7) = t209*b00+t239*b01+t264*b02;
  _pf_pF(1,8) = t269*b00+t273*b01+t276*b02;
  _pf_pF(2,0) = t280*b00+t134*b01+t178*b02;
  _pf_pF(2,1) = t286*b00+t244*b01+t269*b02;
  _pf_pF(2,2) = t294*b00+t298*b01+t302*b02;
  _pf_pF(2,3) = t87*b00+t307*b01+t182*b02;
  _pf_pF(2,4) = t219*b00+t313*b01+t273*b02;
  _pf_pF(2,5) = t298*b00+t320*b01+t324*b02;
  _pf_pF(2,6) = t91*b00+t146*b01+t330*b02;
  _pf_pF(2,7) = t223*b00+t252*b01+t336*b02;
  _pf_pF(2,8) = t302*b00+t324*b01+t342*b02;
  _pf_pF(3,0) = t31*b10+t42*b11+t53*b12;
  _pf_pF(3,1) = t65*b10+t69*b11+t73*b12;
  _pf_pF(3,2) = t83*b10+t87*b11+t91*b12;
  _pf_pF(3,3) = t42*b10+t102*b11+t112*b12;
  _pf_pF(3,4) = t117*b10+t125*b11+t129*b12;
  _pf_pF(3,5) = t134*b10+t142*b11+t146*b12;
  _pf_pF(3,6) = t53*b10+t112*b11+t157*b12;
  _pf_pF(3,7) = t162*b10+t166*b11+t173*b12;
  _pf_pF(3,8) = t178*b10+t182*b11+t189*b12;
  _pf_pF(4,0) = t193*b10+t117*b11+t162*b12;
  _pf_pF(4,1) = t201*b10+t205*b11+t209*b12;
  _pf_pF(4,2) = t215*b10+t219*b11+t223*b12;
  _pf_pF(4,3) = t69*b10+t228*b11+t166*b12;
  _pf_pF(4,4) = t205*b10+t235*b11+t239*b12;
  _pf_pF(4,5) = t244*b10+t248*b11+t252*b12;
  _pf_pF(4,6) = t73*b10+t129*b11+t258*b12;
  _pf_pF(4,7) = t209*b10+t239*b11+t264*b12;
  _pf_pF(4,8) = t269*b10+t273*b11+t276*b12;
  _pf_pF(5,0) = t280*b10+t134*b11+t178*b12;
  _pf_pF(5,1) = t286*b10+t244*b11+t269*b12;
  _pf_pF(5,2) = t294*b10+t298*b11+t302*b12;
  _pf_pF(5,3) = t87*b10+t307*b11+t182*b12;
  _pf_pF(5,4) = t219*b10+t313*b11+t273*b12;
  _pf_pF(5,5) = t298*b10+t320*b11+t324*b12;
  _pf_pF(5,6) = t91*b10+t146*b11+t330*b12;
  _pf_pF(5,7) = t223*b10+t252*b11+t336*b12;
  _pf_pF(5,8) = t302*b10+t324*b11+t342*b12;
  _pf_pF(6,0) = t31*b20+t42*b21+t53*b22;
  _pf_pF(6,1) = t65*b20+t69*b21+t73*b22;
  _pf_pF(6,2) = t83*b20+t87*b21+t91*b22;
  _pf_pF(6,3) = t42*b20+t102*b21+t112*b22;
  _pf_pF(6,4) = t117*b20+t125*b21+t129*b22;
  _pf_pF(6,5) = t134*b20+t142*b21+t146*b22;
  _pf_pF(6,6) = t53*b20+t112*b21+t157*b22;
  _pf_pF(6,7) = t162*b20+t166*b21+t173*b22;
  _pf_pF(6,8) = t178*b20+t182*b21+t189*b22;
  _pf_pF(7,0) = t193*b20+t117*b21+t162*b22;
  _pf_pF(7,1) = t201*b20+t205*b21+t209*b22;
  _pf_pF(7,2) = t215*b20+t219*b21+t223*b22;
  _pf_pF(7,3) = t69*b20+t228*b21+t166*b22;
  _pf_pF(7,4) = t205*b20+t235*b21+t239*b22;
  _pf_pF(7,5) = t244*b20+t248*b21+t252*b22;
  _pf_pF(7,6) = t73*b20+t129*b21+t258*b22;
  _pf_pF(7,7) = t209*b20+t239*b21+t264*b22;
  _pf_pF(7,8) = t269*b20+t273*b21+t276*b22;
  _pf_pF(8,0) = t280*b20+t134*b21+t178*b22;
  _pf_pF(8,1) = t286*b20+t244*b21+t269*b22;
  _pf_pF(8,2) = t294*b20+t298*b21+t302*b22;
  _pf_pF(8,3) = t87*b20+t307*b21+t182*b22;
  _pf_pF(8,4) = t219*b20+t313*b21+t273*b22;
  _pf_pF(8,5) = t298*b20+t320*b21+t324*b22;
  _pf_pF(8,6) = t91*b20+t146*b21+t330*b22;
  _pf_pF(8,7) = t223*b20+t252*b21+t336*b22;
  _pf_pF(8,8) = t302*b20+t324*b21+t342*b22;
  _pf_pF(9,0) = t31*b30+t42*b31+t53*b32;
  _pf_pF(9,1) = t65*b30+t69*b31+t73*b32;
  _pf_pF(9,2) = t83*b30+t87*b31+t91*b32;
  _pf_pF(9,3) = t42*b30+t102*b31+t112*b32;
  _pf_pF(9,4) = t117*b30+t125*b31+t129*b32;
  _pf_pF(9,5) = t134*b30+t142*b31+t146*b32;
  _pf_pF(9,6) = t53*b30+t112*b31+t157*b32;
  _pf_pF(9,7) = t162*b30+t166*b31+t173*b32;
  _pf_pF(9,8) = t178*b30+t182*b31+t189*b32;
  _pf_pF(10,0) = t193*b30+t117*b31+t162*b32;
  _pf_pF(10,1) = t201*b30+t205*b31+t209*b32;
  _pf_pF(10,2) = t215*b30+t219*b31+t223*b32;
  _pf_pF(10,3) = t69*b30+t228*b31+t166*b32;
  _pf_pF(10,4) = t205*b30+t235*b31+t239*b32;
  _pf_pF(10,5) = t244*b30+t248*b31+t252*b32;
  _pf_pF(10,6) = t73*b30+t129*b31+t258*b32;
  _pf_pF(10,7) = t209*b30+t239*b31+t264*b32;
  _pf_pF(10,8) = t269*b30+t273*b31+t276*b32;
  _pf_pF(11,0) = t280*b30+t134*b31+t178*b32;
  _pf_pF(11,1) = t286*b30+t244*b31+t269*b32;
  _pf_pF(11,2) = t294*b30+t298*b31+t302*b32;
  _pf_pF(11,3) = t87*b30+t307*b31+t182*b32;
  _pf_pF(11,4) = t219*b30+t313*b31+t273*b32;
  _pf_pF(11,5) = t298*b30+t320*b31+t324*b32;
  _pf_pF(11,6) = t91*b30+t146*b31+t330*b32;
  _pf_pF(11,7) = t223*b30+t252*b31+t336*b32;
  _pf_pF(11,8) = t302*b30+t324*b31+t342*b32;
}

//////////////////////////////////////////////////////////////////////
// Whole lot of hessian functions
//////////////////////////////////////////////////////////////////////
void STVK::hessian0(MATRIX3& DmInv, const VEC3F* bVecs, const VEC3F* vertices, MATRIX& hessian)
{
  Real b00 = bVecs[0][0];
  Real b01 = bVecs[0][1];
  Real b02 = bVecs[0][2];
  Real b10 = bVecs[1][0];
  Real b11 = bVecs[1][1];
  Real b12 = bVecs[1][2];
  Real b20 = bVecs[2][0];
  Real b21 = bVecs[2][1];
  Real b22 = bVecs[2][2];
  Real b30 = bVecs[3][0];
  Real b31 = bVecs[3][1];
  Real b32 = bVecs[3][2];

  Real a = vertices[0][0];
  Real b = vertices[0][1];
  Real c = vertices[0][2];

  Real d = vertices[1][0];
  Real e = vertices[1][1];
  Real f = vertices[1][2];

  Real g = vertices[2][0];
  Real h = vertices[2][1];
  Real i = vertices[2][2];

  Real j = vertices[3][0];
  Real k = vertices[3][1];
  Real l = vertices[3][2];
 
  Real m = DmInv(0,0);
  Real n = DmInv(0,1);
  Real o = DmInv(0,2);
  Real p = DmInv(1,0);
  Real q = DmInv(1,1);
  Real r = DmInv(1,2);
  Real s = DmInv(2,0);
  Real t = DmInv(2,1);
  Real u = DmInv(2,2);
 
  Real t1 = -m-p-s;
  Real t2 = d-a;
  Real t4 = g-a;
  Real t6 = j-a;
  Real t8 = t2*m+t4*p+t6*s;
  Real t13 = t2*n+t4*q+t6*t;
  Real t14 = -n-q-t;
  Real t19 = t2*o+t4*r+t6*u;
  Real t20 = -o-r-u;
  Real t23 = _lambda*(t8*t1+t13*t14+t19*t20);
  Real t24 = _mu*t8;
  Real t27 = t23+2.0*t24*t1;
  Real t28 = t1*t27;
  Real t30 = t1*t1;
  Real t31 = t14*t14;
  Real t32 = t20*t20;
  Real t34 = _lambda*(t30+t31+t32);
  Real t37 = t34+2.0*_mu*t30;
  Real t39 = t14*_mu;
  Real t42 = t1*t13+t8*t14;
  Real t43 = t39*t42/2.0;
  Real t45 = t13*_mu;
  Real t46 = t1*t14;
  Real t49 = t20*_mu;
  Real t52 = t1*t19+t8*t20;
  Real t53 = t49*t52/2.0;
  Real t55 = t19*_mu;
  Real t56 = t1*t20;
  Real t59 = 2.0*t28+t8*t37+4.0*t43+2.0*t45*t46+4.0*t53+2.0*t55*t56;
  Real t61 = t1*_mu;
  Real t62 = t61*t42/2.0;
  Real t68 = t23+2.0*t45*t14;
  Real t69 = t14*t68;
  Real t73 = t34+2.0*_mu*t31;
  Real t77 = t14*t19+t13*t20;
  Real t78 = t49*t77/2.0;
  Real t80 = t14*t20;
  Real t83 = 4.0*t62+2.0*t24*t46+2.0*t69+t13*t73+4.0*t78+2.0*t55*t80;
  Real t85 = t61*t52/2.0;
  Real t89 = t39*t77/2.0;
  Real t95 = t23+2.0*t55*t20;
  Real t96 = t20*t95;
  Real t100 = t34+2.0*_mu*t32;
  Real t102 = 4.0*t85+2.0*t24*t56+4.0*t89+2.0*t45*t80+2.0*t96+t19*t100;
  Real t105 = e-b;
  Real t107 = h-b;
  Real t109 = k-b;
  Real t111 = t105*m+t107*p+t109*s;
  Real t116 = t105*n+t107*q+t109*t;
  Real t121 = t105*o+t107*r+t109*u;
  Real t124 = _lambda*(t111*t1+t116*t14+t121*t20);
  Real t125 = _mu*t111;
  Real t132 = t1*t116+t111*t14;
  Real t137 = t1*t121+t111*t20;
  Real t140 = t1*(t124+2.0*t125*t1)+t39*t132+t49*t137;
  Real t144 = _mu*t116;
  Real t151 = t14*t121+t116*t20;
  Real t154 = t61*t132+t14*(t124+2.0*t144*t14)+t49*t151;
  Real t160 = _mu*t121;
  Real t165 = t61*t137+t39*t151+t20*(t124+2.0*t160*t20);
  Real t168 = f-c;
  Real t170 = i-c;
  Real t172 = l-c;
  Real t174 = t168*m+t170*p+t172*s;
  Real t179 = t168*n+t170*q+t172*t;
  Real t184 = t168*o+t170*r+t172*u;
  Real t187 = _lambda*(t174*t1+t179*t14+t184*t20);
  Real t188 = _mu*t174;
  Real t195 = t1*t179+t174*t14;
  Real t200 = t1*t184+t174*t20;
  Real t203 = t1*(t187+2.0*t188*t1)+t39*t195+t49*t200;
  Real t207 = _mu*t179;
  Real t214 = t14*t184+t179*t20;
  Real t217 = t61*t195+t14*(t187+2.0*t207*t14)+t49*t214;
  Real t223 = _mu*t184;
  Real t228 = t61*t200+t39*t214+t20*(t187+2.0*t223*t20);
  Real t231 = m*t27;
  Real t236 = _lambda*(t8*m+t13*n+t19*o);
  Real t245 = _lambda*(t1*m+t14*n+t20*o);
  Real t248 = t245+2.0*t61*m;
  Real t250 = n*_mu;
  Real t252 = t250*t42;
  Real t255 = m*t13+t8*n;
  Real t260 = m*t14+t1*n;
  Real t263 = o*_mu;
  Real t265 = t263*t52;
  Real t268 = m*t19+t8*o;
  Real t273 = m*t20+t1*o;
  Real t276 = t231+t1*(t236+2.0*t24*m)+t8*t248+t252+t39*t255+t45*t260+t265+t49*t268+t55*t273;
  Real t278 = m*_mu;
  Real t280 = t278*t42;
  Real t285 = n*t68;
  Real t292 = t245+2.0*t39*n;
  Real t295 = t263*t77;
  Real t298 = n*t19+t13*o;
  Real t303 = n*t20+t14*o;
  Real t306 = t280+t61*t255+t24*t260+t285+t14*(t236+2.0*t45*n)+t13*t292+t295+t49*t298+t55*t303;
  Real t309 = t278*t52;
  Real t315 = t250*t77;
  Real t320 = o*t95;
  Real t327 = t245+2.0*t49*o;
  Real t329 = t309+t61*t268+t24*t273+t315+t39*t298+t45*t303+t320+t20*(t236+2.0*t55*o)+t19*t327;
  Real t336 = _lambda*(t111*m+t116*n+t121*o);
  Real t343 = m*t116+t111*n;
  Real t348 = m*t121+t111*o;
  Real t351 = t1*(t336+2.0*t125*m)+t39*t343+t49*t348;
  Real t361 = n*t121+t116*o;
  Real t364 = t61*t343+t14*(t336+2.0*t144*n)+t49*t361;
  Real t374 = t61*t348+t39*t361+t20*(t336+2.0*t160*o);
  Real t381 = _lambda*(t174*m+t179*n+t184*o);
  Real t388 = m*t179+t174*n;
  Real t393 = m*t184+t174*o;
  Real t396 = t1*(t381+2.0*t188*m)+t39*t388+t49*t393;
  Real t406 = n*t184+t179*o;
  Real t409 = t61*t388+t14*(t381+2.0*t207*n)+t49*t406;
  Real t419 = t61*t393+t39*t406+t20*(t381+2.0*t223*o);
  Real t422 = p*t27;
  Real t427 = _lambda*(t8*p+t13*q+t19*r);
  Real t436 = _lambda*(t1*p+t14*q+t20*r);
  Real t439 = t436+2.0*t61*p;
  Real t441 = q*_mu;
  Real t443 = t441*t42;
  Real t446 = p*t13+t8*q;
  Real t451 = p*t14+t1*q;
  Real t454 = r*_mu;
  Real t456 = t454*t52;
  Real t459 = p*t19+t8*r;
  Real t464 = p*t20+t1*r;
  Real t467 = t422+t1*(t427+2.0*t24*p)+t8*t439+t443+t39*t446+t45*t451+t456+t49*t459+t55*t464;
  Real t469 = p*_mu;
  Real t471 = t469*t42;
  Real t476 = q*t68;
  Real t483 = t436+2.0*t39*q;
  Real t486 = t454*t77;
  Real t489 = q*t19+t13*r;
  Real t494 = q*t20+t14*r;
  Real t497 = t471+t61*t446+t24*t451+t476+t14*(t427+2.0*t45*q)+t13*t483+t486+t49*t489+t55*t494;
  Real t500 = t469*t52;
  Real t506 = t441*t77;
  Real t511 = r*t95;
  Real t518 = t436+2.0*t49*r;
  Real t520 = t500+t61*t459+t24*t464+t506+t39*t489+t45*t494+t511+t20*(t427+2.0*t55*r)+t19*t518;
  Real t527 = _lambda*(t111*p+t116*q+t121*r);
  Real t534 = p*t116+t111*q;
  Real t539 = p*t121+t111*r;
  Real t542 = t1*(t527+2.0*t125*p)+t39*t534+t49*t539;
  Real t552 = q*t121+t116*r;
  Real t555 = t61*t534+t14*(t527+2.0*t144*q)+t49*t552;
  Real t565 = t61*t539+t39*t552+t20*(t527+2.0*t160*r);
  Real t572 = _lambda*(t174*p+t179*q+t184*r);
  Real t579 = p*t179+t174*q;
  Real t584 = p*t184+t174*r;
  Real t587 = t1*(t572+2.0*t188*p)+t39*t579+t49*t584;
  Real t597 = q*t184+t179*r;
  Real t600 = t61*t579+t14*(t572+2.0*t207*q)+t49*t597;
  Real t610 = t61*t584+t39*t597+t20*(t572+2.0*t223*r);
  Real t613 = s*t27;
  Real t618 = _lambda*(t8*s+t13*t+t19*u);
  Real t627 = _lambda*(s*t1+t*t14+u*t20);
  Real t628 = _mu*s;
  Real t631 = t627+2.0*t628*t1;
  Real t633 = t*_mu;
  Real t635 = t633*t42;
  Real t638 = s*t13+t8*t;
  Real t643 = t1*t+s*t14;
  Real t646 = u*_mu;
  Real t648 = t646*t52;
  Real t651 = s*t19+t8*u;
  Real t656 = t1*u+s*t20;
  Real t659 = t613+t1*(t618+2.0*t24*s)+t8*t631+t635+t39*t638+t45*t643+t648+t49*t651+t55*t656;
  Real t662 = t628*t42;
  Real t667 = t*t68;
  Real t674 = t627+2.0*t633*t14;
  Real t677 = t646*t77;
  Real t680 = t*t19+t13*u;
  Real t685 = t14*u+t*t20;
  Real t688 = t662+t61*t638+t24*t643+t667+t14*(t618+2.0*t45*t)+t13*t674+t677+t49*t680+t55*t685;
  Real t691 = t628*t52;
  Real t697 = t633*t77;
  Real t702 = u*t95;
  Real t709 = t627+2.0*t646*t20;
  Real t711 = t691+t61*t651+t24*t656+t697+t39*t680+t45*t685+t702+t20*(t618+2.0*t55*u)+t19*t709;
  Real t718 = _lambda*(t111*s+t116*t+t121*u);
  Real t725 = s*t116+t111*t;
  Real t730 = s*t121+t111*u;
  Real t733 = t1*(t718+2.0*t125*s)+t39*t725+t49*t730;
  Real t743 = t*t121+t116*u;
  Real t746 = t61*t725+t14*(t718+2.0*t144*t)+t49*t743;
  Real t756 = t61*t730+t39*t743+t20*(t718+2.0*t160*u);
  Real t763 = _lambda*(t174*s+t179*t+t184*u);
  Real t770 = s*t179+t174*t;
  Real t775 = s*t184+t174*u;
  Real t778 = t1*(t763+2.0*t188*s)+t39*t770+t49*t775;
  Real t788 = t*t184+t179*u;
  Real t791 = t61*t770+t14*(t763+2.0*t207*t)+t49*t788;
  Real t801 = t61*t775+t39*t788+t20*(t763+2.0*t223*u);
  Real t809 = t111*t37+2.0*t144*t46+2.0*t160*t56;
  Real t816 = 2.0*t125*t46+t116*t73+2.0*t160*t80;
  Real t823 = 2.0*t125*t56+2.0*t144*t80+t121*t100;
  Real t828 = t28+2.0*t43+2.0*t53;
  Real t832 = 2.0*t62+t69+2.0*t78;
  Real t836 = 2.0*t85+2.0*t89+t96;
  Real t838 = t828*b00+t832*b01+t836*b02;
  Real t844 = t111*t248+t144*t260+t160*t273;
  Real t851 = t125*t260+t116*t292+t160*t303;
  Real t858 = t125*t273+t144*t303+t121*t327;
  Real t861 = t231+t252+t265;
  Real t863 = t280+t285+t295;
  Real t865 = t309+t315+t320;
  Real t867 = t861*b00+t863*b01+t865*b02;
  Real t873 = t111*t439+t144*t451+t160*t464;
  Real t880 = t125*t451+t116*t483+t160*t494;
  Real t887 = t125*t464+t144*t494+t121*t518;
  Real t890 = t422+t443+t456;
  Real t892 = t471+t476+t486;
  Real t894 = t500+t506+t511;
  Real t896 = t890*b00+t892*b01+t894*b02;
  Real t902 = t111*t631+t144*t643+t160*t656;
  Real t909 = t125*t643+t116*t674+t160*t685;
  Real t916 = t125*t656+t144*t685+t121*t709;
  Real t919 = t613+t635+t648;
  Real t921 = t662+t667+t677;
  Real t923 = t691+t697+t702;
  Real t925 = t919*b00+t921*b01+t923*b02;
  Real t931 = t174*t37+2.0*t207*t46+2.0*t223*t56;
  Real t938 = 2.0*t188*t46+t179*t73+2.0*t223*t80;
  Real t945 = 2.0*t188*t56+2.0*t207*t80+t184*t100;
  Real t953 = t174*t248+t207*t260+t223*t273;
  Real t960 = t188*t260+t179*t292+t223*t303;
  Real t967 = t188*t273+t207*t303+t184*t327;
  Real t975 = t174*t439+t207*t451+t223*t464;
  Real t982 = t188*t451+t179*t483+t223*t494;
  Real t989 = t188*t464+t207*t494+t184*t518;
  Real t997 = t174*t631+t207*t643+t223*t656;
  Real t1004 = t188*t643+t179*t674+t223*t685;
  Real t1011 = t188*t656+t207*t685+t184*t709;
  Real t1069 = t828*b10+t832*b11+t836*b12;
  Real t1077 = t861*b10+t863*b11+t865*b12;
  Real t1085 = t890*b10+t892*b11+t894*b12;
  Real t1093 = t919*b10+t921*b11+t923*b12;
  Real t1165 = t828*b20+t832*b21+t836*b22;
  Real t1173 = t861*b20+t863*b21+t865*b22;
  Real t1181 = t890*b20+t892*b21+t894*b22;
  Real t1189 = t919*b20+t921*b21+t923*b22;
  Real t1261 = t828*b30+t832*b31+t836*b32;
  Real t1269 = t861*b30+t863*b31+t865*b32;
  Real t1277 = t890*b30+t892*b31+t894*b32;
  Real t1285 = t919*b30+t921*b31+t923*b32;
  hessian(0,0) = t59*b00+t83*b01+t102*b02;
  hessian(0,1) = t140*b00+t154*b01+t165*b02;
  hessian(0,2) = t203*b00+t217*b01+t228*b02;
  hessian(0,3) = t276*b00+t306*b01+t329*b02;
  hessian(0,4) = t351*b00+t364*b01+t374*b02;
  hessian(0,5) = t396*b00+t409*b01+t419*b02;
  hessian(0,6) = t467*b00+t497*b01+t520*b02;
  hessian(0,7) = t542*b00+t555*b01+t565*b02;
  hessian(0,8) = t587*b00+t600*b01+t610*b02;
  hessian(0,9) = t659*b00+t688*b01+t711*b02;
  hessian(0,10) = t733*b00+t746*b01+t756*b02;
  hessian(0,11) = t778*b00+t791*b01+t801*b02;
  hessian(1,0) = t809*b00+t816*b01+t823*b02;
  hessian(1,1) = t838;
  hessian(1,2) = 0.0;
  hessian(1,3) = t844*b00+t851*b01+t858*b02;
  hessian(1,4) = t867;
  hessian(1,5) = 0.0;
  hessian(1,6) = t873*b00+t880*b01+t887*b02;
  hessian(1,7) = t896;
  hessian(1,8) = 0.0;
  hessian(1,9) = t902*b00+t909*b01+t916*b02;
  hessian(1,10) = t925;
  hessian(1,11) = 0.0;
  hessian(2,0) = t931*b00+t938*b01+t945*b02;
  hessian(2,1) = 0.0;
  hessian(2,2) = t838;
  hessian(2,3) = t953*b00+t960*b01+t967*b02;
  hessian(2,4) = 0.0;
  hessian(2,5) = t867;
  hessian(2,6) = t975*b00+t982*b01+t989*b02;
  hessian(2,7) = 0.0;
  hessian(2,8) = t896;
  hessian(2,9) = t997*b00+t1004*b01+t1011*b02;
  hessian(2,10) = 0.0;
  hessian(2,11) = t925;
  hessian(3,0) = t59*b10+t83*b11+t102*b12;
  hessian(3,1) = t140*b10+t154*b11+t165*b12;
  hessian(3,2) = t203*b10+t217*b11+t228*b12;
  hessian(3,3) = t276*b10+t306*b11+t329*b12;
  hessian(3,4) = t351*b10+t364*b11+t374*b12;
  hessian(3,5) = t396*b10+t409*b11+t419*b12;
  hessian(3,6) = t467*b10+t497*b11+t520*b12;
  hessian(3,7) = t542*b10+t555*b11+t565*b12;
  hessian(3,8) = t587*b10+t600*b11+t610*b12;
  hessian(3,9) = t659*b10+t688*b11+t711*b12;
  hessian(3,10) = t733*b10+t746*b11+t756*b12;
  hessian(3,11) = t778*b10+t791*b11+t801*b12;
  hessian(4,0) = t809*b10+t816*b11+t823*b12;
  hessian(4,1) = t1069;
  hessian(4,2) = 0.0;
  hessian(4,3) = t844*b10+t851*b11+t858*b12;
  hessian(4,4) = t1077;
  hessian(4,5) = 0.0;
  hessian(4,6) = t873*b10+t880*b11+t887*b12;
  hessian(4,7) = t1085;
  hessian(4,8) = 0.0;
  hessian(4,9) = t902*b10+t909*b11+t916*b12;
  hessian(4,10) = t1093;
  hessian(4,11) = 0.0;
  hessian(5,0) = t931*b10+t938*b11+t945*b12;
  hessian(5,1) = 0.0;
  hessian(5,2) = t1069;
  hessian(5,3) = t953*b10+t960*b11+t967*b12;
  hessian(5,4) = 0.0;
  hessian(5,5) = t1077;
  hessian(5,6) = t975*b10+t982*b11+t989*b12;
  hessian(5,7) = 0.0;
  hessian(5,8) = t1085;
  hessian(5,9) = t997*b10+t1004*b11+t1011*b12;
  hessian(5,10) = 0.0;
  hessian(5,11) = t1093;
  hessian(6,0) = t59*b20+t83*b21+t102*b22;
  hessian(6,1) = t140*b20+t154*b21+t165*b22;
  hessian(6,2) = t203*b20+t217*b21+t228*b22;
  hessian(6,3) = t276*b20+t306*b21+t329*b22;
  hessian(6,4) = t351*b20+t364*b21+t374*b22;
  hessian(6,5) = t396*b20+t409*b21+t419*b22;
  hessian(6,6) = t467*b20+t497*b21+t520*b22;
  hessian(6,7) = t542*b20+t555*b21+t565*b22;
  hessian(6,8) = t587*b20+t600*b21+t610*b22;
  hessian(6,9) = t659*b20+t688*b21+t711*b22;
  hessian(6,10) = t733*b20+t746*b21+t756*b22;
  hessian(6,11) = t778*b20+t791*b21+t801*b22;
  hessian(7,0) = t809*b20+t816*b21+t823*b22;
  hessian(7,1) = t1165;
  hessian(7,2) = 0.0;
  hessian(7,3) = t844*b20+t851*b21+t858*b22;
  hessian(7,4) = t1173;
  hessian(7,5) = 0.0;
  hessian(7,6) = t873*b20+t880*b21+t887*b22;
  hessian(7,7) = t1181;
  hessian(7,8) = 0.0;
  hessian(7,9) = t902*b20+t909*b21+t916*b22;
  hessian(7,10) = t1189;
  hessian(7,11) = 0.0;
  hessian(8,0) = t931*b20+t938*b21+t945*b22;
  hessian(8,1) = 0.0;
  hessian(8,2) = t1165;
  hessian(8,3) = t953*b20+t960*b21+t967*b22;
  hessian(8,4) = 0.0;
  hessian(8,5) = t1173;
  hessian(8,6) = t975*b20+t982*b21+t989*b22;
  hessian(8,7) = 0.0;
  hessian(8,8) = t1181;
  hessian(8,9) = t997*b20+t1004*b21+t1011*b22;
  hessian(8,10) = 0.0;
  hessian(8,11) = t1189;
  hessian(9,0) = t59*b30+t83*b31+t102*b32;
  hessian(9,1) = t140*b30+t154*b31+t165*b32;
  hessian(9,2) = t203*b30+t217*b31+t228*b32;
  hessian(9,3) = t276*b30+t306*b31+t329*b32;
  hessian(9,4) = t351*b30+t364*b31+t374*b32;
  hessian(9,5) = t396*b30+t409*b31+t419*b32;
  hessian(9,6) = t467*b30+t497*b31+t520*b32;
  hessian(9,7) = t542*b30+t555*b31+t565*b32;
  hessian(9,8) = t587*b30+t600*b31+t610*b32;
  hessian(9,9) = t659*b30+t688*b31+t711*b32;
  hessian(9,10) = t733*b30+t746*b31+t756*b32;
  hessian(9,11) = t778*b30+t791*b31+t801*b32;
  hessian(10,0) = t809*b30+t816*b31+t823*b32;
  hessian(10,1) = t1261;
  hessian(10,2) = 0.0;
  hessian(10,3) = t844*b30+t851*b31+t858*b32;
  hessian(10,4) = t1269;
  hessian(10,5) = 0.0;
  hessian(10,6) = t873*b30+t880*b31+t887*b32;
  hessian(10,7) = t1277;
  hessian(10,8) = 0.0;
  hessian(10,9) = t902*b30+t909*b31+t916*b32;
  hessian(10,10) = t1285;
  hessian(10,11) = 0.0;
  hessian(11,0) = t931*b30+t938*b31+t945*b32;
  hessian(11,1) = 0.0;
  hessian(11,2) = t1261;
  hessian(11,3) = t953*b30+t960*b31+t967*b32;
  hessian(11,4) = 0.0;
  hessian(11,5) = t1269;
  hessian(11,6) = t975*b30+t982*b31+t989*b32;
  hessian(11,7) = 0.0;
  hessian(11,8) = t1277;
  hessian(11,9) = t997*b30+t1004*b31+t1011*b32;
  hessian(11,10) = 0.0;
  hessian(11,11) = t1285;
   
}

void STVK::hessian1(MATRIX3& DmInv, const VEC3F* bVecs, const VEC3F* vertices, MATRIX& hessian)
{
  Real b00 = bVecs[0][0];
  Real b01 = bVecs[0][1];
  Real b02 = bVecs[0][2];
  Real b10 = bVecs[1][0];
  Real b11 = bVecs[1][1];
  Real b12 = bVecs[1][2];
  Real b20 = bVecs[2][0];
  Real b21 = bVecs[2][1];
  Real b22 = bVecs[2][2];
  Real b30 = bVecs[3][0];
  Real b31 = bVecs[3][1];
  Real b32 = bVecs[3][2];

  Real a = vertices[0][0];
  Real b = vertices[0][1];
  Real c = vertices[0][2];

  Real d = vertices[1][0];
  Real e = vertices[1][1];
  Real f = vertices[1][2];

  Real g = vertices[2][0];
  Real h = vertices[2][1];
  Real i = vertices[2][2];

  Real j = vertices[3][0];
  Real k = vertices[3][1];
  Real l = vertices[3][2];
 
  Real m = DmInv(0,0);
  Real n = DmInv(0,1);
  Real o = DmInv(0,2);
  Real p = DmInv(1,0);
  Real q = DmInv(1,1);
  Real r = DmInv(1,2);
  Real s = DmInv(2,0);
  Real t = DmInv(2,1);
  Real u = DmInv(2,2);

  Real t1 = -m-p-s;
  Real t2 = e-b;
  Real t4 = h-b;
  Real t6 = k-b;
  Real t8 = t2*m+t4*p+t6*s;
  Real t13 = t2*n+t4*q+t6*t;
  Real t14 = -n-q-t;
  Real t19 = t2*o+t4*r+t6*u;
  Real t20 = -o-r-u;
  Real t23 = _lambda*(t8*t1+t13*t14+t19*t20);
  Real t24 = _mu*t8;
  Real t27 = t23+2.0*t24*t1;
  Real t28 = t1*t27;
  Real t29 = t14*_mu;
  Real t32 = t1*t13+t8*t14;
  Real t33 = t29*t32/2.0;
  Real t35 = t20*_mu;
  Real t38 = t1*t19+t8*t20;
  Real t39 = t35*t38/2.0;
  Real t41 = t28+2.0*t33+2.0*t39;
  Real t43 = t1*_mu;
  Real t44 = t43*t32/2.0;
  Real t46 = _mu*t13;
  Real t49 = t23+2.0*t46*t14;
  Real t50 = t14*t49;
  Real t53 = t14*t19+t13*t20;
  Real t54 = t35*t53/2.0;
  Real t56 = 2.0*t44+t50+2.0*t54;
  Real t58 = t43*t38/2.0;
  Real t60 = t29*t53/2.0;
  Real t62 = _mu*t19;
  Real t65 = t23+2.0*t62*t20;
  Real t66 = t20*t65;
  Real t67 = 2.0*t58+2.0*t60+t66;
  Real t69 = t41*b00+t56*b01+t67*b02;
  Real t70 = d-a;
  Real t72 = g-a;
  Real t74 = j-a;
  Real t76 = t70*m+t72*p+t74*s;
  Real t77 = t1*t1;
  Real t78 = t14*t14;
  Real t79 = t20*t20;
  Real t81 = _lambda*(t77+t78+t79);
  Real t84 = t81+2.0*_mu*t77;
  Real t89 = t70*n+t72*q+t74*t;
  Real t90 = t89*_mu;
  Real t91 = t1*t14;
  Real t97 = t70*o+t72*r+t74*u;
  Real t98 = t97*_mu;
  Real t99 = t1*t20;
  Real t102 = t76*t84+2.0*t90*t91+2.0*t98*t99;
  Real t104 = t76*_mu;
  Real t109 = t81+2.0*_mu*t78;
  Real t111 = t14*t20;
  Real t114 = 2.0*t104*t91+t89*t109+2.0*t98*t111;
  Real t122 = t81+2.0*_mu*t79;
  Real t124 = 2.0*t104*t99+2.0*t90*t111+t97*t122;
  Real t127 = m*t27;
  Real t128 = n*_mu;
  Real t130 = t128*t32;
  Real t131 = o*_mu;
  Real t133 = t131*t38;
  Real t134 = t127+t130+t133;
  Real t136 = m*_mu;
  Real t138 = t136*t32;
  Real t139 = n*t49;
  Real t141 = t131*t53;
  Real t142 = t138+t139+t141;
  Real t145 = t136*t38;
  Real t147 = t128*t53;
  Real t148 = o*t65;
  Real t149 = t145+t147+t148;
  Real t151 = t134*b00+t142*b01+t149*b02;
  Real t156 = _lambda*(t1*m+t14*n+t20*o);
  Real t159 = t156+2.0*t43*m;
  Real t163 = m*t14+t1*n;
  Real t168 = m*t20+t1*o;
  Real t171 = t76*t159+t90*t163+t98*t168;
  Real t177 = t156+2.0*t29*n;
  Real t181 = n*t20+t14*o;
  Real t184 = t104*t163+t89*t177+t98*t181;
  Real t192 = t156+2.0*t35*o;
  Real t194 = t104*t168+t90*t181+t97*t192;
  Real t197 = p*t27;
  Real t198 = q*_mu;
  Real t200 = t198*t32;
  Real t201 = r*_mu;
  Real t203 = t201*t38;
  Real t204 = t197+t200+t203;
  Real t206 = p*_mu;
  Real t208 = t206*t32;
  Real t209 = q*t49;
  Real t211 = t201*t53;
  Real t212 = t208+t209+t211;
  Real t215 = t206*t38;
  Real t217 = t198*t53;
  Real t218 = r*t65;
  Real t219 = t215+t217+t218;
  Real t221 = t204*b00+t212*b01+t219*b02;
  Real t226 = _lambda*(t1*p+t14*q+t20*r);
  Real t229 = t226+2.0*t43*p;
  Real t233 = p*t14+t1*q;
  Real t238 = p*t20+t1*r;
  Real t241 = t76*t229+t90*t233+t98*t238;
  Real t247 = t226+2.0*t29*q;
  Real t251 = q*t20+t14*r;
  Real t254 = t104*t233+t89*t247+t98*t251;
  Real t262 = t226+2.0*t35*r;
  Real t264 = t104*t238+t90*t251+t97*t262;
  Real t267 = s*t27;
  Real t268 = t*_mu;
  Real t270 = t268*t32;
  Real t271 = u*_mu;
  Real t273 = t271*t38;
  Real t274 = t267+t270+t273;
  Real t276 = s*_mu;
  Real t278 = t276*t32;
  Real t279 = t*t49;
  Real t281 = t271*t53;
  Real t282 = t278+t279+t281;
  Real t285 = t276*t38;
  Real t287 = t268*t53;
  Real t288 = u*t65;
  Real t289 = t285+t287+t288;
  Real t291 = t274*b00+t282*b01+t289*b02;
  Real t296 = _lambda*(s*t1+t*t14+u*t20);
  Real t299 = t296+2.0*t276*t1;
  Real t303 = t1*t+s*t14;
  Real t308 = t1*u+s*t20;
  Real t311 = t76*t299+t90*t303+t98*t308;
  Real t317 = t296+2.0*t268*t14;
  Real t321 = t14*u+t*t20;
  Real t324 = t104*t303+t89*t317+t98*t321;
  Real t332 = t296+2.0*t271*t20;
  Real t334 = t104*t308+t90*t321+t97*t332;
  Real t341 = _lambda*(t76*t1+t89*t14+t97*t20);
  Real t348 = t1*t89+t76*t14;
  Real t353 = t1*t97+t76*t20;
  Real t356 = t1*(t341+2.0*t104*t1)+t29*t348+t35*t353;
  Real t366 = t14*t97+t89*t20;
  Real t369 = t43*t348+t14*(t341+2.0*t90*t14)+t35*t366;
  Real t379 = t43*t353+t29*t366+t20*(t341+2.0*t98*t20);
  Real t390 = 2.0*t28+t8*t84+4.0*t33+2.0*t46*t91+4.0*t39+2.0*t62*t99;
  Real t400 = 4.0*t44+2.0*t24*t91+2.0*t50+t13*t109+4.0*t54+2.0*t62*t111;
  Real t410 = 4.0*t58+2.0*t24*t99+4.0*t60+2.0*t46*t111+2.0*t66+t19*t122;
  Real t413 = f-c;
  Real t415 = i-c;
  Real t417 = l-c;
  Real t419 = t413*m+t415*p+t417*s;
  Real t424 = t413*n+t415*q+t417*t;
  Real t429 = t413*o+t415*r+t417*u;
  Real t432 = _lambda*(t419*t1+t424*t14+t429*t20);
  Real t433 = _mu*t419;
  Real t440 = t1*t424+t419*t14;
  Real t445 = t1*t429+t419*t20;
  Real t448 = t1*(t432+2.0*t433*t1)+t29*t440+t35*t445;
  Real t452 = _mu*t424;
  Real t459 = t14*t429+t424*t20;
  Real t462 = t43*t440+t14*(t432+2.0*t452*t14)+t35*t459;
  Real t468 = _mu*t429;
  Real t473 = t43*t445+t29*t459+t20*(t432+2.0*t468*t20);
  Real t480 = _lambda*(t76*m+t89*n+t97*o);
  Real t487 = m*t89+t76*n;
  Real t492 = m*t97+t76*o;
  Real t495 = t1*(t480+2.0*t104*m)+t29*t487+t35*t492;
  Real t505 = n*t97+t89*o;
  Real t508 = t43*t487+t14*(t480+2.0*t90*n)+t35*t505;
  Real t518 = t43*t492+t29*t505+t20*(t480+2.0*t98*o);
  Real t525 = _lambda*(t8*m+t13*n+t19*o);
  Real t533 = m*t13+t8*n;
  Real t540 = m*t19+t8*o;
  Real t545 = t127+t1*(t525+2.0*t24*m)+t8*t159+t130+t29*t533+t46*t163+t133+t35*t540+t62*t168;
  Real t558 = n*t19+t13*o;
  Real t563 = t138+t43*t533+t24*t163+t139+t14*(t525+2.0*t46*n)+t13*t177+t141+t35*t558+t62*t181;
  Real t578 = t145+t43*t540+t24*t168+t147+t29*t558+t46*t181+t148+t20*(t525+2.0*t62*o)+t19*t192;
  Real t585 = _lambda*(t419*m+t424*n+t429*o);
  Real t592 = m*t424+t419*n;
  Real t597 = m*t429+t419*o;
  Real t600 = t1*(t585+2.0*t433*m)+t29*t592+t35*t597;
  Real t610 = n*t429+t424*o;
  Real t613 = t43*t592+t14*(t585+2.0*t452*n)+t35*t610;
  Real t623 = t43*t597+t29*t610+t20*(t585+2.0*t468*o);
  Real t630 = _lambda*(t76*p+t89*q+t97*r);
  Real t637 = p*t89+t76*q;
  Real t642 = p*t97+t76*r;
  Real t645 = t1*(t630+2.0*t104*p)+t29*t637+t35*t642;
  Real t655 = q*t97+t89*r;
  Real t658 = t43*t637+t14*(t630+2.0*t90*q)+t35*t655;
  Real t668 = t43*t642+t29*t655+t20*(t630+2.0*t98*r);
  Real t675 = _lambda*(t8*p+t13*q+t19*r);
  Real t683 = p*t13+t8*q;
  Real t690 = p*t19+t8*r;
  Real t695 = t197+t1*(t675+2.0*t24*p)+t8*t229+t200+t29*t683+t46*t233+t203+t35*t690+t62*t238;
  Real t708 = q*t19+t13*r;
  Real t713 = t208+t43*t683+t24*t233+t209+t14*(t675+2.0*t46*q)+t13*t247+t211+t35*t708+t62*t251;
  Real t728 = t215+t43*t690+t24*t238+t217+t29*t708+t46*t251+t218+t20*(t675+2.0*t62*r)+t19*t262;
  Real t735 = _lambda*(t419*p+t424*q+t429*r);
  Real t742 = p*t424+t419*q;
  Real t747 = p*t429+t419*r;
  Real t750 = t1*(t735+2.0*t433*p)+t29*t742+t35*t747;
  Real t760 = q*t429+t424*r;
  Real t763 = t43*t742+t14*(t735+2.0*t452*q)+t35*t760;
  Real t773 = t43*t747+t29*t760+t20*(t735+2.0*t468*r);
  Real t780 = _lambda*(t76*s+t89*t+t97*u);
  Real t787 = s*t89+t76*t;
  Real t792 = s*t97+t76*u;
  Real t795 = t1*(t780+2.0*t104*s)+t29*t787+t35*t792;
  Real t805 = t*t97+t89*u;
  Real t808 = t43*t787+t14*(t780+2.0*t90*t)+t35*t805;
  Real t818 = t43*t792+t29*t805+t20*(t780+2.0*t98*u);
  Real t825 = _lambda*(t8*s+t13*t+t19*u);
  Real t833 = s*t13+t8*t;
  Real t840 = s*t19+t8*u;
  Real t845 = t267+t1*(t825+2.0*t24*s)+t8*t299+t270+t29*t833+t46*t303+t273+t35*t840+t62*t308;
  Real t858 = t*t19+t13*u;
  Real t863 = t278+t43*t833+t24*t303+t279+t14*(t825+2.0*t46*t)+t13*t317+t281+t35*t858+t62*t321;
  Real t878 = t285+t43*t840+t24*t308+t287+t29*t858+t46*t321+t288+t20*(t825+2.0*t62*u)+t19*t332;
  Real t885 = _lambda*(t419*s+t424*t+t429*u);
  Real t892 = s*t424+t419*t;
  Real t897 = s*t429+t419*u;
  Real t900 = t1*(t885+2.0*t433*s)+t29*t892+t35*t897;
  Real t910 = t*t429+t424*u;
  Real t913 = t43*t892+t14*(t885+2.0*t452*t)+t35*t910;
  Real t923 = t43*t897+t29*t910+t20*(t885+2.0*t468*u);
  Real t931 = t419*t84+2.0*t452*t91+2.0*t468*t99;
  Real t938 = 2.0*t433*t91+t424*t109+2.0*t468*t111;
  Real t945 = 2.0*t433*t99+2.0*t452*t111+t429*t122;
  Real t953 = t419*t159+t452*t163+t468*t168;
  Real t960 = t433*t163+t424*t177+t468*t181;
  Real t967 = t433*t168+t452*t181+t429*t192;
  Real t975 = t419*t229+t452*t233+t468*t238;
  Real t982 = t433*t233+t424*t247+t468*t251;
  Real t989 = t433*t238+t452*t251+t429*t262;
  Real t997 = t419*t299+t452*t303+t468*t308;
  Real t1004 = t433*t303+t424*t317+t468*t321;
  Real t1011 = t433*t308+t452*t321+t429*t332;
  Real t1017 = t41*b10+t56*b11+t67*b12;
  Real t1025 = t134*b10+t142*b11+t149*b12;
  Real t1033 = t204*b10+t212*b11+t219*b12;
  Real t1041 = t274*b10+t282*b11+t289*b12;
  Real t1113 = t41*b20+t56*b21+t67*b22;
  Real t1121 = t134*b20+t142*b21+t149*b22;
  Real t1129 = t204*b20+t212*b21+t219*b22;
  Real t1137 = t274*b20+t282*b21+t289*b22;
  Real t1209 = t41*b30+t56*b31+t67*b32;
  Real t1217 = t134*b30+t142*b31+t149*b32;
  Real t1225 = t204*b30+t212*b31+t219*b32;
  Real t1233 = t274*b30+t282*b31+t289*b32;
  hessian(0,0) = t69;
  hessian(0,1) = t102*b00+t114*b01+t124*b02;
  hessian(0,2) = 0.0;
  hessian(0,3) = t151;
  hessian(0,4) = t171*b00+t184*b01+t194*b02;
  hessian(0,5) = 0.0;
  hessian(0,6) = t221;
  hessian(0,7) = t241*b00+t254*b01+t264*b02;
  hessian(0,8) = 0.0;
  hessian(0,9) = t291;
  hessian(0,10) = t311*b00+t324*b01+t334*b02;
  hessian(0,11) = 0.0;
  hessian(1,0) = t356*b00+t369*b01+t379*b02;
  hessian(1,1) = t390*b00+t400*b01+t410*b02;
  hessian(1,2) = t448*b00+t462*b01+t473*b02;
  hessian(1,3) = t495*b00+t508*b01+t518*b02;
  hessian(1,4) = t545*b00+t563*b01+t578*b02;
  hessian(1,5) = t600*b00+t613*b01+t623*b02;
  hessian(1,6) = t645*b00+t658*b01+t668*b02;
  hessian(1,7) = t695*b00+t713*b01+t728*b02;
  hessian(1,8) = t750*b00+t763*b01+t773*b02;
  hessian(1,9) = t795*b00+t808*b01+t818*b02;
  hessian(1,10) = t845*b00+t863*b01+t878*b02;
  hessian(1,11) = t900*b00+t913*b01+t923*b02;
  hessian(2,0) = 0.0;
  hessian(2,1) = t931*b00+t938*b01+t945*b02;
  hessian(2,2) = t69;
  hessian(2,3) = 0.0;
  hessian(2,4) = t953*b00+t960*b01+t967*b02;
  hessian(2,5) = t151;
  hessian(2,6) = 0.0;
  hessian(2,7) = t975*b00+t982*b01+t989*b02;
  hessian(2,8) = t221;
  hessian(2,9) = 0.0;
  hessian(2,10) = t997*b00+t1004*b01+t1011*b02;
  hessian(2,11) = t291;
  hessian(3,0) = t1017;
  hessian(3,1) = t102*b10+t114*b11+t124*b12;
  hessian(3,2) = 0.0;
  hessian(3,3) = t1025;
  hessian(3,4) = t171*b10+t184*b11+t194*b12;
  hessian(3,5) = 0.0;
  hessian(3,6) = t1033;
  hessian(3,7) = t241*b10+t254*b11+t264*b12;
  hessian(3,8) = 0.0;
  hessian(3,9) = t1041;
  hessian(3,10) = t311*b10+t324*b11+t334*b12;
  hessian(3,11) = 0.0;
  hessian(4,0) = t356*b10+t369*b11+t379*b12;
  hessian(4,1) = t390*b10+t400*b11+t410*b12;
  hessian(4,2) = t448*b10+t462*b11+t473*b12;
  hessian(4,3) = t495*b10+t508*b11+t518*b12;
  hessian(4,4) = t545*b10+t563*b11+t578*b12;
  hessian(4,5) = t600*b10+t613*b11+t623*b12;
  hessian(4,6) = t645*b10+t658*b11+t668*b12;
  hessian(4,7) = t695*b10+t713*b11+t728*b12;
  hessian(4,8) = t750*b10+t763*b11+t773*b12;
  hessian(4,9) = t795*b10+t808*b11+t818*b12;
  hessian(4,10) = t845*b10+t863*b11+t878*b12;
  hessian(4,11) = t900*b10+t913*b11+t923*b12;
  hessian(5,0) = 0.0;
  hessian(5,1) = t931*b10+t938*b11+t945*b12;
  hessian(5,2) = t1017;
  hessian(5,3) = 0.0;
  hessian(5,4) = t953*b10+t960*b11+t967*b12;
  hessian(5,5) = t1025;
  hessian(5,6) = 0.0;
  hessian(5,7) = t975*b10+t982*b11+t989*b12;
  hessian(5,8) = t1033;
  hessian(5,9) = 0.0;
  hessian(5,10) = t997*b10+t1004*b11+t1011*b12;
  hessian(5,11) = t1041;
  hessian(6,0) = t1113;
  hessian(6,1) = t102*b20+t114*b21+t124*b22;
  hessian(6,2) = 0.0;
  hessian(6,3) = t1121;
  hessian(6,4) = t171*b20+t184*b21+t194*b22;
  hessian(6,5) = 0.0;
  hessian(6,6) = t1129;
  hessian(6,7) = t241*b20+t254*b21+t264*b22;
  hessian(6,8) = 0.0;
  hessian(6,9) = t1137;
  hessian(6,10) = t311*b20+t324*b21+t334*b22;
  hessian(6,11) = 0.0;
  hessian(7,0) = t356*b20+t369*b21+t379*b22;
  hessian(7,1) = t390*b20+t400*b21+t410*b22;
  hessian(7,2) = t448*b20+t462*b21+t473*b22;
  hessian(7,3) = t495*b20+t508*b21+t518*b22;
  hessian(7,4) = t545*b20+t563*b21+t578*b22;
  hessian(7,5) = t600*b20+t613*b21+t623*b22;
  hessian(7,6) = t645*b20+t658*b21+t668*b22;
  hessian(7,7) = t695*b20+t713*b21+t728*b22;
  hessian(7,8) = t750*b20+t763*b21+t773*b22;
  hessian(7,9) = t795*b20+t808*b21+t818*b22;
  hessian(7,10) = t845*b20+t863*b21+t878*b22;
  hessian(7,11) = t900*b20+t913*b21+t923*b22;
  hessian(8,0) = 0.0;
  hessian(8,1) = t931*b20+t938*b21+t945*b22;
  hessian(8,2) = t1113;
  hessian(8,3) = 0.0;
  hessian(8,4) = t953*b20+t960*b21+t967*b22;
  hessian(8,5) = t1121;
  hessian(8,6) = 0.0;
  hessian(8,7) = t975*b20+t982*b21+t989*b22;
  hessian(8,8) = t1129;
  hessian(8,9) = 0.0;
  hessian(8,10) = t997*b20+t1004*b21+t1011*b22;
  hessian(8,11) = t1137;
  hessian(9,0) = t1209;
  hessian(9,1) = t102*b30+t114*b31+t124*b32;
  hessian(9,2) = 0.0;
  hessian(9,3) = t1217;
  hessian(9,4) = t171*b30+t184*b31+t194*b32;
  hessian(9,5) = 0.0;
  hessian(9,6) = t1225;
  hessian(9,7) = t241*b30+t254*b31+t264*b32;
  hessian(9,8) = 0.0;
  hessian(9,9) = t1233;
  hessian(9,10) = t311*b30+t324*b31+t334*b32;
  hessian(9,11) = 0.0;
  hessian(10,0) = t356*b30+t369*b31+t379*b32;
  hessian(10,1) = t390*b30+t400*b31+t410*b32;
  hessian(10,2) = t448*b30+t462*b31+t473*b32;
  hessian(10,3) = t495*b30+t508*b31+t518*b32;
  hessian(10,4) = t545*b30+t563*b31+t578*b32;
  hessian(10,5) = t600*b30+t613*b31+t623*b32;
  hessian(10,6) = t645*b30+t658*b31+t668*b32;
  hessian(10,7) = t695*b30+t713*b31+t728*b32;
  hessian(10,8) = t750*b30+t763*b31+t773*b32;
  hessian(10,9) = t795*b30+t808*b31+t818*b32;
  hessian(10,10) = t845*b30+t863*b31+t878*b32;
  hessian(10,11) = t900*b30+t913*b31+t923*b32;
  hessian(11,0) = 0.0;
  hessian(11,1) = t931*b30+t938*b31+t945*b32;
  hessian(11,2) = t1209;
  hessian(11,3) = 0.0;
  hessian(11,4) = t953*b30+t960*b31+t967*b32;
  hessian(11,5) = t1217;
  hessian(11,6) = 0.0;
  hessian(11,7) = t975*b30+t982*b31+t989*b32;
  hessian(11,8) = t1225;
  hessian(11,9) = 0.0;
  hessian(11,10) = t997*b30+t1004*b31+t1011*b32;
  hessian(11,11) = t1233;
   
}

void STVK::hessian2(MATRIX3& DmInv, const VEC3F* bVecs, const VEC3F* vertices, MATRIX& hessian)
{
  Real b00 = bVecs[0][0];
  Real b01 = bVecs[0][1];
  Real b02 = bVecs[0][2];
  Real b10 = bVecs[1][0];
  Real b11 = bVecs[1][1];
  Real b12 = bVecs[1][2];
  Real b20 = bVecs[2][0];
  Real b21 = bVecs[2][1];
  Real b22 = bVecs[2][2];
  Real b30 = bVecs[3][0];
  Real b31 = bVecs[3][1];
  Real b32 = bVecs[3][2];

  Real a = vertices[0][0];
  Real b = vertices[0][1];
  Real c = vertices[0][2];

  Real d = vertices[1][0];
  Real e = vertices[1][1];
  Real f = vertices[1][2];

  Real g = vertices[2][0];
  Real h = vertices[2][1];
  Real i = vertices[2][2];

  Real j = vertices[3][0];
  Real k = vertices[3][1];
  Real l = vertices[3][2];
 
  Real m = DmInv(0,0);
  Real n = DmInv(0,1);
  Real o = DmInv(0,2);
  Real p = DmInv(1,0);
  Real q = DmInv(1,1);
  Real r = DmInv(1,2);
  Real s = DmInv(2,0);
  Real t = DmInv(2,1);
  Real u = DmInv(2,2);

  Real t1 = -m-p-s;
  Real t2 = f-c;
  Real t4 = i-c;
  Real t6 = l-c;
  Real t8 = t2*m+t4*p+t6*s;
  Real t13 = t2*n+t4*q+t6*t;
  Real t14 = -n-q-t;
  Real t19 = t2*o+t4*r+t6*u;
  Real t20 = -o-r-u;
  Real t23 = _lambda*(t8*t1+t13*t14+t19*t20);
  Real t24 = _mu*t8;
  Real t27 = t23+2.0*t24*t1;
  Real t28 = t1*t27;
  Real t29 = t14*_mu;
  Real t32 = t1*t13+t8*t14;
  Real t33 = t29*t32/2.0;
  Real t35 = t20*_mu;
  Real t38 = t1*t19+t8*t20;
  Real t39 = t35*t38/2.0;
  Real t41 = t28+2.0*t33+2.0*t39;
  Real t43 = t1*_mu;
  Real t44 = t43*t32/2.0;
  Real t46 = _mu*t13;
  Real t49 = t23+2.0*t46*t14;
  Real t50 = t14*t49;
  Real t53 = t14*t19+t13*t20;
  Real t54 = t35*t53/2.0;
  Real t56 = 2.0*t44+t50+2.0*t54;
  Real t58 = t43*t38/2.0;
  Real t60 = t29*t53/2.0;
  Real t62 = _mu*t19;
  Real t65 = t23+2.0*t62*t20;
  Real t66 = t20*t65;
  Real t67 = 2.0*t58+2.0*t60+t66;
  Real t69 = t41*b00+t56*b01+t67*b02;
  Real t70 = d-a;
  Real t72 = g-a;
  Real t74 = j-a;
  Real t76 = t70*m+t72*p+t74*s;
  Real t77 = t1*t1;
  Real t78 = t14*t14;
  Real t79 = t20*t20;
  Real t81 = _lambda*(t77+t78+t79);
  Real t84 = t81+2.0*_mu*t77;
  Real t89 = t70*n+t72*q+t74*t;
  Real t90 = t89*_mu;
  Real t91 = t1*t14;
  Real t97 = t70*o+t72*r+t74*u;
  Real t98 = t97*_mu;
  Real t99 = t1*t20;
  Real t102 = t76*t84+2.0*t90*t91+2.0*t98*t99;
  Real t104 = t76*_mu;
  Real t109 = t81+2.0*_mu*t78;
  Real t111 = t14*t20;
  Real t114 = 2.0*t104*t91+t89*t109+2.0*t98*t111;
  Real t122 = t81+2.0*_mu*t79;
  Real t124 = 2.0*t104*t99+2.0*t90*t111+t97*t122;
  Real t127 = m*t27;
  Real t128 = n*_mu;
  Real t130 = t128*t32;
  Real t131 = o*_mu;
  Real t133 = t131*t38;
  Real t134 = t127+t130+t133;
  Real t136 = m*_mu;
  Real t138 = t136*t32;
  Real t139 = n*t49;
  Real t141 = t131*t53;
  Real t142 = t138+t139+t141;
  Real t145 = t136*t38;
  Real t147 = t128*t53;
  Real t148 = o*t65;
  Real t149 = t145+t147+t148;
  Real t151 = t134*b00+t142*b01+t149*b02;
  Real t156 = _lambda*(t1*m+t14*n+t20*o);
  Real t159 = t156+2.0*t43*m;
  Real t163 = m*t14+t1*n;
  Real t168 = m*t20+t1*o;
  Real t171 = t76*t159+t90*t163+t98*t168;
  Real t177 = t156+2.0*t29*n;
  Real t181 = n*t20+t14*o;
  Real t184 = t104*t163+t89*t177+t98*t181;
  Real t192 = t156+2.0*t35*o;
  Real t194 = t104*t168+t90*t181+t97*t192;
  Real t197 = p*t27;
  Real t198 = q*_mu;
  Real t200 = t198*t32;
  Real t201 = r*_mu;
  Real t203 = t201*t38;
  Real t204 = t197+t200+t203;
  Real t206 = p*_mu;
  Real t208 = t206*t32;
  Real t209 = q*t49;
  Real t211 = t201*t53;
  Real t212 = t208+t209+t211;
  Real t215 = t206*t38;
  Real t217 = t198*t53;
  Real t218 = r*t65;
  Real t219 = t215+t217+t218;
  Real t221 = t204*b00+t212*b01+t219*b02;
  Real t226 = _lambda*(t1*p+t14*q+t20*r);
  Real t229 = t226+2.0*t43*p;
  Real t233 = p*t14+t1*q;
  Real t238 = p*t20+t1*r;
  Real t241 = t76*t229+t90*t233+t98*t238;
  Real t247 = t226+2.0*t29*q;
  Real t251 = q*t20+t14*r;
  Real t254 = t104*t233+t89*t247+t98*t251;
  Real t262 = t226+2.0*t35*r;
  Real t264 = t104*t238+t90*t251+t97*t262;
  Real t267 = s*t27;
  Real t268 = t*_mu;
  Real t270 = t268*t32;
  Real t271 = u*_mu;
  Real t273 = t271*t38;
  Real t274 = t267+t270+t273;
  Real t276 = s*_mu;
  Real t278 = t276*t32;
  Real t279 = t*t49;
  Real t281 = t271*t53;
  Real t282 = t278+t279+t281;
  Real t285 = t276*t38;
  Real t287 = t268*t53;
  Real t288 = u*t65;
  Real t289 = t285+t287+t288;
  Real t291 = t274*b00+t282*b01+t289*b02;
  Real t296 = _lambda*(s*t1+t*t14+u*t20);
  Real t299 = t296+2.0*t276*t1;
  Real t303 = t1*t+s*t14;
  Real t308 = t1*u+s*t20;
  Real t311 = t76*t299+t90*t303+t98*t308;
  Real t317 = t296+2.0*t268*t14;
  Real t321 = t14*u+t*t20;
  Real t324 = t104*t303+t89*t317+t98*t321;
  Real t332 = t296+2.0*t271*t20;
  Real t334 = t104*t308+t90*t321+t97*t332;
  Real t337 = e-b;
  Real t339 = h-b;
  Real t341 = k-b;
  Real t343 = t337*m+t339*p+t341*s;
  Real t348 = t337*n+t339*q+t341*t;
  Real t349 = t348*_mu;
  Real t355 = t337*o+t339*r+t341*u;
  Real t356 = t355*_mu;
  Real t359 = t343*t84+2.0*t349*t91+2.0*t356*t99;
  Real t361 = t343*_mu;
  Real t367 = 2.0*t361*t91+t348*t109+2.0*t356*t111;
  Real t374 = 2.0*t361*t99+2.0*t349*t111+t355*t122;
  Real t382 = t343*t159+t349*t163+t356*t168;
  Real t389 = t361*t163+t348*t177+t356*t181;
  Real t396 = t361*t168+t349*t181+t355*t192;
  Real t404 = t343*t229+t349*t233+t356*t238;
  Real t411 = t361*t233+t348*t247+t356*t251;
  Real t418 = t361*t238+t349*t251+t355*t262;
  Real t426 = t343*t299+t349*t303+t356*t308;
  Real t433 = t361*t303+t348*t317+t356*t321;
  Real t440 = t361*t308+t349*t321+t355*t332;
  Real t447 = _lambda*(t76*t1+t89*t14+t97*t20);
  Real t454 = t1*t89+t76*t14;
  Real t459 = t1*t97+t76*t20;
  Real t462 = t1*(t447+2.0*t104*t1)+t29*t454+t35*t459;
  Real t472 = t14*t97+t89*t20;
  Real t475 = t43*t454+t14*(t447+2.0*t90*t14)+t35*t472;
  Real t485 = t43*t459+t29*t472+t20*(t447+2.0*t98*t20);
  Real t492 = _lambda*(t343*t1+t348*t14+t355*t20);
  Real t499 = t1*t348+t343*t14;
  Real t504 = t1*t355+t343*t20;
  Real t507 = t1*(t492+2.0*t361*t1)+t29*t499+t35*t504;
  Real t517 = t14*t355+t348*t20;
  Real t520 = t43*t499+t14*(t492+2.0*t349*t14)+t35*t517;
  Real t530 = t43*t504+t29*t517+t20*(t492+2.0*t356*t20);
  Real t541 = 2.0*t28+t8*t84+4.0*t33+2.0*t46*t91+4.0*t39+2.0*t62*t99;
  Real t551 = 4.0*t44+2.0*t24*t91+2.0*t50+t13*t109+4.0*t54+2.0*t62*t111;
  Real t561 = 4.0*t58+2.0*t24*t99+4.0*t60+2.0*t46*t111+2.0*t66+t19*t122;
  Real t568 = _lambda*(t76*m+t89*n+t97*o);
  Real t575 = m*t89+t76*n;
  Real t580 = m*t97+t76*o;
  Real t583 = t1*(t568+2.0*t104*m)+t29*t575+t35*t580;
  Real t593 = n*t97+t89*o;
  Real t596 = t43*t575+t14*(t568+2.0*t90*n)+t35*t593;
  Real t606 = t43*t580+t29*t593+t20*(t568+2.0*t98*o);
  Real t613 = _lambda*(t343*m+t348*n+t355*o);
  Real t620 = m*t348+t343*n;
  Real t625 = m*t355+t343*o;
  Real t628 = t1*(t613+2.0*t361*m)+t29*t620+t35*t625;
  Real t638 = n*t355+t348*o;
  Real t641 = t43*t620+t14*(t613+2.0*t349*n)+t35*t638;
  Real t651 = t43*t625+t29*t638+t20*(t613+2.0*t356*o);
  Real t658 = _lambda*(t8*m+t13*n+t19*o);
  Real t666 = m*t13+t8*n;
  Real t673 = m*t19+t8*o;
  Real t678 = t127+t1*(t658+2.0*t24*m)+t8*t159+t130+t29*t666+t46*t163+t133+t35*t673+t62*t168;
  Real t691 = n*t19+t13*o;
  Real t696 = t138+t43*t666+t24*t163+t139+t14*(t658+2.0*t46*n)+t13*t177+t141+t35*t691+t62*t181;
  Real t711 = t145+t43*t673+t24*t168+t147+t29*t691+t46*t181+t148+t20*(t658+2.0*t62*o)+t19*t192;
  Real t718 = _lambda*(t76*p+t89*q+t97*r);
  Real t725 = p*t89+t76*q;
  Real t730 = p*t97+t76*r;
  Real t733 = t1*(t718+2.0*t104*p)+t29*t725+t35*t730;
  Real t743 = q*t97+t89*r;
  Real t746 = t43*t725+t14*(t718+2.0*t90*q)+t35*t743;
  Real t756 = t43*t730+t29*t743+t20*(t718+2.0*t98*r);
  Real t763 = _lambda*(t343*p+t348*q+t355*r);
  Real t770 = p*t348+t343*q;
  Real t775 = p*t355+t343*r;
  Real t778 = t1*(t763+2.0*t361*p)+t29*t770+t35*t775;
  Real t788 = q*t355+t348*r;
  Real t791 = t43*t770+t14*(t763+2.0*t349*q)+t35*t788;
  Real t801 = t43*t775+t29*t788+t20*(t763+2.0*t356*r);
  Real t808 = _lambda*(t8*p+t13*q+t19*r);
  Real t816 = p*t13+t8*q;
  Real t823 = p*t19+t8*r;
  Real t828 = t197+t1*(t808+2.0*t24*p)+t8*t229+t200+t29*t816+t46*t233+t203+t35*t823+t62*t238;
  Real t841 = q*t19+t13*r;
  Real t846 = t208+t43*t816+t24*t233+t209+t14*(t808+2.0*t46*q)+t13*t247+t211+t35*t841+t62*t251;
  Real t861 = t215+t43*t823+t24*t238+t217+t29*t841+t46*t251+t218+t20*(t808+2.0*t62*r)+t19*t262;
  Real t868 = _lambda*(t76*s+t89*t+t97*u);
  Real t875 = s*t89+t76*t;
  Real t880 = s*t97+t76*u;
  Real t883 = t1*(t868+2.0*t104*s)+t29*t875+t35*t880;
  Real t893 = t*t97+t89*u;
  Real t896 = t43*t875+t14*(t868+2.0*t90*t)+t35*t893;
  Real t906 = t43*t880+t29*t893+t20*(t868+2.0*t98*u);
  Real t913 = _lambda*(t343*s+t348*t+t355*u);
  Real t920 = s*t348+t343*t;
  Real t925 = s*t355+t343*u;
  Real t928 = t1*(t913+2.0*t361*s)+t29*t920+t35*t925;
  Real t938 = t*t355+t348*u;
  Real t941 = t43*t920+t14*(t913+2.0*t349*t)+t35*t938;
  Real t951 = t43*t925+t29*t938+t20*(t913+2.0*t356*u);
  Real t958 = _lambda*(t8*s+t13*t+t19*u);
  Real t966 = s*t13+t8*t;
  Real t973 = s*t19+t8*u;
  Real t978 = t267+t1*(t958+2.0*t24*s)+t8*t299+t270+t29*t966+t46*t303+t273+t35*t973+t62*t308;
  Real t991 = t*t19+t13*u;
  Real t996 = t278+t43*t966+t24*t303+t279+t14*(t958+2.0*t46*t)+t13*t317+t281+t35*t991+t62*t321;
  Real t1011 = t285+t43*t973+t24*t308+t287+t29*t991+t46*t321+t288+t20*(t958+2.0*t62*u)+t19*t332;
  Real t1017 = t41*b10+t56*b11+t67*b12;
  Real t1025 = t134*b10+t142*b11+t149*b12;
  Real t1033 = t204*b10+t212*b11+t219*b12;
  Real t1041 = t274*b10+t282*b11+t289*b12;
  Real t1113 = t41*b20+t56*b21+t67*b22;
  Real t1121 = t134*b20+t142*b21+t149*b22;
  Real t1129 = t204*b20+t212*b21+t219*b22;
  Real t1137 = t274*b20+t282*b21+t289*b22;
  Real t1209 = t41*b30+t56*b31+t67*b32;
  Real t1217 = t134*b30+t142*b31+t149*b32;
  Real t1225 = t204*b30+t212*b31+t219*b32;
  Real t1233 = t274*b30+t282*b31+t289*b32;
  hessian(0,0) = t69;
  hessian(0,1) = 0.0;
  hessian(0,2) = t102*b00+t114*b01+t124*b02;
  hessian(0,3) = t151;
  hessian(0,4) = 0.0;
  hessian(0,5) = t171*b00+t184*b01+t194*b02;
  hessian(0,6) = t221;
  hessian(0,7) = 0.0;
  hessian(0,8) = t241*b00+t254*b01+t264*b02;
  hessian(0,9) = t291;
  hessian(0,10) = 0.0;
  hessian(0,11) = t311*b00+t324*b01+t334*b02;
  hessian(1,0) = 0.0;
  hessian(1,1) = t69;
  hessian(1,2) = t359*b00+t367*b01+t374*b02;
  hessian(1,3) = 0.0;
  hessian(1,4) = t151;
  hessian(1,5) = t382*b00+t389*b01+t396*b02;
  hessian(1,6) = 0.0;
  hessian(1,7) = t221;
  hessian(1,8) = t404*b00+t411*b01+t418*b02;
  hessian(1,9) = 0.0;
  hessian(1,10) = t291;
  hessian(1,11) = t426*b00+t433*b01+t440*b02;
  hessian(2,0) = t462*b00+t475*b01+t485*b02;
  hessian(2,1) = t507*b00+t520*b01+t530*b02;
  hessian(2,2) = t541*b00+t551*b01+t561*b02;
  hessian(2,3) = t583*b00+t596*b01+t606*b02;
  hessian(2,4) = t628*b00+t641*b01+t651*b02;
  hessian(2,5) = t678*b00+t696*b01+t711*b02;
  hessian(2,6) = t733*b00+t746*b01+t756*b02;
  hessian(2,7) = t778*b00+t791*b01+t801*b02;
  hessian(2,8) = t828*b00+t846*b01+t861*b02;
  hessian(2,9) = t883*b00+t896*b01+t906*b02;
  hessian(2,10) = t928*b00+t941*b01+t951*b02;
  hessian(2,11) = t978*b00+t996*b01+t1011*b02;
  hessian(3,0) = t1017;
  hessian(3,1) = 0.0;
  hessian(3,2) = t102*b10+t114*b11+t124*b12;
  hessian(3,3) = t1025;
  hessian(3,4) = 0.0;
  hessian(3,5) = t171*b10+t184*b11+t194*b12;
  hessian(3,6) = t1033;
  hessian(3,7) = 0.0;
  hessian(3,8) = t241*b10+t254*b11+t264*b12;
  hessian(3,9) = t1041;
  hessian(3,10) = 0.0;
  hessian(3,11) = t311*b10+t324*b11+t334*b12;
  hessian(4,0) = 0.0;
  hessian(4,1) = t1017;
  hessian(4,2) = t359*b10+t367*b11+t374*b12;
  hessian(4,3) = 0.0;
  hessian(4,4) = t1025;
  hessian(4,5) = t382*b10+t389*b11+t396*b12;
  hessian(4,6) = 0.0;
  hessian(4,7) = t1033;
  hessian(4,8) = t404*b10+t411*b11+t418*b12;
  hessian(4,9) = 0.0;
  hessian(4,10) = t1041;
  hessian(4,11) = t426*b10+t433*b11+t440*b12;
  hessian(5,0) = t462*b10+t475*b11+t485*b12;
  hessian(5,1) = t507*b10+t520*b11+t530*b12;
  hessian(5,2) = t541*b10+t551*b11+t561*b12;
  hessian(5,3) = t583*b10+t596*b11+t606*b12;
  hessian(5,4) = t628*b10+t641*b11+t651*b12;
  hessian(5,5) = t678*b10+t696*b11+t711*b12;
  hessian(5,6) = t733*b10+t746*b11+t756*b12;
  hessian(5,7) = t778*b10+t791*b11+t801*b12;
  hessian(5,8) = t828*b10+t846*b11+t861*b12;
  hessian(5,9) = t883*b10+t896*b11+t906*b12;
  hessian(5,10) = t928*b10+t941*b11+t951*b12;
  hessian(5,11) = t978*b10+t996*b11+t1011*b12;
  hessian(6,0) = t1113;
  hessian(6,1) = 0.0;
  hessian(6,2) = t102*b20+t114*b21+t124*b22;
  hessian(6,3) = t1121;
  hessian(6,4) = 0.0;
  hessian(6,5) = t171*b20+t184*b21+t194*b22;
  hessian(6,6) = t1129;
  hessian(6,7) = 0.0;
  hessian(6,8) = t241*b20+t254*b21+t264*b22;
  hessian(6,9) = t1137;
  hessian(6,10) = 0.0;
  hessian(6,11) = t311*b20+t324*b21+t334*b22;
  hessian(7,0) = 0.0;
  hessian(7,1) = t1113;
  hessian(7,2) = t359*b20+t367*b21+t374*b22;
  hessian(7,3) = 0.0;
  hessian(7,4) = t1121;
  hessian(7,5) = t382*b20+t389*b21+t396*b22;
  hessian(7,6) = 0.0;
  hessian(7,7) = t1129;
  hessian(7,8) = t404*b20+t411*b21+t418*b22;
  hessian(7,9) = 0.0;
  hessian(7,10) = t1137;
  hessian(7,11) = t426*b20+t433*b21+t440*b22;
  hessian(8,0) = t462*b20+t475*b21+t485*b22;
  hessian(8,1) = t507*b20+t520*b21+t530*b22;
  hessian(8,2) = t541*b20+t551*b21+t561*b22;
  hessian(8,3) = t583*b20+t596*b21+t606*b22;
  hessian(8,4) = t628*b20+t641*b21+t651*b22;
  hessian(8,5) = t678*b20+t696*b21+t711*b22;
  hessian(8,6) = t733*b20+t746*b21+t756*b22;
  hessian(8,7) = t778*b20+t791*b21+t801*b22;
  hessian(8,8) = t828*b20+t846*b21+t861*b22;
  hessian(8,9) = t883*b20+t896*b21+t906*b22;
  hessian(8,10) = t928*b20+t941*b21+t951*b22;
  hessian(8,11) = t978*b20+t996*b21+t1011*b22;
  hessian(9,0) = t1209;
  hessian(9,1) = 0.0;
  hessian(9,2) = t102*b30+t114*b31+t124*b32;
  hessian(9,3) = t1217;
  hessian(9,4) = 0.0;
  hessian(9,5) = t171*b30+t184*b31+t194*b32;
  hessian(9,6) = t1225;
  hessian(9,7) = 0.0;
  hessian(9,8) = t241*b30+t254*b31+t264*b32;
  hessian(9,9) = t1233;
  hessian(9,10) = 0.0;
  hessian(9,11) = t311*b30+t324*b31+t334*b32;
  hessian(10,0) = 0.0;
  hessian(10,1) = t1209;
  hessian(10,2) = t359*b30+t367*b31+t374*b32;
  hessian(10,3) = 0.0;
  hessian(10,4) = t1217;
  hessian(10,5) = t382*b30+t389*b31+t396*b32;
  hessian(10,6) = 0.0;
  hessian(10,7) = t1225;
  hessian(10,8) = t404*b30+t411*b31+t418*b32;
  hessian(10,9) = 0.0;
  hessian(10,10) = t1233;
  hessian(10,11) = t426*b30+t433*b31+t440*b32;
  hessian(11,0) = t462*b30+t475*b31+t485*b32;
  hessian(11,1) = t507*b30+t520*b31+t530*b32;
  hessian(11,2) = t541*b30+t551*b31+t561*b32;
  hessian(11,3) = t583*b30+t596*b31+t606*b32;
  hessian(11,4) = t628*b30+t641*b31+t651*b32;
  hessian(11,5) = t678*b30+t696*b31+t711*b32;
  hessian(11,6) = t733*b30+t746*b31+t756*b32;
  hessian(11,7) = t778*b30+t791*b31+t801*b32;
  hessian(11,8) = t828*b30+t846*b31+t861*b32;
  hessian(11,9) = t883*b30+t896*b31+t906*b32;
  hessian(11,10) = t928*b30+t941*b31+t951*b32;
  hessian(11,11) = t978*b30+t996*b31+t1011*b32;
   
}

void STVK::hessian3(MATRIX3& DmInv, const VEC3F* bVecs, const VEC3F* vertices, MATRIX& hessian)
{
  Real b00 = bVecs[0][0];
  Real b01 = bVecs[0][1];
  Real b02 = bVecs[0][2];
  Real b10 = bVecs[1][0];
  Real b11 = bVecs[1][1];
  Real b12 = bVecs[1][2];
  Real b20 = bVecs[2][0];
  Real b21 = bVecs[2][1];
  Real b22 = bVecs[2][2];
  Real b30 = bVecs[3][0];
  Real b31 = bVecs[3][1];
  Real b32 = bVecs[3][2];

  Real a = vertices[0][0];
  Real b = vertices[0][1];
  Real c = vertices[0][2];

  Real d = vertices[1][0];
  Real e = vertices[1][1];
  Real f = vertices[1][2];

  Real g = vertices[2][0];
  Real h = vertices[2][1];
  Real i = vertices[2][2];

  Real j = vertices[3][0];
  Real k = vertices[3][1];
  Real l = vertices[3][2];
 
  Real m = DmInv(0,0);
  Real n = DmInv(0,1);
  Real o = DmInv(0,2);
  Real p = DmInv(1,0);
  Real q = DmInv(1,1);
  Real r = DmInv(1,2);
  Real s = DmInv(2,0);
  Real t = DmInv(2,1);
  Real u = DmInv(2,2);

  Real t1 = -m-p-s;
  Real t2 = d-a;
  Real t4 = g-a;
  Real t6 = j-a;
  Real t8 = t2*m+t4*p+t6*s;
  Real t13 = t2*n+t4*q+t6*t;
  Real t18 = t2*o+t4*r+t6*u;
  Real t21 = _lambda*(t8*m+t13*n+t18*o);
  Real t22 = _mu*t8;
  Real t25 = t21+2.0*t22*m;
  Real t26 = t1*t25;
  Real t28 = -n-q-t;
  Real t30 = -o-r-u;
  Real t33 = _lambda*(t8*t1+t13*t28+t18*t30);
  Real t42 = _lambda*(t1*m+t28*n+t30*o);
  Real t43 = _mu*t1;
  Real t46 = t42+2.0*t43*m;
  Real t48 = t28*_mu;
  Real t51 = m*t13+t8*n;
  Real t53 = t48*t51;
  Real t54 = n*_mu;
  Real t57 = t1*t13+t8*t28;
  Real t60 = t13*_mu;
  Real t63 = m*t28+t1*n;
  Real t66 = t30*_mu;
  Real t69 = m*t18+t8*o;
  Real t71 = t66*t69;
  Real t72 = o*_mu;
  Real t75 = t1*t18+t8*t30;
  Real t78 = t18*_mu;
  Real t81 = m*t30+t1*o;
  Real t84 = t26+m*(t33+2.0*t22*t1)+t8*t46+t53+t54*t57+t60*t63+t71+t72*t75+t78*t81;
  Real t87 = t43*t51;
  Real t88 = m*_mu;
  Real t95 = t21+2.0*t60*n;
  Real t96 = t28*t95;
  Real t103 = t42+2.0*t48*n;
  Real t107 = n*t18+t13*o;
  Real t109 = t66*t107;
  Real t112 = t28*t18+t13*t30;
  Real t117 = n*t30+t28*o;
  Real t120 = t87+t88*t57+t22*t63+t96+n*(t33+2.0*t60*t28)+t13*t103+t109+t72*t112+t78*t117;
  Real t123 = t43*t69;
  Real t129 = t48*t107;
  Real t136 = t21+2.0*t78*o;
  Real t137 = t30*t136;
  Real t144 = t42+2.0*t66*o;
  Real t146 = t123+t88*t75+t22*t81+t129+t54*t112+t60*t117+t137+o*(t33+2.0*t78*t30)+t18*t144;
  Real t149 = e-b;
  Real t151 = h-b;
  Real t153 = k-b;
  Real t155 = t149*m+t151*p+t153*s;
  Real t160 = t149*n+t151*q+t153*t;
  Real t165 = t149*o+t151*r+t153*u;
  Real t168 = _lambda*(t155*t1+t160*t28+t165*t30);
  Real t169 = _mu*t155;
  Real t176 = t1*t160+t155*t28;
  Real t181 = t1*t165+t155*t30;
  Real t184 = m*(t168+2.0*t169*t1)+t54*t176+t72*t181;
  Real t188 = _mu*t160;
  Real t195 = t28*t165+t160*t30;
  Real t198 = t88*t176+n*(t168+2.0*t188*t28)+t72*t195;
  Real t204 = _mu*t165;
  Real t209 = t88*t181+t54*t195+o*(t168+2.0*t204*t30);
  Real t212 = f-c;
  Real t214 = i-c;
  Real t216 = l-c;
  Real t218 = t212*m+t214*p+t216*s;
  Real t223 = t212*n+t214*q+t216*t;
  Real t228 = t212*o+t214*r+t216*u;
  Real t231 = _lambda*(t218*t1+t223*t28+t228*t30);
  Real t232 = _mu*t218;
  Real t239 = t1*t223+t218*t28;
  Real t244 = t1*t228+t218*t30;
  Real t247 = m*(t231+2.0*t232*t1)+t54*t239+t72*t244;
  Real t251 = _mu*t223;
  Real t258 = t28*t228+t223*t30;
  Real t261 = t88*t239+n*(t231+2.0*t251*t28)+t72*t258;
  Real t267 = _mu*t228;
  Real t272 = t88*t244+t54*t258+o*(t231+2.0*t267*t30);
  Real t275 = m*t25;
  Real t277 = m*m;
  Real t278 = n*n;
  Real t279 = o*o;
  Real t281 = _lambda*(t277+t278+t279);
  Real t284 = t281+2.0*_mu*t277;
  Real t286 = t54*t51/2.0;
  Real t288 = m*n;
  Real t291 = t72*t69/2.0;
  Real t293 = m*o;
  Real t296 = 2.0*t275+t8*t284+4.0*t286+2.0*t60*t288+4.0*t291+2.0*t78*t293;
  Real t298 = t88*t51/2.0;
  Real t302 = n*t95;
  Real t306 = t281+2.0*_mu*t278;
  Real t308 = t72*t107/2.0;
  Real t310 = n*o;
  Real t313 = 4.0*t298+2.0*t22*t288+2.0*t302+t13*t306+4.0*t308+2.0*t78*t310;
  Real t315 = t88*t69/2.0;
  Real t319 = t54*t107/2.0;
  Real t323 = o*t136;
  Real t327 = t281+2.0*_mu*t279;
  Real t329 = 4.0*t315+2.0*t22*t293+4.0*t319+2.0*t60*t310+2.0*t323+t18*t327;
  Real t336 = _lambda*(t155*m+t160*n+t165*o);
  Real t343 = m*t160+t155*n;
  Real t348 = m*t165+t155*o;
  Real t351 = m*(t336+2.0*t169*m)+t54*t343+t72*t348;
  Real t361 = n*t165+t160*o;
  Real t364 = t88*t343+n*(t336+2.0*t188*n)+t72*t361;
  Real t374 = t88*t348+t54*t361+o*(t336+2.0*t204*o);
  Real t381 = _lambda*(t218*m+t223*n+t228*o);
  Real t388 = m*t223+t218*n;
  Real t393 = m*t228+t218*o;
  Real t396 = m*(t381+2.0*t232*m)+t54*t388+t72*t393;
  Real t406 = n*t228+t223*o;
  Real t409 = t88*t388+n*(t381+2.0*t251*n)+t72*t406;
  Real t419 = t88*t393+t54*t406+o*(t381+2.0*t267*o);
  Real t422 = p*t25;
  Real t427 = _lambda*(t8*p+t13*q+t18*r);
  Real t436 = _lambda*(m*p+n*q+o*r);
  Real t439 = t436+2.0*t88*p;
  Real t441 = q*_mu;
  Real t443 = t441*t51;
  Real t446 = p*t13+t8*q;
  Real t451 = p*n+m*q;
  Real t454 = r*_mu;
  Real t456 = t454*t69;
  Real t459 = p*t18+t8*r;
  Real t464 = p*o+m*r;
  Real t467 = t422+m*(t427+2.0*t22*p)+t8*t439+t443+t54*t446+t60*t451+t456+t72*t459+t78*t464;
  Real t469 = p*_mu;
  Real t471 = t469*t51;
  Real t476 = q*t95;
  Real t483 = t436+2.0*t54*q;
  Real t486 = t454*t107;
  Real t489 = q*t18+t13*r;
  Real t494 = q*o+n*r;
  Real t497 = t471+t88*t446+t22*t451+t476+n*(t427+2.0*t60*q)+t13*t483+t486+t72*t489+t78*t494;
  Real t500 = t469*t69;
  Real t506 = t441*t107;
  Real t511 = r*t136;
  Real t518 = t436+2.0*t72*r;
  Real t520 = t500+t88*t459+t22*t464+t506+t54*t489+t60*t494+t511+o*(t427+2.0*t78*r)+t18*t518;
  Real t527 = _lambda*(t155*p+t160*q+t165*r);
  Real t534 = p*t160+t155*q;
  Real t539 = p*t165+t155*r;
  Real t542 = m*(t527+2.0*t169*p)+t54*t534+t72*t539;
  Real t552 = q*t165+t160*r;
  Real t555 = t88*t534+n*(t527+2.0*t188*q)+t72*t552;
  Real t565 = t88*t539+t54*t552+o*(t527+2.0*t204*r);
  Real t572 = _lambda*(t218*p+t223*q+t228*r);
  Real t579 = p*t223+t218*q;
  Real t584 = p*t228+t218*r;
  Real t587 = m*(t572+2.0*t232*p)+t54*t579+t72*t584;
  Real t597 = q*t228+t223*r;
  Real t600 = t88*t579+n*(t572+2.0*t251*q)+t72*t597;
  Real t610 = t88*t584+t54*t597+o*(t572+2.0*t267*r);
  Real t613 = s*t25;
  Real t618 = _lambda*(t8*s+t13*t+t18*u);
  Real t627 = _lambda*(m*s+n*t+o*u);
  Real t630 = t627+2.0*t88*s;
  Real t632 = t*_mu;
  Real t634 = t632*t51;
  Real t637 = s*t13+t8*t;
  Real t642 = s*n+m*t;
  Real t645 = u*_mu;
  Real t647 = t645*t69;
  Real t650 = s*t18+t8*u;
  Real t655 = s*o+m*u;
  Real t658 = t613+m*(t618+2.0*t22*s)+t8*t630+t634+t54*t637+t60*t642+t647+t72*t650+t78*t655;
  Real t660 = s*_mu;
  Real t662 = t660*t51;
  Real t667 = t*t95;
  Real t674 = t627+2.0*t54*t;
  Real t677 = t645*t107;
  Real t680 = t*t18+t13*u;
  Real t685 = t*o+n*u;
  Real t688 = t662+t88*t637+t22*t642+t667+n*(t618+2.0*t60*t)+t13*t674+t677+t72*t680+t78*t685;
  Real t691 = t660*t69;
  Real t697 = t632*t107;
  Real t702 = u*t136;
  Real t709 = t627+2.0*t72*u;
  Real t711 = t691+t88*t650+t22*t655+t697+t54*t680+t60*t685+t702+o*(t618+2.0*t78*u)+t18*t709;
  Real t718 = _lambda*(t155*s+t160*t+t165*u);
  Real t725 = s*t160+t155*t;
  Real t730 = s*t165+t155*u;
  Real t733 = m*(t718+2.0*t169*s)+t54*t725+t72*t730;
  Real t743 = t*t165+t160*u;
  Real t746 = t88*t725+n*(t718+2.0*t188*t)+t72*t743;
  Real t756 = t88*t730+t54*t743+o*(t718+2.0*t204*u);
  Real t763 = _lambda*(t218*s+t223*t+t228*u);
  Real t770 = s*t223+t218*t;
  Real t775 = s*t228+t218*u;
  Real t778 = m*(t763+2.0*t232*s)+t54*t770+t72*t775;
  Real t788 = t*t228+t223*u;
  Real t791 = t88*t770+n*(t763+2.0*t251*t)+t72*t788;
  Real t801 = t88*t775+t54*t788+o*(t763+2.0*t267*u);
  Real t809 = t155*t46+t188*t63+t204*t81;
  Real t816 = t169*t63+t160*t103+t204*t117;
  Real t823 = t169*t81+t188*t117+t165*t144;
  Real t826 = t26+t53+t71;
  Real t828 = t87+t96+t109;
  Real t830 = t123+t129+t137;
  Real t832 = t826*b00+t828*b01+t830*b02;
  Real t838 = t155*t284+2.0*t188*t288+2.0*t204*t293;
  Real t845 = 2.0*t169*t288+t160*t306+2.0*t204*t310;
  Real t852 = 2.0*t169*t293+2.0*t188*t310+t165*t327;
  Real t857 = t275+2.0*t286+2.0*t291;
  Real t861 = 2.0*t298+t302+2.0*t308;
  Real t865 = 2.0*t315+2.0*t319+t323;
  Real t867 = t857*b00+t861*b01+t865*b02;
  Real t873 = t155*t439+t188*t451+t204*t464;
  Real t880 = t169*t451+t160*t483+t204*t494;
  Real t887 = t169*t464+t188*t494+t165*t518;
  Real t890 = t422+t443+t456;
  Real t892 = t471+t476+t486;
  Real t894 = t500+t506+t511;
  Real t896 = t890*b00+t892*b01+t894*b02;
  Real t902 = t155*t630+t188*t642+t204*t655;
  Real t909 = t169*t642+t160*t674+t204*t685;
  Real t916 = t169*t655+t188*t685+t165*t709;
  Real t919 = t613+t634+t647;
  Real t921 = t662+t667+t677;
  Real t923 = t691+t697+t702;
  Real t925 = t919*b00+t921*b01+t923*b02;
  Real t931 = t218*t46+t251*t63+t267*t81;
  Real t938 = t232*t63+t223*t103+t267*t117;
  Real t945 = t232*t81+t251*t117+t228*t144;
  Real t953 = t218*t284+2.0*t251*t288+2.0*t267*t293;
  Real t960 = 2.0*t232*t288+t223*t306+2.0*t267*t310;
  Real t967 = 2.0*t232*t293+2.0*t251*t310+t228*t327;
  Real t975 = t218*t439+t251*t451+t267*t464;
  Real t982 = t232*t451+t223*t483+t267*t494;
  Real t989 = t232*t464+t251*t494+t228*t518;
  Real t997 = t218*t630+t251*t642+t267*t655;
  Real t1004 = t232*t642+t223*t674+t267*t685;
  Real t1011 = t232*t655+t251*t685+t228*t709;
  Real t1069 = t826*b10+t828*b11+t830*b12;
  Real t1077 = t857*b10+t861*b11+t865*b12;
  Real t1085 = t890*b10+t892*b11+t894*b12;
  Real t1093 = t919*b10+t921*b11+t923*b12;
  Real t1165 = t826*b20+t828*b21+t830*b22;
  Real t1173 = t857*b20+t861*b21+t865*b22;
  Real t1181 = t890*b20+t892*b21+t894*b22;
  Real t1189 = t919*b20+t921*b21+t923*b22;
  Real t1261 = t826*b30+t828*b31+t830*b32;
  Real t1269 = t857*b30+t861*b31+t865*b32;
  Real t1277 = t890*b30+t892*b31+t894*b32;
  Real t1285 = t919*b30+t921*b31+t923*b32;
  hessian(0,0) = t84*b00+t120*b01+t146*b02;
  hessian(0,1) = t184*b00+t198*b01+t209*b02;
  hessian(0,2) = t247*b00+t261*b01+t272*b02;
  hessian(0,3) = t296*b00+t313*b01+t329*b02;
  hessian(0,4) = t351*b00+t364*b01+t374*b02;
  hessian(0,5) = t396*b00+t409*b01+t419*b02;
  hessian(0,6) = t467*b00+t497*b01+t520*b02;
  hessian(0,7) = t542*b00+t555*b01+t565*b02;
  hessian(0,8) = t587*b00+t600*b01+t610*b02;
  hessian(0,9) = t658*b00+t688*b01+t711*b02;
  hessian(0,10) = t733*b00+t746*b01+t756*b02;
  hessian(0,11) = t778*b00+t791*b01+t801*b02;
  hessian(1,0) = t809*b00+t816*b01+t823*b02;
  hessian(1,1) = t832;
  hessian(1,2) = 0.0;
  hessian(1,3) = t838*b00+t845*b01+t852*b02;
  hessian(1,4) = t867;
  hessian(1,5) = 0.0;
  hessian(1,6) = t873*b00+t880*b01+t887*b02;
  hessian(1,7) = t896;
  hessian(1,8) = 0.0;
  hessian(1,9) = t902*b00+t909*b01+t916*b02;
  hessian(1,10) = t925;
  hessian(1,11) = 0.0;
  hessian(2,0) = t931*b00+t938*b01+t945*b02;
  hessian(2,1) = 0.0;
  hessian(2,2) = t832;
  hessian(2,3) = t953*b00+t960*b01+t967*b02;
  hessian(2,4) = 0.0;
  hessian(2,5) = t867;
  hessian(2,6) = t975*b00+t982*b01+t989*b02;
  hessian(2,7) = 0.0;
  hessian(2,8) = t896;
  hessian(2,9) = t997*b00+t1004*b01+t1011*b02;
  hessian(2,10) = 0.0;
  hessian(2,11) = t925;
  hessian(3,0) = t84*b10+t120*b11+t146*b12;
  hessian(3,1) = t184*b10+t198*b11+t209*b12;
  hessian(3,2) = t247*b10+t261*b11+t272*b12;
  hessian(3,3) = t296*b10+t313*b11+t329*b12;
  hessian(3,4) = t351*b10+t364*b11+t374*b12;
  hessian(3,5) = t396*b10+t409*b11+t419*b12;
  hessian(3,6) = t467*b10+t497*b11+t520*b12;
  hessian(3,7) = t542*b10+t555*b11+t565*b12;
  hessian(3,8) = t587*b10+t600*b11+t610*b12;
  hessian(3,9) = t658*b10+t688*b11+t711*b12;
  hessian(3,10) = t733*b10+t746*b11+t756*b12;
  hessian(3,11) = t778*b10+t791*b11+t801*b12;
  hessian(4,0) = t809*b10+t816*b11+t823*b12;
  hessian(4,1) = t1069;
  hessian(4,2) = 0.0;
  hessian(4,3) = t838*b10+t845*b11+t852*b12;
  hessian(4,4) = t1077;
  hessian(4,5) = 0.0;
  hessian(4,6) = t873*b10+t880*b11+t887*b12;
  hessian(4,7) = t1085;
  hessian(4,8) = 0.0;
  hessian(4,9) = t902*b10+t909*b11+t916*b12;
  hessian(4,10) = t1093;
  hessian(4,11) = 0.0;
  hessian(5,0) = t931*b10+t938*b11+t945*b12;
  hessian(5,1) = 0.0;
  hessian(5,2) = t1069;
  hessian(5,3) = t953*b10+t960*b11+t967*b12;
  hessian(5,4) = 0.0;
  hessian(5,5) = t1077;
  hessian(5,6) = t975*b10+t982*b11+t989*b12;
  hessian(5,7) = 0.0;
  hessian(5,8) = t1085;
  hessian(5,9) = t997*b10+t1004*b11+t1011*b12;
  hessian(5,10) = 0.0;
  hessian(5,11) = t1093;
  hessian(6,0) = t84*b20+t120*b21+t146*b22;
  hessian(6,1) = t184*b20+t198*b21+t209*b22;
  hessian(6,2) = t247*b20+t261*b21+t272*b22;
  hessian(6,3) = t296*b20+t313*b21+t329*b22;
  hessian(6,4) = t351*b20+t364*b21+t374*b22;
  hessian(6,5) = t396*b20+t409*b21+t419*b22;
  hessian(6,6) = t467*b20+t497*b21+t520*b22;
  hessian(6,7) = t542*b20+t555*b21+t565*b22;
  hessian(6,8) = t587*b20+t600*b21+t610*b22;
  hessian(6,9) = t658*b20+t688*b21+t711*b22;
  hessian(6,10) = t733*b20+t746*b21+t756*b22;
  hessian(6,11) = t778*b20+t791*b21+t801*b22;
  hessian(7,0) = t809*b20+t816*b21+t823*b22;
  hessian(7,1) = t1165;
  hessian(7,2) = 0.0;
  hessian(7,3) = t838*b20+t845*b21+t852*b22;
  hessian(7,4) = t1173;
  hessian(7,5) = 0.0;
  hessian(7,6) = t873*b20+t880*b21+t887*b22;
  hessian(7,7) = t1181;
  hessian(7,8) = 0.0;
  hessian(7,9) = t902*b20+t909*b21+t916*b22;
  hessian(7,10) = t1189;
  hessian(7,11) = 0.0;
  hessian(8,0) = t931*b20+t938*b21+t945*b22;
  hessian(8,1) = 0.0;
  hessian(8,2) = t1165;
  hessian(8,3) = t953*b20+t960*b21+t967*b22;
  hessian(8,4) = 0.0;
  hessian(8,5) = t1173;
  hessian(8,6) = t975*b20+t982*b21+t989*b22;
  hessian(8,7) = 0.0;
  hessian(8,8) = t1181;
  hessian(8,9) = t997*b20+t1004*b21+t1011*b22;
  hessian(8,10) = 0.0;
  hessian(8,11) = t1189;
  hessian(9,0) = t84*b30+t120*b31+t146*b32;
  hessian(9,1) = t184*b30+t198*b31+t209*b32;
  hessian(9,2) = t247*b30+t261*b31+t272*b32;
  hessian(9,3) = t296*b30+t313*b31+t329*b32;
  hessian(9,4) = t351*b30+t364*b31+t374*b32;
  hessian(9,5) = t396*b30+t409*b31+t419*b32;
  hessian(9,6) = t467*b30+t497*b31+t520*b32;
  hessian(9,7) = t542*b30+t555*b31+t565*b32;
  hessian(9,8) = t587*b30+t600*b31+t610*b32;
  hessian(9,9) = t658*b30+t688*b31+t711*b32;
  hessian(9,10) = t733*b30+t746*b31+t756*b32;
  hessian(9,11) = t778*b30+t791*b31+t801*b32;
  hessian(10,0) = t809*b30+t816*b31+t823*b32;
  hessian(10,1) = t1261;
  hessian(10,2) = 0.0;
  hessian(10,3) = t838*b30+t845*b31+t852*b32;
  hessian(10,4) = t1269;
  hessian(10,5) = 0.0;
  hessian(10,6) = t873*b30+t880*b31+t887*b32;
  hessian(10,7) = t1277;
  hessian(10,8) = 0.0;
  hessian(10,9) = t902*b30+t909*b31+t916*b32;
  hessian(10,10) = t1285;
  hessian(10,11) = 0.0;
  hessian(11,0) = t931*b30+t938*b31+t945*b32;
  hessian(11,1) = 0.0;
  hessian(11,2) = t1261;
  hessian(11,3) = t953*b30+t960*b31+t967*b32;
  hessian(11,4) = 0.0;
  hessian(11,5) = t1269;
  hessian(11,6) = t975*b30+t982*b31+t989*b32;
  hessian(11,7) = 0.0;
  hessian(11,8) = t1277;
  hessian(11,9) = t997*b30+t1004*b31+t1011*b32;
  hessian(11,10) = 0.0;
  hessian(11,11) = t1285;
   
}

void STVK::hessian4(MATRIX3& DmInv, const VEC3F* bVecs, const VEC3F* vertices, MATRIX& hessian)
{
  Real b00 = bVecs[0][0];
  Real b01 = bVecs[0][1];
  Real b02 = bVecs[0][2];
  Real b10 = bVecs[1][0];
  Real b11 = bVecs[1][1];
  Real b12 = bVecs[1][2];
  Real b20 = bVecs[2][0];
  Real b21 = bVecs[2][1];
  Real b22 = bVecs[2][2];
  Real b30 = bVecs[3][0];
  Real b31 = bVecs[3][1];
  Real b32 = bVecs[3][2];

  Real a = vertices[0][0];
  Real b = vertices[0][1];
  Real c = vertices[0][2];

  Real d = vertices[1][0];
  Real e = vertices[1][1];
  Real f = vertices[1][2];

  Real g = vertices[2][0];
  Real h = vertices[2][1];
  Real i = vertices[2][2];

  Real j = vertices[3][0];
  Real k = vertices[3][1];
  Real l = vertices[3][2];
 
  Real m = DmInv(0,0);
  Real n = DmInv(0,1);
  Real o = DmInv(0,2);
  Real p = DmInv(1,0);
  Real q = DmInv(1,1);
  Real r = DmInv(1,2);
  Real s = DmInv(2,0);
  Real t = DmInv(2,1);
  Real u = DmInv(2,2);

  Real t1 = -m-p-s;
  Real t2 = e-b;
  Real t4 = h-b;
  Real t6 = k-b;
  Real t8 = t2*m+t4*p+t6*s;
  Real t13 = t2*n+t4*q+t6*t;
  Real t18 = t2*o+t4*r+t6*u;
  Real t21 = _lambda*(t8*m+t13*n+t18*o);
  Real t22 = _mu*t8;
  Real t25 = t21+2.0*t22*m;
  Real t26 = t1*t25;
  Real t27 = -n-q-t;
  Real t28 = t27*_mu;
  Real t31 = m*t13+t8*n;
  Real t33 = t28*t31;
  Real t34 = -o-r-u;
  Real t35 = t34*_mu;
  Real t38 = m*t18+t8*o;
  Real t40 = t35*t38;
  Real t41 = t26+t33+t40;
  Real t43 = t1*_mu;
  Real t45 = t43*t31;
  Real t46 = _mu*t13;
  Real t49 = t21+2.0*t46*n;
  Real t50 = t27*t49;
  Real t53 = n*t18+t13*o;
  Real t55 = t35*t53;
  Real t56 = t45+t50+t55;
  Real t59 = t43*t38;
  Real t61 = t28*t53;
  Real t62 = _mu*t18;
  Real t65 = t21+2.0*t62*o;
  Real t66 = t34*t65;
  Real t67 = t59+t61+t66;
  Real t69 = t41*b00+t56*b01+t67*b02;
  Real t70 = d-a;
  Real t72 = g-a;
  Real t74 = j-a;
  Real t76 = t70*m+t72*p+t74*s;
  Real t81 = _lambda*(t1*m+t27*n+t34*o);
  Real t84 = t81+2.0*t43*m;
  Real t89 = t70*n+t72*q+t74*t;
  Real t90 = t89*_mu;
  Real t93 = m*t27+t1*n;
  Real t99 = t70*o+t72*r+t74*u;
  Real t100 = t99*_mu;
  Real t103 = m*t34+t1*o;
  Real t106 = t76*t84+t90*t93+t100*t103;
  Real t108 = t76*_mu;
  Real t113 = t81+2.0*t28*n;
  Real t117 = n*t34+t27*o;
  Real t120 = t108*t93+t89*t113+t100*t117;
  Real t128 = t81+2.0*t35*o;
  Real t130 = t108*t103+t90*t117+t99*t128;
  Real t133 = m*t25;
  Real t134 = n*_mu;
  Real t135 = t134*t31/2.0;
  Real t137 = o*_mu;
  Real t138 = t137*t38/2.0;
  Real t140 = t133+2.0*t135+2.0*t138;
  Real t142 = m*_mu;
  Real t143 = t142*t31/2.0;
  Real t145 = n*t49;
  Real t146 = t137*t53/2.0;
  Real t148 = 2.0*t143+t145+2.0*t146;
  Real t150 = t142*t38/2.0;
  Real t152 = t134*t53/2.0;
  Real t154 = o*t65;
  Real t155 = 2.0*t150+2.0*t152+t154;
  Real t157 = t140*b00+t148*b01+t155*b02;
  Real t158 = m*m;
  Real t159 = n*n;
  Real t160 = o*o;
  Real t162 = _lambda*(t158+t159+t160);
  Real t165 = t162+2.0*_mu*t158;
  Real t167 = m*n;
  Real t170 = m*o;
  Real t173 = t76*t165+2.0*t90*t167+2.0*t100*t170;
  Real t179 = t162+2.0*_mu*t159;
  Real t181 = n*o;
  Real t184 = 2.0*t108*t167+t89*t179+2.0*t100*t181;
  Real t192 = t162+2.0*_mu*t160;
  Real t194 = 2.0*t108*t170+2.0*t90*t181+t99*t192;
  Real t197 = p*t25;
  Real t198 = q*_mu;
  Real t200 = t198*t31;
  Real t201 = r*_mu;
  Real t203 = t201*t38;
  Real t204 = t197+t200+t203;
  Real t206 = p*_mu;
  Real t208 = t206*t31;
  Real t209 = q*t49;
  Real t211 = t201*t53;
  Real t212 = t208+t209+t211;
  Real t215 = t206*t38;
  Real t217 = t198*t53;
  Real t218 = r*t65;
  Real t219 = t215+t217+t218;
  Real t221 = t204*b00+t212*b01+t219*b02;
  Real t226 = _lambda*(m*p+n*q+o*r);
  Real t229 = t226+2.0*t142*p;
  Real t233 = p*n+m*q;
  Real t238 = p*o+m*r;
  Real t241 = t76*t229+t90*t233+t100*t238;
  Real t247 = t226+2.0*t134*q;
  Real t251 = q*o+n*r;
  Real t254 = t108*t233+t89*t247+t100*t251;
  Real t262 = t226+2.0*t137*r;
  Real t264 = t108*t238+t90*t251+t99*t262;
  Real t267 = s*t25;
  Real t268 = t*_mu;
  Real t270 = t268*t31;
  Real t271 = u*_mu;
  Real t273 = t271*t38;
  Real t274 = t267+t270+t273;
  Real t276 = s*_mu;
  Real t278 = t276*t31;
  Real t279 = t*t49;
  Real t281 = t271*t53;
  Real t282 = t278+t279+t281;
  Real t285 = t276*t38;
  Real t287 = t268*t53;
  Real t288 = u*t65;
  Real t289 = t285+t287+t288;
  Real t291 = t274*b00+t282*b01+t289*b02;
  Real t296 = _lambda*(m*s+n*t+o*u);
  Real t299 = t296+2.0*t142*s;
  Real t303 = s*n+m*t;
  Real t308 = s*o+m*u;
  Real t311 = t76*t299+t90*t303+t100*t308;
  Real t317 = t296+2.0*t134*t;
  Real t321 = t*o+n*u;
  Real t324 = t108*t303+t89*t317+t100*t321;
  Real t332 = t296+2.0*t137*u;
  Real t334 = t108*t308+t90*t321+t99*t332;
  Real t341 = _lambda*(t76*t1+t89*t27+t99*t34);
  Real t348 = t1*t89+t76*t27;
  Real t353 = t1*t99+t76*t34;
  Real t356 = m*(t341+2.0*t108*t1)+t134*t348+t137*t353;
  Real t366 = t27*t99+t89*t34;
  Real t369 = t142*t348+n*(t341+2.0*t90*t27)+t137*t366;
  Real t379 = t142*t353+t134*t366+o*(t341+2.0*t100*t34);
  Real t386 = _lambda*(t8*t1+t13*t27+t18*t34);
  Real t394 = t1*t13+t8*t27;
  Real t401 = t1*t18+t8*t34;
  Real t406 = t26+m*(t386+2.0*t22*t1)+t8*t84+t33+t134*t394+t46*t93+t40+t137*t401+t62*t103;
  Real t419 = t27*t18+t13*t34;
  Real t424 = t45+t142*t394+t22*t93+t50+n*(t386+2.0*t46*t27)+t13*t113+t55+t137*t419+t62*t117;
  Real t439 = t59+t142*t401+t22*t103+t61+t134*t419+t46*t117+t66+o*(t386+2.0*t62*t34)+t18*t128;
  Real t442 = f-c;
  Real t444 = i-c;
  Real t446 = l-c;
  Real t448 = t442*m+t444*p+t446*s;
  Real t453 = t442*n+t444*q+t446*t;
  Real t458 = t442*o+t444*r+t446*u;
  Real t461 = _lambda*(t448*t1+t453*t27+t458*t34);
  Real t462 = _mu*t448;
  Real t469 = t1*t453+t448*t27;
  Real t474 = t1*t458+t448*t34;
  Real t477 = m*(t461+2.0*t462*t1)+t134*t469+t137*t474;
  Real t481 = _mu*t453;
  Real t488 = t27*t458+t453*t34;
  Real t491 = t142*t469+n*(t461+2.0*t481*t27)+t137*t488;
  Real t497 = _mu*t458;
  Real t502 = t142*t474+t134*t488+o*(t461+2.0*t497*t34);
  Real t509 = _lambda*(t76*m+t89*n+t99*o);
  Real t516 = m*t89+t76*n;
  Real t521 = m*t99+t76*o;
  Real t524 = m*(t509+2.0*t108*m)+t134*t516+t137*t521;
  Real t534 = n*t99+t89*o;
  Real t537 = t142*t516+n*(t509+2.0*t90*n)+t137*t534;
  Real t547 = t142*t521+t134*t534+o*(t509+2.0*t100*o);
  Real t558 = 2.0*t133+t8*t165+4.0*t135+2.0*t46*t167+4.0*t138+2.0*t62*t170;
  Real t568 = 4.0*t143+2.0*t22*t167+2.0*t145+t13*t179+4.0*t146+2.0*t62*t181;
  Real t578 = 4.0*t150+2.0*t22*t170+4.0*t152+2.0*t46*t181+2.0*t154+t18*t192;
  Real t585 = _lambda*(t448*m+t453*n+t458*o);
  Real t592 = m*t453+t448*n;
  Real t597 = m*t458+t448*o;
  Real t600 = m*(t585+2.0*t462*m)+t134*t592+t137*t597;
  Real t610 = n*t458+t453*o;
  Real t613 = t142*t592+n*(t585+2.0*t481*n)+t137*t610;
  Real t623 = t142*t597+t134*t610+o*(t585+2.0*t497*o);
  Real t630 = _lambda*(t76*p+t89*q+t99*r);
  Real t637 = p*t89+t76*q;
  Real t642 = p*t99+t76*r;
  Real t645 = m*(t630+2.0*t108*p)+t134*t637+t137*t642;
  Real t655 = q*t99+t89*r;
  Real t658 = t142*t637+n*(t630+2.0*t90*q)+t137*t655;
  Real t668 = t142*t642+t134*t655+o*(t630+2.0*t100*r);
  Real t675 = _lambda*(t8*p+t13*q+t18*r);
  Real t683 = p*t13+t8*q;
  Real t690 = p*t18+t8*r;
  Real t695 = t197+m*(t675+2.0*t22*p)+t8*t229+t200+t134*t683+t46*t233+t203+t137*t690+t62*t238;
  Real t708 = q*t18+t13*r;
  Real t713 = t208+t142*t683+t22*t233+t209+n*(t675+2.0*t46*q)+t13*t247+t211+t137*t708+t62*t251;
  Real t728 = t215+t142*t690+t22*t238+t217+t134*t708+t46*t251+t218+o*(t675+2.0*t62*r)+t18*t262;
  Real t735 = _lambda*(t448*p+t453*q+t458*r);
  Real t742 = p*t453+t448*q;
  Real t747 = p*t458+t448*r;
  Real t750 = m*(t735+2.0*t462*p)+t134*t742+t137*t747;
  Real t760 = q*t458+t453*r;
  Real t763 = t142*t742+n*(t735+2.0*t481*q)+t137*t760;
  Real t773 = t142*t747+t134*t760+o*(t735+2.0*t497*r);
  Real t780 = _lambda*(t76*s+t89*t+t99*u);
  Real t787 = s*t89+t76*t;
  Real t792 = s*t99+t76*u;
  Real t795 = m*(t780+2.0*t108*s)+t134*t787+t137*t792;
  Real t805 = t*t99+t89*u;
  Real t808 = t142*t787+n*(t780+2.0*t90*t)+t137*t805;
  Real t818 = t142*t792+t134*t805+o*(t780+2.0*t100*u);
  Real t825 = _lambda*(t8*s+t13*t+t18*u);
  Real t833 = s*t13+t8*t;
  Real t840 = s*t18+t8*u;
  Real t845 = t267+m*(t825+2.0*t22*s)+t8*t299+t270+t134*t833+t46*t303+t273+t137*t840+t62*t308;
  Real t858 = t*t18+t13*u;
  Real t863 = t278+t142*t833+t22*t303+t279+n*(t825+2.0*t46*t)+t13*t317+t281+t137*t858+t62*t321;
  Real t878 = t285+t142*t840+t22*t308+t287+t134*t858+t46*t321+t288+o*(t825+2.0*t62*u)+t18*t332;
  Real t885 = _lambda*(t448*s+t453*t+t458*u);
  Real t892 = s*t453+t448*t;
  Real t897 = s*t458+t448*u;
  Real t900 = m*(t885+2.0*t462*s)+t134*t892+t137*t897;
  Real t910 = t*t458+t453*u;
  Real t913 = t142*t892+n*(t885+2.0*t481*t)+t137*t910;
  Real t923 = t142*t897+t134*t910+o*(t885+2.0*t497*u);
  Real t931 = t448*t84+t481*t93+t497*t103;
  Real t938 = t462*t93+t453*t113+t497*t117;
  Real t945 = t462*t103+t481*t117+t458*t128;
  Real t953 = t448*t165+2.0*t481*t167+2.0*t497*t170;
  Real t960 = 2.0*t462*t167+t453*t179+2.0*t497*t181;
  Real t967 = 2.0*t462*t170+2.0*t481*t181+t458*t192;
  Real t975 = t448*t229+t481*t233+t497*t238;
  Real t982 = t462*t233+t453*t247+t497*t251;
  Real t989 = t462*t238+t481*t251+t458*t262;
  Real t997 = t448*t299+t481*t303+t497*t308;
  Real t1004 = t462*t303+t453*t317+t497*t321;
  Real t1011 = t462*t308+t481*t321+t458*t332;
  Real t1017 = t41*b10+t56*b11+t67*b12;
  Real t1025 = t140*b10+t148*b11+t155*b12;
  Real t1033 = t204*b10+t212*b11+t219*b12;
  Real t1041 = t274*b10+t282*b11+t289*b12;
  Real t1113 = t41*b20+t56*b21+t67*b22;
  Real t1121 = t140*b20+t148*b21+t155*b22;
  Real t1129 = t204*b20+t212*b21+t219*b22;
  Real t1137 = t274*b20+t282*b21+t289*b22;
  Real t1209 = t41*b30+t56*b31+t67*b32;
  Real t1217 = t140*b30+t148*b31+t155*b32;
  Real t1225 = t204*b30+t212*b31+t219*b32;
  Real t1233 = t274*b30+t282*b31+t289*b32;
  hessian(0,0) = t69;
  hessian(0,1) = t106*b00+t120*b01+t130*b02;
  hessian(0,2) = 0.0;
  hessian(0,3) = t157;
  hessian(0,4) = t173*b00+t184*b01+t194*b02;
  hessian(0,5) = 0.0;
  hessian(0,6) = t221;
  hessian(0,7) = t241*b00+t254*b01+t264*b02;
  hessian(0,8) = 0.0;
  hessian(0,9) = t291;
  hessian(0,10) = t311*b00+t324*b01+t334*b02;
  hessian(0,11) = 0.0;
  hessian(1,0) = t356*b00+t369*b01+t379*b02;
  hessian(1,1) = t406*b00+t424*b01+t439*b02;
  hessian(1,2) = t477*b00+t491*b01+t502*b02;
  hessian(1,3) = t524*b00+t537*b01+t547*b02;
  hessian(1,4) = t558*b00+t568*b01+t578*b02;
  hessian(1,5) = t600*b00+t613*b01+t623*b02;
  hessian(1,6) = t645*b00+t658*b01+t668*b02;
  hessian(1,7) = t695*b00+t713*b01+t728*b02;
  hessian(1,8) = t750*b00+t763*b01+t773*b02;
  hessian(1,9) = t795*b00+t808*b01+t818*b02;
  hessian(1,10) = t845*b00+t863*b01+t878*b02;
  hessian(1,11) = t900*b00+t913*b01+t923*b02;
  hessian(2,0) = 0.0;
  hessian(2,1) = t931*b00+t938*b01+t945*b02;
  hessian(2,2) = t69;
  hessian(2,3) = 0.0;
  hessian(2,4) = t953*b00+t960*b01+t967*b02;
  hessian(2,5) = t157;
  hessian(2,6) = 0.0;
  hessian(2,7) = t975*b00+t982*b01+t989*b02;
  hessian(2,8) = t221;
  hessian(2,9) = 0.0;
  hessian(2,10) = t997*b00+t1004*b01+t1011*b02;
  hessian(2,11) = t291;
  hessian(3,0) = t1017;
  hessian(3,1) = t106*b10+t120*b11+t130*b12;
  hessian(3,2) = 0.0;
  hessian(3,3) = t1025;
  hessian(3,4) = t173*b10+t184*b11+t194*b12;
  hessian(3,5) = 0.0;
  hessian(3,6) = t1033;
  hessian(3,7) = t241*b10+t254*b11+t264*b12;
  hessian(3,8) = 0.0;
  hessian(3,9) = t1041;
  hessian(3,10) = t311*b10+t324*b11+t334*b12;
  hessian(3,11) = 0.0;
  hessian(4,0) = t356*b10+t369*b11+t379*b12;
  hessian(4,1) = t406*b10+t424*b11+t439*b12;
  hessian(4,2) = t477*b10+t491*b11+t502*b12;
  hessian(4,3) = t524*b10+t537*b11+t547*b12;
  hessian(4,4) = t558*b10+t568*b11+t578*b12;
  hessian(4,5) = t600*b10+t613*b11+t623*b12;
  hessian(4,6) = t645*b10+t658*b11+t668*b12;
  hessian(4,7) = t695*b10+t713*b11+t728*b12;
  hessian(4,8) = t750*b10+t763*b11+t773*b12;
  hessian(4,9) = t795*b10+t808*b11+t818*b12;
  hessian(4,10) = t845*b10+t863*b11+t878*b12;
  hessian(4,11) = t900*b10+t913*b11+t923*b12;
  hessian(5,0) = 0.0;
  hessian(5,1) = t931*b10+t938*b11+t945*b12;
  hessian(5,2) = t1017;
  hessian(5,3) = 0.0;
  hessian(5,4) = t953*b10+t960*b11+t967*b12;
  hessian(5,5) = t1025;
  hessian(5,6) = 0.0;
  hessian(5,7) = t975*b10+t982*b11+t989*b12;
  hessian(5,8) = t1033;
  hessian(5,9) = 0.0;
  hessian(5,10) = t997*b10+t1004*b11+t1011*b12;
  hessian(5,11) = t1041;
  hessian(6,0) = t1113;
  hessian(6,1) = t106*b20+t120*b21+t130*b22;
  hessian(6,2) = 0.0;
  hessian(6,3) = t1121;
  hessian(6,4) = t173*b20+t184*b21+t194*b22;
  hessian(6,5) = 0.0;
  hessian(6,6) = t1129;
  hessian(6,7) = t241*b20+t254*b21+t264*b22;
  hessian(6,8) = 0.0;
  hessian(6,9) = t1137;
  hessian(6,10) = t311*b20+t324*b21+t334*b22;
  hessian(6,11) = 0.0;
  hessian(7,0) = t356*b20+t369*b21+t379*b22;
  hessian(7,1) = t406*b20+t424*b21+t439*b22;
  hessian(7,2) = t477*b20+t491*b21+t502*b22;
  hessian(7,3) = t524*b20+t537*b21+t547*b22;
  hessian(7,4) = t558*b20+t568*b21+t578*b22;
  hessian(7,5) = t600*b20+t613*b21+t623*b22;
  hessian(7,6) = t645*b20+t658*b21+t668*b22;
  hessian(7,7) = t695*b20+t713*b21+t728*b22;
  hessian(7,8) = t750*b20+t763*b21+t773*b22;
  hessian(7,9) = t795*b20+t808*b21+t818*b22;
  hessian(7,10) = t845*b20+t863*b21+t878*b22;
  hessian(7,11) = t900*b20+t913*b21+t923*b22;
  hessian(8,0) = 0.0;
  hessian(8,1) = t931*b20+t938*b21+t945*b22;
  hessian(8,2) = t1113;
  hessian(8,3) = 0.0;
  hessian(8,4) = t953*b20+t960*b21+t967*b22;
  hessian(8,5) = t1121;
  hessian(8,6) = 0.0;
  hessian(8,7) = t975*b20+t982*b21+t989*b22;
  hessian(8,8) = t1129;
  hessian(8,9) = 0.0;
  hessian(8,10) = t997*b20+t1004*b21+t1011*b22;
  hessian(8,11) = t1137;
  hessian(9,0) = t1209;
  hessian(9,1) = t106*b30+t120*b31+t130*b32;
  hessian(9,2) = 0.0;
  hessian(9,3) = t1217;
  hessian(9,4) = t173*b30+t184*b31+t194*b32;
  hessian(9,5) = 0.0;
  hessian(9,6) = t1225;
  hessian(9,7) = t241*b30+t254*b31+t264*b32;
  hessian(9,8) = 0.0;
  hessian(9,9) = t1233;
  hessian(9,10) = t311*b30+t324*b31+t334*b32;
  hessian(9,11) = 0.0;
  hessian(10,0) = t356*b30+t369*b31+t379*b32;
  hessian(10,1) = t406*b30+t424*b31+t439*b32;
  hessian(10,2) = t477*b30+t491*b31+t502*b32;
  hessian(10,3) = t524*b30+t537*b31+t547*b32;
  hessian(10,4) = t558*b30+t568*b31+t578*b32;
  hessian(10,5) = t600*b30+t613*b31+t623*b32;
  hessian(10,6) = t645*b30+t658*b31+t668*b32;
  hessian(10,7) = t695*b30+t713*b31+t728*b32;
  hessian(10,8) = t750*b30+t763*b31+t773*b32;
  hessian(10,9) = t795*b30+t808*b31+t818*b32;
  hessian(10,10) = t845*b30+t863*b31+t878*b32;
  hessian(10,11) = t900*b30+t913*b31+t923*b32;
  hessian(11,0) = 0.0;
  hessian(11,1) = t931*b30+t938*b31+t945*b32;
  hessian(11,2) = t1209;
  hessian(11,3) = 0.0;
  hessian(11,4) = t953*b30+t960*b31+t967*b32;
  hessian(11,5) = t1217;
  hessian(11,6) = 0.0;
  hessian(11,7) = t975*b30+t982*b31+t989*b32;
  hessian(11,8) = t1225;
  hessian(11,9) = 0.0;
  hessian(11,10) = t997*b30+t1004*b31+t1011*b32;
  hessian(11,11) = t1233;
   
}

void STVK::hessian5(MATRIX3& DmInv, const VEC3F* bVecs, const VEC3F* vertices, MATRIX& hessian)
{
  Real b00 = bVecs[0][0];
  Real b01 = bVecs[0][1];
  Real b02 = bVecs[0][2];
  Real b10 = bVecs[1][0];
  Real b11 = bVecs[1][1];
  Real b12 = bVecs[1][2];
  Real b20 = bVecs[2][0];
  Real b21 = bVecs[2][1];
  Real b22 = bVecs[2][2];
  Real b30 = bVecs[3][0];
  Real b31 = bVecs[3][1];
  Real b32 = bVecs[3][2];

  Real a = vertices[0][0];
  Real b = vertices[0][1];
  Real c = vertices[0][2];

  Real d = vertices[1][0];
  Real e = vertices[1][1];
  Real f = vertices[1][2];

  Real g = vertices[2][0];
  Real h = vertices[2][1];
  Real i = vertices[2][2];

  Real j = vertices[3][0];
  Real k = vertices[3][1];
  Real l = vertices[3][2];
 
  Real m = DmInv(0,0);
  Real n = DmInv(0,1);
  Real o = DmInv(0,2);
  Real p = DmInv(1,0);
  Real q = DmInv(1,1);
  Real r = DmInv(1,2);
  Real s = DmInv(2,0);
  Real t = DmInv(2,1);
  Real u = DmInv(2,2);

  Real t1 = -m-p-s;
  Real t2 = f-c;
  Real t4 = i-c;
  Real t6 = l-c;
  Real t8 = t2*m+t4*p+t6*s;
  Real t13 = t2*n+t4*q+t6*t;
  Real t18 = t2*o+t4*r+t6*u;
  Real t21 = _lambda*(t8*m+t13*n+t18*o);
  Real t22 = _mu*t8;
  Real t25 = t21+2.0*t22*m;
  Real t26 = t1*t25;
  Real t27 = -n-q-t;
  Real t28 = t27*_mu;
  Real t31 = m*t13+t8*n;
  Real t33 = t28*t31;
  Real t34 = -o-r-u;
  Real t35 = t34*_mu;
  Real t38 = m*t18+t8*o;
  Real t40 = t35*t38;
  Real t41 = t26+t33+t40;
  Real t43 = t1*_mu;
  Real t45 = t43*t31;
  Real t46 = _mu*t13;
  Real t49 = t21+2.0*t46*n;
  Real t50 = t27*t49;
  Real t53 = n*t18+t13*o;
  Real t55 = t35*t53;
  Real t56 = t45+t50+t55;
  Real t59 = t43*t38;
  Real t61 = t28*t53;
  Real t62 = _mu*t18;
  Real t65 = t21+2.0*t62*o;
  Real t66 = t34*t65;
  Real t67 = t59+t61+t66;
  Real t69 = t41*b00+t56*b01+t67*b02;
  Real t70 = d-a;
  Real t72 = g-a;
  Real t74 = j-a;
  Real t76 = t70*m+t72*p+t74*s;
  Real t81 = _lambda*(t1*m+t27*n+t34*o);
  Real t84 = t81+2.0*t43*m;
  Real t89 = t70*n+t72*q+t74*t;
  Real t90 = t89*_mu;
  Real t93 = m*t27+t1*n;
  Real t99 = t70*o+t72*r+t74*u;
  Real t100 = t99*_mu;
  Real t103 = m*t34+t1*o;
  Real t106 = t76*t84+t90*t93+t100*t103;
  Real t108 = t76*_mu;
  Real t113 = t81+2.0*t28*n;
  Real t117 = n*t34+t27*o;
  Real t120 = t108*t93+t89*t113+t100*t117;
  Real t128 = t81+2.0*t35*o;
  Real t130 = t108*t103+t90*t117+t99*t128;
  Real t133 = m*t25;
  Real t134 = n*_mu;
  Real t135 = t134*t31/2.0;
  Real t137 = o*_mu;
  Real t138 = t137*t38/2.0;
  Real t140 = t133+2.0*t135+2.0*t138;
  Real t142 = m*_mu;
  Real t143 = t142*t31/2.0;
  Real t145 = n*t49;
  Real t146 = t137*t53/2.0;
  Real t148 = 2.0*t143+t145+2.0*t146;
  Real t150 = t142*t38/2.0;
  Real t152 = t134*t53/2.0;
  Real t154 = o*t65;
  Real t155 = 2.0*t150+2.0*t152+t154;
  Real t157 = t140*b00+t148*b01+t155*b02;
  Real t158 = m*m;
  Real t159 = n*n;
  Real t160 = o*o;
  Real t162 = _lambda*(t158+t159+t160);
  Real t165 = t162+2.0*_mu*t158;
  Real t167 = m*n;
  Real t170 = m*o;
  Real t173 = t76*t165+2.0*t90*t167+2.0*t100*t170;
  Real t179 = t162+2.0*_mu*t159;
  Real t181 = n*o;
  Real t184 = 2.0*t108*t167+t89*t179+2.0*t100*t181;
  Real t192 = t162+2.0*_mu*t160;
  Real t194 = 2.0*t108*t170+2.0*t90*t181+t99*t192;
  Real t197 = p*t25;
  Real t198 = q*_mu;
  Real t200 = t198*t31;
  Real t201 = r*_mu;
  Real t203 = t201*t38;
  Real t204 = t197+t200+t203;
  Real t206 = p*_mu;
  Real t208 = t206*t31;
  Real t209 = q*t49;
  Real t211 = t201*t53;
  Real t212 = t208+t209+t211;
  Real t215 = t206*t38;
  Real t217 = t198*t53;
  Real t218 = r*t65;
  Real t219 = t215+t217+t218;
  Real t221 = t204*b00+t212*b01+t219*b02;
  Real t226 = _lambda*(m*p+n*q+o*r);
  Real t229 = t226+2.0*t142*p;
  Real t233 = p*n+m*q;
  Real t238 = p*o+m*r;
  Real t241 = t76*t229+t90*t233+t100*t238;
  Real t247 = t226+2.0*t134*q;
  Real t251 = q*o+n*r;
  Real t254 = t108*t233+t89*t247+t100*t251;
  Real t262 = t226+2.0*t137*r;
  Real t264 = t108*t238+t90*t251+t99*t262;
  Real t267 = s*t25;
  Real t268 = t*_mu;
  Real t270 = t268*t31;
  Real t271 = u*_mu;
  Real t273 = t271*t38;
  Real t274 = t267+t270+t273;
  Real t276 = s*_mu;
  Real t278 = t276*t31;
  Real t279 = t*t49;
  Real t281 = t271*t53;
  Real t282 = t278+t279+t281;
  Real t285 = t276*t38;
  Real t287 = t268*t53;
  Real t288 = u*t65;
  Real t289 = t285+t287+t288;
  Real t291 = t274*b00+t282*b01+t289*b02;
  Real t296 = _lambda*(m*s+n*t+o*u);
  Real t299 = t296+2.0*t142*s;
  Real t303 = s*n+m*t;
  Real t308 = s*o+m*u;
  Real t311 = t76*t299+t90*t303+t100*t308;
  Real t317 = t296+2.0*t134*t;
  Real t321 = t*o+n*u;
  Real t324 = t108*t303+t89*t317+t100*t321;
  Real t332 = t296+2.0*t137*u;
  Real t334 = t108*t308+t90*t321+t99*t332;
  Real t337 = e-b;
  Real t339 = h-b;
  Real t341 = k-b;
  Real t343 = t337*m+t339*p+t341*s;
  Real t348 = t337*n+t339*q+t341*t;
  Real t349 = t348*_mu;
  Real t355 = t337*o+t339*r+t341*u;
  Real t356 = t355*_mu;
  Real t359 = t343*t84+t349*t93+t356*t103;
  Real t361 = t343*_mu;
  Real t367 = t361*t93+t348*t113+t356*t117;
  Real t374 = t361*t103+t349*t117+t355*t128;
  Real t382 = t343*t165+2.0*t349*t167+2.0*t356*t170;
  Real t389 = 2.0*t361*t167+t348*t179+2.0*t356*t181;
  Real t396 = 2.0*t361*t170+2.0*t349*t181+t355*t192;
  Real t404 = t343*t229+t349*t233+t356*t238;
  Real t411 = t361*t233+t348*t247+t356*t251;
  Real t418 = t361*t238+t349*t251+t355*t262;
  Real t426 = t343*t299+t349*t303+t356*t308;
  Real t433 = t361*t303+t348*t317+t356*t321;
  Real t440 = t361*t308+t349*t321+t355*t332;
  Real t447 = _lambda*(t76*t1+t89*t27+t99*t34);
  Real t454 = t1*t89+t76*t27;
  Real t459 = t1*t99+t76*t34;
  Real t462 = m*(t447+2.0*t108*t1)+t134*t454+t137*t459;
  Real t472 = t27*t99+t89*t34;
  Real t475 = t142*t454+n*(t447+2.0*t90*t27)+t137*t472;
  Real t485 = t142*t459+t134*t472+o*(t447+2.0*t100*t34);
  Real t492 = _lambda*(t343*t1+t348*t27+t355*t34);
  Real t499 = t1*t348+t343*t27;
  Real t504 = t1*t355+t343*t34;
  Real t507 = m*(t492+2.0*t361*t1)+t134*t499+t137*t504;
  Real t517 = t27*t355+t348*t34;
  Real t520 = t142*t499+n*(t492+2.0*t349*t27)+t137*t517;
  Real t530 = t142*t504+t134*t517+o*(t492+2.0*t356*t34);
  Real t537 = _lambda*(t8*t1+t13*t27+t18*t34);
  Real t545 = t1*t13+t8*t27;
  Real t552 = t1*t18+t8*t34;
  Real t557 = t26+m*(t537+2.0*t22*t1)+t8*t84+t33+t134*t545+t46*t93+t40+t137*t552+t62*t103;
  Real t570 = t27*t18+t13*t34;
  Real t575 = t45+t142*t545+t22*t93+t50+n*(t537+2.0*t46*t27)+t13*t113+t55+t137*t570+t62*t117;
  Real t590 = t59+t142*t552+t22*t103+t61+t134*t570+t46*t117+t66+o*(t537+2.0*t62*t34)+t18*t128;
  Real t597 = _lambda*(t76*m+t89*n+t99*o);
  Real t604 = m*t89+t76*n;
  Real t609 = m*t99+t76*o;
  Real t612 = m*(t597+2.0*t108*m)+t134*t604+t137*t609;
  Real t622 = n*t99+t89*o;
  Real t625 = t142*t604+n*(t597+2.0*t90*n)+t137*t622;
  Real t635 = t142*t609+t134*t622+o*(t597+2.0*t100*o);
  Real t642 = _lambda*(t343*m+t348*n+t355*o);
  Real t649 = m*t348+t343*n;
  Real t654 = m*t355+t343*o;
  Real t657 = m*(t642+2.0*t361*m)+t134*t649+t137*t654;
  Real t667 = n*t355+t348*o;
  Real t670 = t142*t649+n*(t642+2.0*t349*n)+t137*t667;
  Real t680 = t142*t654+t134*t667+o*(t642+2.0*t356*o);
  Real t691 = 2.0*t133+t8*t165+4.0*t135+2.0*t46*t167+4.0*t138+2.0*t62*t170;
  Real t701 = 4.0*t143+2.0*t22*t167+2.0*t145+t13*t179+4.0*t146+2.0*t62*t181;
  Real t711 = 4.0*t150+2.0*t22*t170+4.0*t152+2.0*t46*t181+2.0*t154+t18*t192;
  Real t718 = _lambda*(t76*p+t89*q+t99*r);
  Real t725 = p*t89+t76*q;
  Real t730 = p*t99+t76*r;
  Real t733 = m*(t718+2.0*t108*p)+t134*t725+t137*t730;
  Real t743 = q*t99+t89*r;
  Real t746 = t142*t725+n*(t718+2.0*t90*q)+t137*t743;
  Real t756 = t142*t730+t134*t743+o*(t718+2.0*t100*r);
  Real t763 = _lambda*(t343*p+t348*q+t355*r);
  Real t770 = p*t348+t343*q;
  Real t775 = p*t355+t343*r;
  Real t778 = m*(t763+2.0*t361*p)+t134*t770+t137*t775;
  Real t788 = q*t355+t348*r;
  Real t791 = t142*t770+n*(t763+2.0*t349*q)+t137*t788;
  Real t801 = t142*t775+t134*t788+o*(t763+2.0*t356*r);
  Real t808 = _lambda*(t8*p+t13*q+t18*r);
  Real t816 = p*t13+t8*q;
  Real t823 = p*t18+t8*r;
  Real t828 = t197+m*(t808+2.0*t22*p)+t8*t229+t200+t134*t816+t46*t233+t203+t137*t823+t62*t238;
  Real t841 = q*t18+t13*r;
  Real t846 = t208+t142*t816+t22*t233+t209+n*(t808+2.0*t46*q)+t13*t247+t211+t137*t841+t62*t251;
  Real t861 = t215+t142*t823+t22*t238+t217+t134*t841+t46*t251+t218+o*(t808+2.0*t62*r)+t18*t262;
  Real t868 = _lambda*(t76*s+t89*t+t99*u);
  Real t875 = s*t89+t76*t;
  Real t880 = s*t99+t76*u;
  Real t883 = m*(t868+2.0*t108*s)+t134*t875+t137*t880;
  Real t893 = t*t99+t89*u;
  Real t896 = t142*t875+n*(t868+2.0*t90*t)+t137*t893;
  Real t906 = t142*t880+t134*t893+o*(t868+2.0*t100*u);
  Real t913 = _lambda*(t343*s+t348*t+t355*u);
  Real t920 = s*t348+t343*t;
  Real t925 = s*t355+t343*u;
  Real t928 = m*(t913+2.0*t361*s)+t134*t920+t137*t925;
  Real t938 = t*t355+t348*u;
  Real t941 = t142*t920+n*(t913+2.0*t349*t)+t137*t938;
  Real t951 = t142*t925+t134*t938+o*(t913+2.0*t356*u);
  Real t958 = _lambda*(t8*s+t13*t+t18*u);
  Real t966 = s*t13+t8*t;
  Real t973 = s*t18+t8*u;
  Real t978 = t267+m*(t958+2.0*t22*s)+t8*t299+t270+t134*t966+t46*t303+t273+t137*t973+t62*t308;
  Real t991 = t*t18+t13*u;
  Real t996 = t278+t142*t966+t22*t303+t279+n*(t958+2.0*t46*t)+t13*t317+t281+t137*t991+t62*t321;
  Real t1011 = t285+t142*t973+t22*t308+t287+t134*t991+t46*t321+t288+o*(t958+2.0*t62*u)+t18*t332;
  Real t1017 = t41*b10+t56*b11+t67*b12;
  Real t1025 = t140*b10+t148*b11+t155*b12;
  Real t1033 = t204*b10+t212*b11+t219*b12;
  Real t1041 = t274*b10+t282*b11+t289*b12;
  Real t1113 = t41*b20+t56*b21+t67*b22;
  Real t1121 = t140*b20+t148*b21+t155*b22;
  Real t1129 = t204*b20+t212*b21+t219*b22;
  Real t1137 = t274*b20+t282*b21+t289*b22;
  Real t1209 = t41*b30+t56*b31+t67*b32;
  Real t1217 = t140*b30+t148*b31+t155*b32;
  Real t1225 = t204*b30+t212*b31+t219*b32;
  Real t1233 = t274*b30+t282*b31+t289*b32;
  hessian(0,0) = t69;
  hessian(0,1) = 0.0;
  hessian(0,2) = t106*b00+t120*b01+t130*b02;
  hessian(0,3) = t157;
  hessian(0,4) = 0.0;
  hessian(0,5) = t173*b00+t184*b01+t194*b02;
  hessian(0,6) = t221;
  hessian(0,7) = 0.0;
  hessian(0,8) = t241*b00+t254*b01+t264*b02;
  hessian(0,9) = t291;
  hessian(0,10) = 0.0;
  hessian(0,11) = t311*b00+t324*b01+t334*b02;
  hessian(1,0) = 0.0;
  hessian(1,1) = t69;
  hessian(1,2) = t359*b00+t367*b01+t374*b02;
  hessian(1,3) = 0.0;
  hessian(1,4) = t157;
  hessian(1,5) = t382*b00+t389*b01+t396*b02;
  hessian(1,6) = 0.0;
  hessian(1,7) = t221;
  hessian(1,8) = t404*b00+t411*b01+t418*b02;
  hessian(1,9) = 0.0;
  hessian(1,10) = t291;
  hessian(1,11) = t426*b00+t433*b01+t440*b02;
  hessian(2,0) = t462*b00+t475*b01+t485*b02;
  hessian(2,1) = t507*b00+t520*b01+t530*b02;
  hessian(2,2) = t557*b00+t575*b01+t590*b02;
  hessian(2,3) = t612*b00+t625*b01+t635*b02;
  hessian(2,4) = t657*b00+t670*b01+t680*b02;
  hessian(2,5) = t691*b00+t701*b01+t711*b02;
  hessian(2,6) = t733*b00+t746*b01+t756*b02;
  hessian(2,7) = t778*b00+t791*b01+t801*b02;
  hessian(2,8) = t828*b00+t846*b01+t861*b02;
  hessian(2,9) = t883*b00+t896*b01+t906*b02;
  hessian(2,10) = t928*b00+t941*b01+t951*b02;
  hessian(2,11) = t978*b00+t996*b01+t1011*b02;
  hessian(3,0) = t1017;
  hessian(3,1) = 0.0;
  hessian(3,2) = t106*b10+t120*b11+t130*b12;
  hessian(3,3) = t1025;
  hessian(3,4) = 0.0;
  hessian(3,5) = t173*b10+t184*b11+t194*b12;
  hessian(3,6) = t1033;
  hessian(3,7) = 0.0;
  hessian(3,8) = t241*b10+t254*b11+t264*b12;
  hessian(3,9) = t1041;
  hessian(3,10) = 0.0;
  hessian(3,11) = t311*b10+t324*b11+t334*b12;
  hessian(4,0) = 0.0;
  hessian(4,1) = t1017;
  hessian(4,2) = t359*b10+t367*b11+t374*b12;
  hessian(4,3) = 0.0;
  hessian(4,4) = t1025;
  hessian(4,5) = t382*b10+t389*b11+t396*b12;
  hessian(4,6) = 0.0;
  hessian(4,7) = t1033;
  hessian(4,8) = t404*b10+t411*b11+t418*b12;
  hessian(4,9) = 0.0;
  hessian(4,10) = t1041;
  hessian(4,11) = t426*b10+t433*b11+t440*b12;
  hessian(5,0) = t462*b10+t475*b11+t485*b12;
  hessian(5,1) = t507*b10+t520*b11+t530*b12;
  hessian(5,2) = t557*b10+t575*b11+t590*b12;
  hessian(5,3) = t612*b10+t625*b11+t635*b12;
  hessian(5,4) = t657*b10+t670*b11+t680*b12;
  hessian(5,5) = t691*b10+t701*b11+t711*b12;
  hessian(5,6) = t733*b10+t746*b11+t756*b12;
  hessian(5,7) = t778*b10+t791*b11+t801*b12;
  hessian(5,8) = t828*b10+t846*b11+t861*b12;
  hessian(5,9) = t883*b10+t896*b11+t906*b12;
  hessian(5,10) = t928*b10+t941*b11+t951*b12;
  hessian(5,11) = t978*b10+t996*b11+t1011*b12;
  hessian(6,0) = t1113;
  hessian(6,1) = 0.0;
  hessian(6,2) = t106*b20+t120*b21+t130*b22;
  hessian(6,3) = t1121;
  hessian(6,4) = 0.0;
  hessian(6,5) = t173*b20+t184*b21+t194*b22;
  hessian(6,6) = t1129;
  hessian(6,7) = 0.0;
  hessian(6,8) = t241*b20+t254*b21+t264*b22;
  hessian(6,9) = t1137;
  hessian(6,10) = 0.0;
  hessian(6,11) = t311*b20+t324*b21+t334*b22;
  hessian(7,0) = 0.0;
  hessian(7,1) = t1113;
  hessian(7,2) = t359*b20+t367*b21+t374*b22;
  hessian(7,3) = 0.0;
  hessian(7,4) = t1121;
  hessian(7,5) = t382*b20+t389*b21+t396*b22;
  hessian(7,6) = 0.0;
  hessian(7,7) = t1129;
  hessian(7,8) = t404*b20+t411*b21+t418*b22;
  hessian(7,9) = 0.0;
  hessian(7,10) = t1137;
  hessian(7,11) = t426*b20+t433*b21+t440*b22;
  hessian(8,0) = t462*b20+t475*b21+t485*b22;
  hessian(8,1) = t507*b20+t520*b21+t530*b22;
  hessian(8,2) = t557*b20+t575*b21+t590*b22;
  hessian(8,3) = t612*b20+t625*b21+t635*b22;
  hessian(8,4) = t657*b20+t670*b21+t680*b22;
  hessian(8,5) = t691*b20+t701*b21+t711*b22;
  hessian(8,6) = t733*b20+t746*b21+t756*b22;
  hessian(8,7) = t778*b20+t791*b21+t801*b22;
  hessian(8,8) = t828*b20+t846*b21+t861*b22;
  hessian(8,9) = t883*b20+t896*b21+t906*b22;
  hessian(8,10) = t928*b20+t941*b21+t951*b22;
  hessian(8,11) = t978*b20+t996*b21+t1011*b22;
  hessian(9,0) = t1209;
  hessian(9,1) = 0.0;
  hessian(9,2) = t106*b30+t120*b31+t130*b32;
  hessian(9,3) = t1217;
  hessian(9,4) = 0.0;
  hessian(9,5) = t173*b30+t184*b31+t194*b32;
  hessian(9,6) = t1225;
  hessian(9,7) = 0.0;
  hessian(9,8) = t241*b30+t254*b31+t264*b32;
  hessian(9,9) = t1233;
  hessian(9,10) = 0.0;
  hessian(9,11) = t311*b30+t324*b31+t334*b32;
  hessian(10,0) = 0.0;
  hessian(10,1) = t1209;
  hessian(10,2) = t359*b30+t367*b31+t374*b32;
  hessian(10,3) = 0.0;
  hessian(10,4) = t1217;
  hessian(10,5) = t382*b30+t389*b31+t396*b32;
  hessian(10,6) = 0.0;
  hessian(10,7) = t1225;
  hessian(10,8) = t404*b30+t411*b31+t418*b32;
  hessian(10,9) = 0.0;
  hessian(10,10) = t1233;
  hessian(10,11) = t426*b30+t433*b31+t440*b32;
  hessian(11,0) = t462*b30+t475*b31+t485*b32;
  hessian(11,1) = t507*b30+t520*b31+t530*b32;
  hessian(11,2) = t557*b30+t575*b31+t590*b32;
  hessian(11,3) = t612*b30+t625*b31+t635*b32;
  hessian(11,4) = t657*b30+t670*b31+t680*b32;
  hessian(11,5) = t691*b30+t701*b31+t711*b32;
  hessian(11,6) = t733*b30+t746*b31+t756*b32;
  hessian(11,7) = t778*b30+t791*b31+t801*b32;
  hessian(11,8) = t828*b30+t846*b31+t861*b32;
  hessian(11,9) = t883*b30+t896*b31+t906*b32;
  hessian(11,10) = t928*b30+t941*b31+t951*b32;
  hessian(11,11) = t978*b30+t996*b31+t1011*b32;
   
}

void STVK::hessian6(MATRIX3& DmInv, const VEC3F* bVecs, const VEC3F* vertices, MATRIX& hessian)
{
  Real b00 = bVecs[0][0];
  Real b01 = bVecs[0][1];
  Real b02 = bVecs[0][2];
  Real b10 = bVecs[1][0];
  Real b11 = bVecs[1][1];
  Real b12 = bVecs[1][2];
  Real b20 = bVecs[2][0];
  Real b21 = bVecs[2][1];
  Real b22 = bVecs[2][2];
  Real b30 = bVecs[3][0];
  Real b31 = bVecs[3][1];
  Real b32 = bVecs[3][2];

  Real a = vertices[0][0];
  Real b = vertices[0][1];
  Real c = vertices[0][2];

  Real d = vertices[1][0];
  Real e = vertices[1][1];
  Real f = vertices[1][2];

  Real g = vertices[2][0];
  Real h = vertices[2][1];
  Real i = vertices[2][2];

  Real j = vertices[3][0];
  Real k = vertices[3][1];
  Real l = vertices[3][2];
 
  Real m = DmInv(0,0);
  Real n = DmInv(0,1);
  Real o = DmInv(0,2);
  Real p = DmInv(1,0);
  Real q = DmInv(1,1);
  Real r = DmInv(1,2);
  Real s = DmInv(2,0);
  Real t = DmInv(2,1);
  Real u = DmInv(2,2);

  Real t1 = -m-p-s;
  Real t2 = d-a;
  Real t4 = g-a;
  Real t6 = j-a;
  Real t8 = t2*m+t4*p+t6*s;
  Real t13 = t2*n+t4*q+t6*t;
  Real t18 = t2*o+t4*r+t6*u;
  Real t21 = _lambda*(t8*p+t13*q+t18*r);
  Real t22 = _mu*t8;
  Real t25 = t21+2.0*t22*p;
  Real t26 = t1*t25;
  Real t28 = -n-q-t;
  Real t30 = -o-r-u;
  Real t33 = _lambda*(t8*t1+t13*t28+t18*t30);
  Real t42 = _lambda*(p*t1+q*t28+r*t30);
  Real t43 = _mu*p;
  Real t46 = t42+2.0*t43*t1;
  Real t48 = t28*_mu;
  Real t51 = p*t13+t8*q;
  Real t53 = t48*t51;
  Real t54 = q*_mu;
  Real t57 = t1*t13+t8*t28;
  Real t60 = t13*_mu;
  Real t63 = t1*q+p*t28;
  Real t66 = t30*_mu;
  Real t69 = p*t18+t8*r;
  Real t71 = t66*t69;
  Real t72 = r*_mu;
  Real t75 = t1*t18+t8*t30;
  Real t78 = t18*_mu;
  Real t81 = t1*r+p*t30;
  Real t84 = t26+p*(t33+2.0*t22*t1)+t8*t46+t53+t54*t57+t60*t63+t71+t72*t75+t78*t81;
  Real t86 = t1*_mu;
  Real t88 = t86*t51;
  Real t95 = t21+2.0*t60*q;
  Real t96 = t28*t95;
  Real t103 = t42+2.0*t54*t28;
  Real t107 = q*t18+t13*r;
  Real t109 = t66*t107;
  Real t112 = t28*t18+t13*t30;
  Real t117 = t28*r+q*t30;
  Real t120 = t88+t43*t57+t22*t63+t96+q*(t33+2.0*t60*t28)+t13*t103+t109+t72*t112+t78*t117;
  Real t123 = t86*t69;
  Real t129 = t48*t107;
  Real t136 = t21+2.0*t78*r;
  Real t137 = t30*t136;
  Real t144 = t42+2.0*t72*t30;
  Real t146 = t123+t43*t75+t22*t81+t129+t54*t112+t60*t117+t137+r*(t33+2.0*t78*t30)+t18*t144;
  Real t149 = e-b;
  Real t151 = h-b;
  Real t153 = k-b;
  Real t155 = t149*m+t151*p+t153*s;
  Real t160 = t149*n+t151*q+t153*t;
  Real t165 = t149*o+t151*r+t153*u;
  Real t168 = _lambda*(t155*t1+t160*t28+t165*t30);
  Real t169 = _mu*t155;
  Real t176 = t1*t160+t155*t28;
  Real t181 = t1*t165+t155*t30;
  Real t184 = p*(t168+2.0*t169*t1)+t54*t176+t72*t181;
  Real t188 = _mu*t160;
  Real t195 = t28*t165+t160*t30;
  Real t198 = t43*t176+q*(t168+2.0*t188*t28)+t72*t195;
  Real t204 = _mu*t165;
  Real t209 = t43*t181+t54*t195+r*(t168+2.0*t204*t30);
  Real t212 = f-c;
  Real t214 = i-c;
  Real t216 = l-c;
  Real t218 = t212*m+t214*p+t216*s;
  Real t223 = t212*n+t214*q+t216*t;
  Real t228 = t212*o+t214*r+t216*u;
  Real t231 = _lambda*(t218*t1+t223*t28+t228*t30);
  Real t232 = _mu*t218;
  Real t239 = t1*t223+t218*t28;
  Real t244 = t1*t228+t218*t30;
  Real t247 = p*(t231+2.0*t232*t1)+t54*t239+t72*t244;
  Real t251 = _mu*t223;
  Real t258 = t28*t228+t223*t30;
  Real t261 = t43*t239+q*(t231+2.0*t251*t28)+t72*t258;
  Real t267 = _mu*t228;
  Real t272 = t43*t244+t54*t258+r*(t231+2.0*t267*t30);
  Real t275 = m*t25;
  Real t280 = _lambda*(t8*m+t13*n+t18*o);
  Real t289 = _lambda*(m*p+n*q+o*r);
  Real t290 = _mu*m;
  Real t293 = t289+2.0*t290*p;
  Real t295 = n*_mu;
  Real t297 = t295*t51;
  Real t300 = m*t13+t8*n;
  Real t305 = p*n+m*q;
  Real t308 = o*_mu;
  Real t310 = t308*t69;
  Real t313 = m*t18+t8*o;
  Real t318 = p*o+m*r;
  Real t321 = t275+p*(t280+2.0*t22*m)+t8*t293+t297+t54*t300+t60*t305+t310+t72*t313+t78*t318;
  Real t324 = t290*t51;
  Real t329 = n*t95;
  Real t336 = t289+2.0*t295*q;
  Real t339 = t308*t107;
  Real t342 = n*t18+t13*o;
  Real t347 = q*o+n*r;
  Real t350 = t324+t43*t300+t22*t305+t329+q*(t280+2.0*t60*n)+t13*t336+t339+t72*t342+t78*t347;
  Real t353 = t290*t69;
  Real t359 = t295*t107;
  Real t364 = o*t136;
  Real t371 = t289+2.0*t308*r;
  Real t373 = t353+t43*t313+t22*t318+t359+t54*t342+t60*t347+t364+r*(t280+2.0*t78*o)+t18*t371;
  Real t380 = _lambda*(t155*m+t160*n+t165*o);
  Real t387 = m*t160+t155*n;
  Real t392 = m*t165+t155*o;
  Real t395 = p*(t380+2.0*t169*m)+t54*t387+t72*t392;
  Real t405 = n*t165+t160*o;
  Real t408 = t43*t387+q*(t380+2.0*t188*n)+t72*t405;
  Real t418 = t43*t392+t54*t405+r*(t380+2.0*t204*o);
  Real t425 = _lambda*(t218*m+t223*n+t228*o);
  Real t432 = m*t223+t218*n;
  Real t437 = m*t228+t218*o;
  Real t440 = p*(t425+2.0*t232*m)+t54*t432+t72*t437;
  Real t450 = n*t228+t223*o;
  Real t453 = t43*t432+q*(t425+2.0*t251*n)+t72*t450;
  Real t463 = t43*t437+t54*t450+r*(t425+2.0*t267*o);
  Real t466 = p*t25;
  Real t468 = p*p;
  Real t469 = q*q;
  Real t470 = r*r;
  Real t472 = _lambda*(t468+t469+t470);
  Real t475 = t472+2.0*_mu*t468;
  Real t477 = t54*t51/2.0;
  Real t479 = p*q;
  Real t482 = t72*t69/2.0;
  Real t484 = p*r;
  Real t487 = 2.0*t466+t8*t475+4.0*t477+2.0*t60*t479+4.0*t482+2.0*t78*t484;
  Real t489 = t43*t51/2.0;
  Real t493 = q*t95;
  Real t497 = t472+2.0*_mu*t469;
  Real t499 = t72*t107/2.0;
  Real t501 = q*r;
  Real t504 = 4.0*t489+2.0*t22*t479+2.0*t493+t13*t497+4.0*t499+2.0*t78*t501;
  Real t506 = t43*t69/2.0;
  Real t510 = t54*t107/2.0;
  Real t514 = r*t136;
  Real t518 = t472+2.0*_mu*t470;
  Real t520 = 4.0*t506+2.0*t22*t484+4.0*t510+2.0*t60*t501+2.0*t514+t18*t518;
  Real t527 = _lambda*(t155*p+t160*q+t165*r);
  Real t534 = p*t160+t155*q;
  Real t539 = p*t165+t155*r;
  Real t542 = p*(t527+2.0*t169*p)+t54*t534+t72*t539;
  Real t552 = q*t165+t160*r;
  Real t555 = t43*t534+q*(t527+2.0*t188*q)+t72*t552;
  Real t565 = t43*t539+t54*t552+r*(t527+2.0*t204*r);
  Real t572 = _lambda*(t218*p+t223*q+t228*r);
  Real t579 = p*t223+t218*q;
  Real t584 = p*t228+t218*r;
  Real t587 = p*(t572+2.0*t232*p)+t54*t579+t72*t584;
  Real t597 = q*t228+t223*r;
  Real t600 = t43*t579+q*(t572+2.0*t251*q)+t72*t597;
  Real t610 = t43*t584+t54*t597+r*(t572+2.0*t267*r);
  Real t613 = s*t25;
  Real t618 = _lambda*(t8*s+t13*t+t18*u);
  Real t627 = _lambda*(p*s+q*t+r*u);
  Real t630 = t627+2.0*t43*s;
  Real t632 = t*_mu;
  Real t634 = t632*t51;
  Real t637 = s*t13+t8*t;
  Real t642 = s*q+p*t;
  Real t645 = u*_mu;
  Real t647 = t645*t69;
  Real t650 = s*t18+t8*u;
  Real t655 = s*r+p*u;
  Real t658 = t613+p*(t618+2.0*t22*s)+t8*t630+t634+t54*t637+t60*t642+t647+t72*t650+t78*t655;
  Real t660 = s*_mu;
  Real t662 = t660*t51;
  Real t667 = t*t95;
  Real t674 = t627+2.0*t54*t;
  Real t677 = t645*t107;
  Real t680 = t*t18+t13*u;
  Real t685 = t*r+q*u;
  Real t688 = t662+t43*t637+t22*t642+t667+q*(t618+2.0*t60*t)+t13*t674+t677+t72*t680+t78*t685;
  Real t691 = t660*t69;
  Real t697 = t632*t107;
  Real t702 = u*t136;
  Real t709 = t627+2.0*t72*u;
  Real t711 = t691+t43*t650+t22*t655+t697+t54*t680+t60*t685+t702+r*(t618+2.0*t78*u)+t18*t709;
  Real t718 = _lambda*(t155*s+t160*t+t165*u);
  Real t725 = s*t160+t155*t;
  Real t730 = s*t165+t155*u;
  Real t733 = p*(t718+2.0*t169*s)+t54*t725+t72*t730;
  Real t743 = t*t165+t160*u;
  Real t746 = t43*t725+q*(t718+2.0*t188*t)+t72*t743;
  Real t756 = t43*t730+t54*t743+r*(t718+2.0*t204*u);
  Real t763 = _lambda*(t218*s+t223*t+t228*u);
  Real t770 = s*t223+t218*t;
  Real t775 = s*t228+t218*u;
  Real t778 = p*(t763+2.0*t232*s)+t54*t770+t72*t775;
  Real t788 = t*t228+t223*u;
  Real t791 = t43*t770+q*(t763+2.0*t251*t)+t72*t788;
  Real t801 = t43*t775+t54*t788+r*(t763+2.0*t267*u);
  Real t809 = t155*t46+t188*t63+t204*t81;
  Real t816 = t169*t63+t160*t103+t204*t117;
  Real t823 = t169*t81+t188*t117+t165*t144;
  Real t826 = t26+t53+t71;
  Real t828 = t88+t96+t109;
  Real t830 = t123+t129+t137;
  Real t832 = t826*b00+t828*b01+t830*b02;
  Real t838 = t155*t293+t188*t305+t204*t318;
  Real t845 = t169*t305+t160*t336+t204*t347;
  Real t852 = t169*t318+t188*t347+t165*t371;
  Real t855 = t275+t297+t310;
  Real t857 = t324+t329+t339;
  Real t859 = t353+t359+t364;
  Real t861 = t855*b00+t857*b01+t859*b02;
  Real t867 = t155*t475+2.0*t188*t479+2.0*t204*t484;
  Real t874 = 2.0*t169*t479+t160*t497+2.0*t204*t501;
  Real t881 = 2.0*t169*t484+2.0*t188*t501+t165*t518;
  Real t886 = t466+2.0*t477+2.0*t482;
  Real t890 = 2.0*t489+t493+2.0*t499;
  Real t894 = 2.0*t506+2.0*t510+t514;
  Real t896 = t886*b00+t890*b01+t894*b02;
  Real t902 = t155*t630+t188*t642+t204*t655;
  Real t909 = t169*t642+t160*t674+t204*t685;
  Real t916 = t169*t655+t188*t685+t165*t709;
  Real t919 = t613+t634+t647;
  Real t921 = t662+t667+t677;
  Real t923 = t691+t697+t702;
  Real t925 = t919*b00+t921*b01+t923*b02;
  Real t931 = t218*t46+t251*t63+t267*t81;
  Real t938 = t232*t63+t223*t103+t267*t117;
  Real t945 = t232*t81+t251*t117+t228*t144;
  Real t953 = t218*t293+t251*t305+t267*t318;
  Real t960 = t232*t305+t223*t336+t267*t347;
  Real t967 = t232*t318+t251*t347+t228*t371;
  Real t975 = t218*t475+2.0*t251*t479+2.0*t267*t484;
  Real t982 = 2.0*t232*t479+t223*t497+2.0*t267*t501;
  Real t989 = 2.0*t232*t484+2.0*t251*t501+t228*t518;
  Real t997 = t218*t630+t251*t642+t267*t655;
  Real t1004 = t232*t642+t223*t674+t267*t685;
  Real t1011 = t232*t655+t251*t685+t228*t709;
  Real t1069 = t826*b10+t828*b11+t830*b12;
  Real t1077 = t855*b10+t857*b11+t859*b12;
  Real t1085 = t886*b10+t890*b11+t894*b12;
  Real t1093 = t919*b10+t921*b11+t923*b12;
  Real t1165 = t826*b20+t828*b21+t830*b22;
  Real t1173 = t855*b20+t857*b21+t859*b22;
  Real t1181 = t886*b20+t890*b21+t894*b22;
  Real t1189 = t919*b20+t921*b21+t923*b22;
  Real t1261 = t826*b30+t828*b31+t830*b32;
  Real t1269 = t855*b30+t857*b31+t859*b32;
  Real t1277 = t886*b30+t890*b31+t894*b32;
  Real t1285 = t919*b30+t921*b31+t923*b32;
  hessian(0,0) = t84*b00+t120*b01+t146*b02;
  hessian(0,1) = t184*b00+t198*b01+t209*b02;
  hessian(0,2) = t247*b00+t261*b01+t272*b02;
  hessian(0,3) = t321*b00+t350*b01+t373*b02;
  hessian(0,4) = t395*b00+t408*b01+t418*b02;
  hessian(0,5) = t440*b00+t453*b01+t463*b02;
  hessian(0,6) = t487*b00+t504*b01+t520*b02;
  hessian(0,7) = t542*b00+t555*b01+t565*b02;
  hessian(0,8) = t587*b00+t600*b01+t610*b02;
  hessian(0,9) = t658*b00+t688*b01+t711*b02;
  hessian(0,10) = t733*b00+t746*b01+t756*b02;
  hessian(0,11) = t778*b00+t791*b01+t801*b02;
  hessian(1,0) = t809*b00+t816*b01+t823*b02;
  hessian(1,1) = t832;
  hessian(1,2) = 0.0;
  hessian(1,3) = t838*b00+t845*b01+t852*b02;
  hessian(1,4) = t861;
  hessian(1,5) = 0.0;
  hessian(1,6) = t867*b00+t874*b01+t881*b02;
  hessian(1,7) = t896;
  hessian(1,8) = 0.0;
  hessian(1,9) = t902*b00+t909*b01+t916*b02;
  hessian(1,10) = t925;
  hessian(1,11) = 0.0;
  hessian(2,0) = t931*b00+t938*b01+t945*b02;
  hessian(2,1) = 0.0;
  hessian(2,2) = t832;
  hessian(2,3) = t953*b00+t960*b01+t967*b02;
  hessian(2,4) = 0.0;
  hessian(2,5) = t861;
  hessian(2,6) = t975*b00+t982*b01+t989*b02;
  hessian(2,7) = 0.0;
  hessian(2,8) = t896;
  hessian(2,9) = t997*b00+t1004*b01+t1011*b02;
  hessian(2,10) = 0.0;
  hessian(2,11) = t925;
  hessian(3,0) = t84*b10+t120*b11+t146*b12;
  hessian(3,1) = t184*b10+t198*b11+t209*b12;
  hessian(3,2) = t247*b10+t261*b11+t272*b12;
  hessian(3,3) = t321*b10+t350*b11+t373*b12;
  hessian(3,4) = t395*b10+t408*b11+t418*b12;
  hessian(3,5) = t440*b10+t453*b11+t463*b12;
  hessian(3,6) = t487*b10+t504*b11+t520*b12;
  hessian(3,7) = t542*b10+t555*b11+t565*b12;
  hessian(3,8) = t587*b10+t600*b11+t610*b12;
  hessian(3,9) = t658*b10+t688*b11+t711*b12;
  hessian(3,10) = t733*b10+t746*b11+t756*b12;
  hessian(3,11) = t778*b10+t791*b11+t801*b12;
  hessian(4,0) = t809*b10+t816*b11+t823*b12;
  hessian(4,1) = t1069;
  hessian(4,2) = 0.0;
  hessian(4,3) = t838*b10+t845*b11+t852*b12;
  hessian(4,4) = t1077;
  hessian(4,5) = 0.0;
  hessian(4,6) = t867*b10+t874*b11+t881*b12;
  hessian(4,7) = t1085;
  hessian(4,8) = 0.0;
  hessian(4,9) = t902*b10+t909*b11+t916*b12;
  hessian(4,10) = t1093;
  hessian(4,11) = 0.0;
  hessian(5,0) = t931*b10+t938*b11+t945*b12;
  hessian(5,1) = 0.0;
  hessian(5,2) = t1069;
  hessian(5,3) = t953*b10+t960*b11+t967*b12;
  hessian(5,4) = 0.0;
  hessian(5,5) = t1077;
  hessian(5,6) = t975*b10+t982*b11+t989*b12;
  hessian(5,7) = 0.0;
  hessian(5,8) = t1085;
  hessian(5,9) = t997*b10+t1004*b11+t1011*b12;
  hessian(5,10) = 0.0;
  hessian(5,11) = t1093;
  hessian(6,0) = t84*b20+t120*b21+t146*b22;
  hessian(6,1) = t184*b20+t198*b21+t209*b22;
  hessian(6,2) = t247*b20+t261*b21+t272*b22;
  hessian(6,3) = t321*b20+t350*b21+t373*b22;
  hessian(6,4) = t395*b20+t408*b21+t418*b22;
  hessian(6,5) = t440*b20+t453*b21+t463*b22;
  hessian(6,6) = t487*b20+t504*b21+t520*b22;
  hessian(6,7) = t542*b20+t555*b21+t565*b22;
  hessian(6,8) = t587*b20+t600*b21+t610*b22;
  hessian(6,9) = t658*b20+t688*b21+t711*b22;
  hessian(6,10) = t733*b20+t746*b21+t756*b22;
  hessian(6,11) = t778*b20+t791*b21+t801*b22;
  hessian(7,0) = t809*b20+t816*b21+t823*b22;
  hessian(7,1) = t1165;
  hessian(7,2) = 0.0;
  hessian(7,3) = t838*b20+t845*b21+t852*b22;
  hessian(7,4) = t1173;
  hessian(7,5) = 0.0;
  hessian(7,6) = t867*b20+t874*b21+t881*b22;
  hessian(7,7) = t1181;
  hessian(7,8) = 0.0;
  hessian(7,9) = t902*b20+t909*b21+t916*b22;
  hessian(7,10) = t1189;
  hessian(7,11) = 0.0;
  hessian(8,0) = t931*b20+t938*b21+t945*b22;
  hessian(8,1) = 0.0;
  hessian(8,2) = t1165;
  hessian(8,3) = t953*b20+t960*b21+t967*b22;
  hessian(8,4) = 0.0;
  hessian(8,5) = t1173;
  hessian(8,6) = t975*b20+t982*b21+t989*b22;
  hessian(8,7) = 0.0;
  hessian(8,8) = t1181;
  hessian(8,9) = t997*b20+t1004*b21+t1011*b22;
  hessian(8,10) = 0.0;
  hessian(8,11) = t1189;
  hessian(9,0) = t84*b30+t120*b31+t146*b32;
  hessian(9,1) = t184*b30+t198*b31+t209*b32;
  hessian(9,2) = t247*b30+t261*b31+t272*b32;
  hessian(9,3) = t321*b30+t350*b31+t373*b32;
  hessian(9,4) = t395*b30+t408*b31+t418*b32;
  hessian(9,5) = t440*b30+t453*b31+t463*b32;
  hessian(9,6) = t487*b30+t504*b31+t520*b32;
  hessian(9,7) = t542*b30+t555*b31+t565*b32;
  hessian(9,8) = t587*b30+t600*b31+t610*b32;
  hessian(9,9) = t658*b30+t688*b31+t711*b32;
  hessian(9,10) = t733*b30+t746*b31+t756*b32;
  hessian(9,11) = t778*b30+t791*b31+t801*b32;
  hessian(10,0) = t809*b30+t816*b31+t823*b32;
  hessian(10,1) = t1261;
  hessian(10,2) = 0.0;
  hessian(10,3) = t838*b30+t845*b31+t852*b32;
  hessian(10,4) = t1269;
  hessian(10,5) = 0.0;
  hessian(10,6) = t867*b30+t874*b31+t881*b32;
  hessian(10,7) = t1277;
  hessian(10,8) = 0.0;
  hessian(10,9) = t902*b30+t909*b31+t916*b32;
  hessian(10,10) = t1285;
  hessian(10,11) = 0.0;
  hessian(11,0) = t931*b30+t938*b31+t945*b32;
  hessian(11,1) = 0.0;
  hessian(11,2) = t1261;
  hessian(11,3) = t953*b30+t960*b31+t967*b32;
  hessian(11,4) = 0.0;
  hessian(11,5) = t1269;
  hessian(11,6) = t975*b30+t982*b31+t989*b32;
  hessian(11,7) = 0.0;
  hessian(11,8) = t1277;
  hessian(11,9) = t997*b30+t1004*b31+t1011*b32;
  hessian(11,10) = 0.0;
  hessian(11,11) = t1285;
   
}

void STVK::hessian7(MATRIX3& DmInv, const VEC3F* bVecs, const VEC3F* vertices, MATRIX& hessian)
{
  Real b00 = bVecs[0][0];
  Real b01 = bVecs[0][1];
  Real b02 = bVecs[0][2];
  Real b10 = bVecs[1][0];
  Real b11 = bVecs[1][1];
  Real b12 = bVecs[1][2];
  Real b20 = bVecs[2][0];
  Real b21 = bVecs[2][1];
  Real b22 = bVecs[2][2];
  Real b30 = bVecs[3][0];
  Real b31 = bVecs[3][1];
  Real b32 = bVecs[3][2];

  Real a = vertices[0][0];
  Real b = vertices[0][1];
  Real c = vertices[0][2];

  Real d = vertices[1][0];
  Real e = vertices[1][1];
  Real f = vertices[1][2];

  Real g = vertices[2][0];
  Real h = vertices[2][1];
  Real i = vertices[2][2];

  Real j = vertices[3][0];
  Real k = vertices[3][1];
  Real l = vertices[3][2];
 
  Real m = DmInv(0,0);
  Real n = DmInv(0,1);
  Real o = DmInv(0,2);
  Real p = DmInv(1,0);
  Real q = DmInv(1,1);
  Real r = DmInv(1,2);
  Real s = DmInv(2,0);
  Real t = DmInv(2,1);
  Real u = DmInv(2,2);

  Real t1 = -m-p-s;
  Real t2 = e-b;
  Real t4 = h-b;
  Real t6 = k-b;
  Real t8 = t2*m+t4*p+t6*s;
  Real t13 = t2*n+t4*q+t6*t;
  Real t18 = t2*o+t4*r+t6*u;
  Real t21 = _lambda*(t8*p+t13*q+t18*r);
  Real t22 = _mu*t8;
  Real t25 = t21+2.0*t22*p;
  Real t26 = t1*t25;
  Real t27 = -n-q-t;
  Real t28 = t27*_mu;
  Real t31 = p*t13+t8*q;
  Real t33 = t28*t31;
  Real t34 = -o-r-u;
  Real t35 = t34*_mu;
  Real t38 = p*t18+t8*r;
  Real t40 = t35*t38;
  Real t41 = t26+t33+t40;
  Real t43 = t1*_mu;
  Real t45 = t43*t31;
  Real t46 = _mu*t13;
  Real t49 = t21+2.0*t46*q;
  Real t50 = t27*t49;
  Real t53 = q*t18+t13*r;
  Real t55 = t35*t53;
  Real t56 = t45+t50+t55;
  Real t59 = t43*t38;
  Real t61 = t28*t53;
  Real t62 = _mu*t18;
  Real t65 = t21+2.0*t62*r;
  Real t66 = t34*t65;
  Real t67 = t59+t61+t66;
  Real t69 = t41*b00+t56*b01+t67*b02;
  Real t70 = d-a;
  Real t72 = g-a;
  Real t74 = j-a;
  Real t76 = t70*m+t72*p+t74*s;
  Real t81 = _lambda*(p*t1+q*t27+r*t34);
  Real t82 = _mu*p;
  Real t85 = t81+2.0*t82*t1;
  Real t90 = t70*n+t72*q+t74*t;
  Real t91 = t90*_mu;
  Real t94 = t1*q+p*t27;
  Real t100 = t70*o+t72*r+t74*u;
  Real t101 = t100*_mu;
  Real t104 = t1*r+p*t34;
  Real t107 = t76*t85+t91*t94+t101*t104;
  Real t109 = t76*_mu;
  Real t112 = _mu*q;
  Real t115 = t81+2.0*t112*t27;
  Real t119 = t27*r+q*t34;
  Real t122 = t109*t94+t90*t115+t101*t119;
  Real t128 = _mu*r;
  Real t131 = t81+2.0*t128*t34;
  Real t133 = t109*t104+t91*t119+t100*t131;
  Real t136 = m*t25;
  Real t137 = n*_mu;
  Real t139 = t137*t31;
  Real t140 = o*_mu;
  Real t142 = t140*t38;
  Real t143 = t136+t139+t142;
  Real t145 = m*_mu;
  Real t147 = t145*t31;
  Real t148 = n*t49;
  Real t150 = t140*t53;
  Real t151 = t147+t148+t150;
  Real t154 = t145*t38;
  Real t156 = t137*t53;
  Real t157 = o*t65;
  Real t158 = t154+t156+t157;
  Real t160 = t143*b00+t151*b01+t158*b02;
  Real t165 = _lambda*(m*p+n*q+o*r);
  Real t168 = t165+2.0*t145*p;
  Real t172 = p*n+m*q;
  Real t177 = p*o+m*r;
  Real t180 = t76*t168+t91*t172+t101*t177;
  Real t186 = t165+2.0*t137*q;
  Real t190 = q*o+n*r;
  Real t193 = t109*t172+t90*t186+t101*t190;
  Real t201 = t165+2.0*t140*r;
  Real t203 = t109*t177+t91*t190+t100*t201;
  Real t206 = p*t25;
  Real t207 = t112*t31/2.0;
  Real t209 = t128*t38/2.0;
  Real t211 = t206+2.0*t207+2.0*t209;
  Real t213 = t82*t31/2.0;
  Real t215 = q*t49;
  Real t216 = t128*t53/2.0;
  Real t218 = 2.0*t213+t215+2.0*t216;
  Real t220 = t82*t38/2.0;
  Real t222 = t112*t53/2.0;
  Real t224 = r*t65;
  Real t225 = 2.0*t220+2.0*t222+t224;
  Real t227 = t211*b00+t218*b01+t225*b02;
  Real t228 = p*p;
  Real t229 = q*q;
  Real t230 = r*r;
  Real t232 = _lambda*(t228+t229+t230);
  Real t235 = t232+2.0*_mu*t228;
  Real t237 = p*q;
  Real t240 = p*r;
  Real t243 = t76*t235+2.0*t91*t237+2.0*t101*t240;
  Real t249 = t232+2.0*_mu*t229;
  Real t251 = q*r;
  Real t254 = 2.0*t109*t237+t90*t249+2.0*t101*t251;
  Real t262 = t232+2.0*_mu*t230;
  Real t264 = 2.0*t109*t240+2.0*t91*t251+t100*t262;
  Real t267 = s*t25;
  Real t268 = t*_mu;
  Real t270 = t268*t31;
  Real t271 = u*_mu;
  Real t273 = t271*t38;
  Real t274 = t267+t270+t273;
  Real t276 = s*_mu;
  Real t278 = t276*t31;
  Real t279 = t*t49;
  Real t281 = t271*t53;
  Real t282 = t278+t279+t281;
  Real t285 = t276*t38;
  Real t287 = t268*t53;
  Real t288 = u*t65;
  Real t289 = t285+t287+t288;
  Real t291 = t274*b00+t282*b01+t289*b02;
  Real t296 = _lambda*(p*s+q*t+r*u);
  Real t299 = t296+2.0*t82*s;
  Real t303 = s*q+p*t;
  Real t308 = s*r+p*u;
  Real t311 = t76*t299+t91*t303+t101*t308;
  Real t317 = t296+2.0*t112*t;
  Real t321 = t*r+q*u;
  Real t324 = t109*t303+t90*t317+t101*t321;
  Real t332 = t296+2.0*t128*u;
  Real t334 = t109*t308+t91*t321+t100*t332;
  Real t341 = _lambda*(t76*t1+t90*t27+t100*t34);
  Real t348 = t1*t90+t76*t27;
  Real t353 = t1*t100+t76*t34;
  Real t356 = p*(t341+2.0*t109*t1)+t112*t348+t128*t353;
  Real t366 = t27*t100+t90*t34;
  Real t369 = t82*t348+q*(t341+2.0*t91*t27)+t128*t366;
  Real t379 = t82*t353+t112*t366+r*(t341+2.0*t101*t34);
  Real t386 = _lambda*(t8*t1+t13*t27+t18*t34);
  Real t394 = t1*t13+t8*t27;
  Real t401 = t1*t18+t8*t34;
  Real t406 = t26+p*(t386+2.0*t22*t1)+t8*t85+t33+t112*t394+t46*t94+t40+t128*t401+t62*t104;
  Real t419 = t27*t18+t13*t34;
  Real t424 = t45+t82*t394+t22*t94+t50+q*(t386+2.0*t46*t27)+t13*t115+t55+t128*t419+t62*t119;
  Real t439 = t59+t82*t401+t22*t104+t61+t112*t419+t46*t119+t66+r*(t386+2.0*t62*t34)+t18*t131;
  Real t442 = f-c;
  Real t444 = i-c;
  Real t446 = l-c;
  Real t448 = t442*m+t444*p+t446*s;
  Real t453 = t442*n+t444*q+t446*t;
  Real t458 = t442*o+t444*r+t446*u;
  Real t461 = _lambda*(t448*t1+t453*t27+t458*t34);
  Real t462 = _mu*t448;
  Real t469 = t1*t453+t448*t27;
  Real t474 = t1*t458+t448*t34;
  Real t477 = p*(t461+2.0*t462*t1)+t112*t469+t128*t474;
  Real t481 = _mu*t453;
  Real t488 = t27*t458+t453*t34;
  Real t491 = t82*t469+q*(t461+2.0*t481*t27)+t128*t488;
  Real t497 = _mu*t458;
  Real t502 = t82*t474+t112*t488+r*(t461+2.0*t497*t34);
  Real t509 = _lambda*(t76*m+t90*n+t100*o);
  Real t516 = m*t90+t76*n;
  Real t521 = m*t100+t76*o;
  Real t524 = p*(t509+2.0*t109*m)+t112*t516+t128*t521;
  Real t534 = n*t100+t90*o;
  Real t537 = t82*t516+q*(t509+2.0*t91*n)+t128*t534;
  Real t547 = t82*t521+t112*t534+r*(t509+2.0*t101*o);
  Real t554 = _lambda*(t8*m+t13*n+t18*o);
  Real t562 = m*t13+t8*n;
  Real t569 = m*t18+t8*o;
  Real t574 = t136+p*(t554+2.0*t22*m)+t8*t168+t139+t112*t562+t46*t172+t142+t128*t569+t62*t177;
  Real t587 = n*t18+t13*o;
  Real t592 = t147+t82*t562+t22*t172+t148+q*(t554+2.0*t46*n)+t13*t186+t150+t128*t587+t62*t190;
  Real t607 = t154+t82*t569+t22*t177+t156+t112*t587+t46*t190+t157+r*(t554+2.0*t62*o)+t18*t201;
  Real t614 = _lambda*(t448*m+t453*n+t458*o);
  Real t621 = m*t453+t448*n;
  Real t626 = m*t458+t448*o;
  Real t629 = p*(t614+2.0*t462*m)+t112*t621+t128*t626;
  Real t639 = n*t458+t453*o;
  Real t642 = t82*t621+q*(t614+2.0*t481*n)+t128*t639;
  Real t652 = t82*t626+t112*t639+r*(t614+2.0*t497*o);
  Real t659 = _lambda*(t76*p+t90*q+t100*r);
  Real t666 = p*t90+t76*q;
  Real t671 = p*t100+t76*r;
  Real t674 = p*(t659+2.0*t109*p)+t112*t666+t128*t671;
  Real t684 = q*t100+t90*r;
  Real t687 = t82*t666+q*(t659+2.0*t91*q)+t128*t684;
  Real t697 = t82*t671+t112*t684+r*(t659+2.0*t101*r);
  Real t708 = 2.0*t206+t8*t235+4.0*t207+2.0*t46*t237+4.0*t209+2.0*t62*t240;
  Real t718 = 4.0*t213+2.0*t22*t237+2.0*t215+t13*t249+4.0*t216+2.0*t62*t251;
  Real t728 = 4.0*t220+2.0*t22*t240+4.0*t222+2.0*t46*t251+2.0*t224+t18*t262;
  Real t735 = _lambda*(t448*p+t453*q+t458*r);
  Real t742 = p*t453+t448*q;
  Real t747 = p*t458+t448*r;
  Real t750 = p*(t735+2.0*t462*p)+t112*t742+t128*t747;
  Real t760 = q*t458+t453*r;
  Real t763 = t82*t742+q*(t735+2.0*t481*q)+t128*t760;
  Real t773 = t82*t747+t112*t760+r*(t735+2.0*t497*r);
  Real t780 = _lambda*(t76*s+t90*t+t100*u);
  Real t787 = s*t90+t76*t;
  Real t792 = s*t100+t76*u;
  Real t795 = p*(t780+2.0*t109*s)+t112*t787+t128*t792;
  Real t805 = t*t100+t90*u;
  Real t808 = t82*t787+q*(t780+2.0*t91*t)+t128*t805;
  Real t818 = t82*t792+t112*t805+r*(t780+2.0*t101*u);
  Real t825 = _lambda*(t8*s+t13*t+t18*u);
  Real t833 = s*t13+t8*t;
  Real t840 = s*t18+t8*u;
  Real t845 = t267+p*(t825+2.0*t22*s)+t8*t299+t270+t112*t833+t46*t303+t273+t128*t840+t62*t308;
  Real t858 = t*t18+t13*u;
  Real t863 = t278+t82*t833+t22*t303+t279+q*(t825+2.0*t46*t)+t13*t317+t281+t128*t858+t62*t321;
  Real t878 = t285+t82*t840+t22*t308+t287+t112*t858+t46*t321+t288+r*(t825+2.0*t62*u)+t18*t332;
  Real t885 = _lambda*(t448*s+t453*t+t458*u);
  Real t892 = s*t453+t448*t;
  Real t897 = s*t458+t448*u;
  Real t900 = p*(t885+2.0*t462*s)+t112*t892+t128*t897;
  Real t910 = t*t458+t453*u;
  Real t913 = t82*t892+q*(t885+2.0*t481*t)+t128*t910;
  Real t923 = t82*t897+t112*t910+r*(t885+2.0*t497*u);
  Real t931 = t448*t85+t481*t94+t497*t104;
  Real t938 = t462*t94+t453*t115+t497*t119;
  Real t945 = t462*t104+t481*t119+t458*t131;
  Real t953 = t448*t168+t481*t172+t497*t177;
  Real t960 = t462*t172+t453*t186+t497*t190;
  Real t967 = t462*t177+t481*t190+t458*t201;
  Real t975 = t448*t235+2.0*t481*t237+2.0*t497*t240;
  Real t982 = 2.0*t462*t237+t453*t249+2.0*t497*t251;
  Real t989 = 2.0*t462*t240+2.0*t481*t251+t458*t262;
  Real t997 = t448*t299+t481*t303+t497*t308;
  Real t1004 = t462*t303+t453*t317+t497*t321;
  Real t1011 = t462*t308+t481*t321+t458*t332;
  Real t1017 = t41*b10+t56*b11+t67*b12;
  Real t1025 = t143*b10+t151*b11+t158*b12;
  Real t1033 = t211*b10+t218*b11+t225*b12;
  Real t1041 = t274*b10+t282*b11+t289*b12;
  Real t1113 = t41*b20+t56*b21+t67*b22;
  Real t1121 = t143*b20+t151*b21+t158*b22;
  Real t1129 = t211*b20+t218*b21+t225*b22;
  Real t1137 = t274*b20+t282*b21+t289*b22;
  Real t1209 = t41*b30+t56*b31+t67*b32;
  Real t1217 = t143*b30+t151*b31+t158*b32;
  Real t1225 = t211*b30+t218*b31+t225*b32;
  Real t1233 = t274*b30+t282*b31+t289*b32;
  hessian(0,0) = t69;
  hessian(0,1) = t107*b00+t122*b01+t133*b02;
  hessian(0,2) = 0.0;
  hessian(0,3) = t160;
  hessian(0,4) = t180*b00+t193*b01+t203*b02;
  hessian(0,5) = 0.0;
  hessian(0,6) = t227;
  hessian(0,7) = t243*b00+t254*b01+t264*b02;
  hessian(0,8) = 0.0;
  hessian(0,9) = t291;
  hessian(0,10) = t311*b00+t324*b01+t334*b02;
  hessian(0,11) = 0.0;
  hessian(1,0) = t356*b00+t369*b01+t379*b02;
  hessian(1,1) = t406*b00+t424*b01+t439*b02;
  hessian(1,2) = t477*b00+t491*b01+t502*b02;
  hessian(1,3) = t524*b00+t537*b01+t547*b02;
  hessian(1,4) = t574*b00+t592*b01+t607*b02;
  hessian(1,5) = t629*b00+t642*b01+t652*b02;
  hessian(1,6) = t674*b00+t687*b01+t697*b02;
  hessian(1,7) = t708*b00+t718*b01+t728*b02;
  hessian(1,8) = t750*b00+t763*b01+t773*b02;
  hessian(1,9) = t795*b00+t808*b01+t818*b02;
  hessian(1,10) = t845*b00+t863*b01+t878*b02;
  hessian(1,11) = t900*b00+t913*b01+t923*b02;
  hessian(2,0) = 0.0;
  hessian(2,1) = t931*b00+t938*b01+t945*b02;
  hessian(2,2) = t69;
  hessian(2,3) = 0.0;
  hessian(2,4) = t953*b00+t960*b01+t967*b02;
  hessian(2,5) = t160;
  hessian(2,6) = 0.0;
  hessian(2,7) = t975*b00+t982*b01+t989*b02;
  hessian(2,8) = t227;
  hessian(2,9) = 0.0;
  hessian(2,10) = t997*b00+t1004*b01+t1011*b02;
  hessian(2,11) = t291;
  hessian(3,0) = t1017;
  hessian(3,1) = t107*b10+t122*b11+t133*b12;
  hessian(3,2) = 0.0;
  hessian(3,3) = t1025;
  hessian(3,4) = t180*b10+t193*b11+t203*b12;
  hessian(3,5) = 0.0;
  hessian(3,6) = t1033;
  hessian(3,7) = t243*b10+t254*b11+t264*b12;
  hessian(3,8) = 0.0;
  hessian(3,9) = t1041;
  hessian(3,10) = t311*b10+t324*b11+t334*b12;
  hessian(3,11) = 0.0;
  hessian(4,0) = t356*b10+t369*b11+t379*b12;
  hessian(4,1) = t406*b10+t424*b11+t439*b12;
  hessian(4,2) = t477*b10+t491*b11+t502*b12;
  hessian(4,3) = t524*b10+t537*b11+t547*b12;
  hessian(4,4) = t574*b10+t592*b11+t607*b12;
  hessian(4,5) = t629*b10+t642*b11+t652*b12;
  hessian(4,6) = t674*b10+t687*b11+t697*b12;
  hessian(4,7) = t708*b10+t718*b11+t728*b12;
  hessian(4,8) = t750*b10+t763*b11+t773*b12;
  hessian(4,9) = t795*b10+t808*b11+t818*b12;
  hessian(4,10) = t845*b10+t863*b11+t878*b12;
  hessian(4,11) = t900*b10+t913*b11+t923*b12;
  hessian(5,0) = 0.0;
  hessian(5,1) = t931*b10+t938*b11+t945*b12;
  hessian(5,2) = t1017;
  hessian(5,3) = 0.0;
  hessian(5,4) = t953*b10+t960*b11+t967*b12;
  hessian(5,5) = t1025;
  hessian(5,6) = 0.0;
  hessian(5,7) = t975*b10+t982*b11+t989*b12;
  hessian(5,8) = t1033;
  hessian(5,9) = 0.0;
  hessian(5,10) = t997*b10+t1004*b11+t1011*b12;
  hessian(5,11) = t1041;
  hessian(6,0) = t1113;
  hessian(6,1) = t107*b20+t122*b21+t133*b22;
  hessian(6,2) = 0.0;
  hessian(6,3) = t1121;
  hessian(6,4) = t180*b20+t193*b21+t203*b22;
  hessian(6,5) = 0.0;
  hessian(6,6) = t1129;
  hessian(6,7) = t243*b20+t254*b21+t264*b22;
  hessian(6,8) = 0.0;
  hessian(6,9) = t1137;
  hessian(6,10) = t311*b20+t324*b21+t334*b22;
  hessian(6,11) = 0.0;
  hessian(7,0) = t356*b20+t369*b21+t379*b22;
  hessian(7,1) = t406*b20+t424*b21+t439*b22;
  hessian(7,2) = t477*b20+t491*b21+t502*b22;
  hessian(7,3) = t524*b20+t537*b21+t547*b22;
  hessian(7,4) = t574*b20+t592*b21+t607*b22;
  hessian(7,5) = t629*b20+t642*b21+t652*b22;
  hessian(7,6) = t674*b20+t687*b21+t697*b22;
  hessian(7,7) = t708*b20+t718*b21+t728*b22;
  hessian(7,8) = t750*b20+t763*b21+t773*b22;
  hessian(7,9) = t795*b20+t808*b21+t818*b22;
  hessian(7,10) = t845*b20+t863*b21+t878*b22;
  hessian(7,11) = t900*b20+t913*b21+t923*b22;
  hessian(8,0) = 0.0;
  hessian(8,1) = t931*b20+t938*b21+t945*b22;
  hessian(8,2) = t1113;
  hessian(8,3) = 0.0;
  hessian(8,4) = t953*b20+t960*b21+t967*b22;
  hessian(8,5) = t1121;
  hessian(8,6) = 0.0;
  hessian(8,7) = t975*b20+t982*b21+t989*b22;
  hessian(8,8) = t1129;
  hessian(8,9) = 0.0;
  hessian(8,10) = t997*b20+t1004*b21+t1011*b22;
  hessian(8,11) = t1137;
  hessian(9,0) = t1209;
  hessian(9,1) = t107*b30+t122*b31+t133*b32;
  hessian(9,2) = 0.0;
  hessian(9,3) = t1217;
  hessian(9,4) = t180*b30+t193*b31+t203*b32;
  hessian(9,5) = 0.0;
  hessian(9,6) = t1225;
  hessian(9,7) = t243*b30+t254*b31+t264*b32;
  hessian(9,8) = 0.0;
  hessian(9,9) = t1233;
  hessian(9,10) = t311*b30+t324*b31+t334*b32;
  hessian(9,11) = 0.0;
  hessian(10,0) = t356*b30+t369*b31+t379*b32;
  hessian(10,1) = t406*b30+t424*b31+t439*b32;
  hessian(10,2) = t477*b30+t491*b31+t502*b32;
  hessian(10,3) = t524*b30+t537*b31+t547*b32;
  hessian(10,4) = t574*b30+t592*b31+t607*b32;
  hessian(10,5) = t629*b30+t642*b31+t652*b32;
  hessian(10,6) = t674*b30+t687*b31+t697*b32;
  hessian(10,7) = t708*b30+t718*b31+t728*b32;
  hessian(10,8) = t750*b30+t763*b31+t773*b32;
  hessian(10,9) = t795*b30+t808*b31+t818*b32;
  hessian(10,10) = t845*b30+t863*b31+t878*b32;
  hessian(10,11) = t900*b30+t913*b31+t923*b32;
  hessian(11,0) = 0.0;
  hessian(11,1) = t931*b30+t938*b31+t945*b32;
  hessian(11,2) = t1209;
  hessian(11,3) = 0.0;
  hessian(11,4) = t953*b30+t960*b31+t967*b32;
  hessian(11,5) = t1217;
  hessian(11,6) = 0.0;
  hessian(11,7) = t975*b30+t982*b31+t989*b32;
  hessian(11,8) = t1225;
  hessian(11,9) = 0.0;
  hessian(11,10) = t997*b30+t1004*b31+t1011*b32;
  hessian(11,11) = t1233;
   
}

void STVK::hessian8(MATRIX3& DmInv, const VEC3F* bVecs, const VEC3F* vertices, MATRIX& hessian)
{
  Real b00 = bVecs[0][0];
  Real b01 = bVecs[0][1];
  Real b02 = bVecs[0][2];
  Real b10 = bVecs[1][0];
  Real b11 = bVecs[1][1];
  Real b12 = bVecs[1][2];
  Real b20 = bVecs[2][0];
  Real b21 = bVecs[2][1];
  Real b22 = bVecs[2][2];
  Real b30 = bVecs[3][0];
  Real b31 = bVecs[3][1];
  Real b32 = bVecs[3][2];

  Real a = vertices[0][0];
  Real b = vertices[0][1];
  Real c = vertices[0][2];

  Real d = vertices[1][0];
  Real e = vertices[1][1];
  Real f = vertices[1][2];

  Real g = vertices[2][0];
  Real h = vertices[2][1];
  Real i = vertices[2][2];

  Real j = vertices[3][0];
  Real k = vertices[3][1];
  Real l = vertices[3][2];
 
  Real m = DmInv(0,0);
  Real n = DmInv(0,1);
  Real o = DmInv(0,2);
  Real p = DmInv(1,0);
  Real q = DmInv(1,1);
  Real r = DmInv(1,2);
  Real s = DmInv(2,0);
  Real t = DmInv(2,1);
  Real u = DmInv(2,2);

  Real t1 = -m-p-s;
  Real t2 = f-c;
  Real t4 = i-c;
  Real t6 = l-c;
  Real t8 = t2*m+t4*p+t6*s;
  Real t13 = t2*n+t4*q+t6*t;
  Real t18 = t2*o+t4*r+t6*u;
  Real t21 = _lambda*(t8*p+t13*q+t18*r);
  Real t22 = _mu*t8;
  Real t25 = t21+2.0*t22*p;
  Real t26 = t1*t25;
  Real t27 = -n-q-t;
  Real t28 = t27*_mu;
  Real t31 = p*t13+t8*q;
  Real t33 = t28*t31;
  Real t34 = -o-r-u;
  Real t35 = t34*_mu;
  Real t38 = p*t18+t8*r;
  Real t40 = t35*t38;
  Real t41 = t26+t33+t40;
  Real t43 = t1*_mu;
  Real t45 = t43*t31;
  Real t46 = _mu*t13;
  Real t49 = t21+2.0*t46*q;
  Real t50 = t27*t49;
  Real t53 = q*t18+t13*r;
  Real t55 = t35*t53;
  Real t56 = t45+t50+t55;
  Real t59 = t43*t38;
  Real t61 = t28*t53;
  Real t62 = _mu*t18;
  Real t65 = t21+2.0*t62*r;
  Real t66 = t34*t65;
  Real t67 = t59+t61+t66;
  Real t69 = t41*b00+t56*b01+t67*b02;
  Real t70 = d-a;
  Real t72 = g-a;
  Real t74 = j-a;
  Real t76 = t70*m+t72*p+t74*s;
  Real t81 = _lambda*(p*t1+q*t27+r*t34);
  Real t82 = _mu*p;
  Real t85 = t81+2.0*t82*t1;
  Real t90 = t70*n+t72*q+t74*t;
  Real t91 = t90*_mu;
  Real t94 = t1*q+p*t27;
  Real t100 = t70*o+t72*r+t74*u;
  Real t101 = t100*_mu;
  Real t104 = t1*r+p*t34;
  Real t107 = t76*t85+t91*t94+t101*t104;
  Real t109 = t76*_mu;
  Real t112 = _mu*q;
  Real t115 = t81+2.0*t112*t27;
  Real t119 = t27*r+q*t34;
  Real t122 = t109*t94+t90*t115+t101*t119;
  Real t128 = _mu*r;
  Real t131 = t81+2.0*t128*t34;
  Real t133 = t109*t104+t91*t119+t100*t131;
  Real t136 = m*t25;
  Real t137 = n*_mu;
  Real t139 = t137*t31;
  Real t140 = o*_mu;
  Real t142 = t140*t38;
  Real t143 = t136+t139+t142;
  Real t145 = m*_mu;
  Real t147 = t145*t31;
  Real t148 = n*t49;
  Real t150 = t140*t53;
  Real t151 = t147+t148+t150;
  Real t154 = t145*t38;
  Real t156 = t137*t53;
  Real t157 = o*t65;
  Real t158 = t154+t156+t157;
  Real t160 = t143*b00+t151*b01+t158*b02;
  Real t165 = _lambda*(p*m+q*n+r*o);
  Real t168 = t165+2.0*t82*m;
  Real t172 = m*q+p*n;
  Real t177 = m*r+p*o;
  Real t180 = t76*t168+t91*t172+t101*t177;
  Real t186 = t165+2.0*t112*n;
  Real t190 = n*r+q*o;
  Real t193 = t109*t172+t90*t186+t101*t190;
  Real t201 = t165+2.0*t128*o;
  Real t203 = t109*t177+t91*t190+t100*t201;
  Real t206 = p*t25;
  Real t207 = t112*t31/2.0;
  Real t209 = t128*t38/2.0;
  Real t211 = t206+2.0*t207+2.0*t209;
  Real t213 = t82*t31/2.0;
  Real t215 = q*t49;
  Real t216 = t128*t53/2.0;
  Real t218 = 2.0*t213+t215+2.0*t216;
  Real t220 = t82*t38/2.0;
  Real t222 = t112*t53/2.0;
  Real t224 = r*t65;
  Real t225 = 2.0*t220+2.0*t222+t224;
  Real t227 = t211*b00+t218*b01+t225*b02;
  Real t228 = p*p;
  Real t229 = q*q;
  Real t230 = r*r;
  Real t232 = _lambda*(t228+t229+t230);
  Real t235 = t232+2.0*_mu*t228;
  Real t237 = p*q;
  Real t240 = p*r;
  Real t243 = t76*t235+2.0*t91*t237+2.0*t101*t240;
  Real t249 = t232+2.0*_mu*t229;
  Real t251 = q*r;
  Real t254 = 2.0*t109*t237+t90*t249+2.0*t101*t251;
  Real t262 = t232+2.0*_mu*t230;
  Real t264 = 2.0*t109*t240+2.0*t91*t251+t100*t262;
  Real t267 = s*t25;
  Real t268 = t*_mu;
  Real t270 = t268*t31;
  Real t271 = u*_mu;
  Real t273 = t271*t38;
  Real t274 = t267+t270+t273;
  Real t276 = s*_mu;
  Real t278 = t276*t31;
  Real t279 = t*t49;
  Real t281 = t271*t53;
  Real t282 = t278+t279+t281;
  Real t285 = t276*t38;
  Real t287 = t268*t53;
  Real t288 = u*t65;
  Real t289 = t285+t287+t288;
  Real t291 = t274*b00+t282*b01+t289*b02;
  Real t296 = _lambda*(p*s+q*t+r*u);
  Real t299 = t296+2.0*t82*s;
  Real t303 = s*q+p*t;
  Real t308 = s*r+p*u;
  Real t311 = t76*t299+t91*t303+t101*t308;
  Real t317 = t296+2.0*t112*t;
  Real t321 = t*r+q*u;
  Real t324 = t109*t303+t90*t317+t101*t321;
  Real t332 = t296+2.0*t128*u;
  Real t334 = t109*t308+t91*t321+t100*t332;
  Real t337 = e-b;
  Real t339 = h-b;
  Real t341 = k-b;
  Real t343 = t337*m+t339*p+t341*s;
  Real t348 = t337*n+t339*q+t341*t;
  Real t349 = t348*_mu;
  Real t355 = t337*o+t339*r+t341*u;
  Real t356 = t355*_mu;
  Real t359 = t343*t85+t349*t94+t356*t104;
  Real t361 = t343*_mu;
  Real t367 = t361*t94+t348*t115+t356*t119;
  Real t374 = t361*t104+t349*t119+t355*t131;
  Real t382 = t343*t168+t349*t172+t356*t177;
  Real t389 = t361*t172+t348*t186+t356*t190;
  Real t396 = t361*t177+t349*t190+t355*t201;
  Real t404 = t343*t235+2.0*t349*t237+2.0*t356*t240;
  Real t411 = 2.0*t361*t237+t348*t249+2.0*t356*t251;
  Real t418 = 2.0*t361*t240+2.0*t349*t251+t355*t262;
  Real t426 = t343*t299+t349*t303+t356*t308;
  Real t433 = t361*t303+t348*t317+t356*t321;
  Real t440 = t361*t308+t349*t321+t355*t332;
  Real t447 = _lambda*(t76*t1+t90*t27+t100*t34);
  Real t454 = t1*t90+t76*t27;
  Real t459 = t1*t100+t76*t34;
  Real t462 = p*(t447+2.0*t109*t1)+t112*t454+t128*t459;
  Real t472 = t27*t100+t90*t34;
  Real t475 = t82*t454+q*(t447+2.0*t91*t27)+t128*t472;
  Real t485 = t82*t459+t112*t472+r*(t447+2.0*t101*t34);
  Real t492 = _lambda*(t343*t1+t348*t27+t355*t34);
  Real t499 = t1*t348+t343*t27;
  Real t504 = t1*t355+t343*t34;
  Real t507 = p*(t492+2.0*t361*t1)+t112*t499+t128*t504;
  Real t517 = t27*t355+t348*t34;
  Real t520 = t82*t499+q*(t492+2.0*t349*t27)+t128*t517;
  Real t530 = t82*t504+t112*t517+r*(t492+2.0*t356*t34);
  Real t537 = _lambda*(t8*t1+t13*t27+t18*t34);
  Real t545 = t1*t13+t8*t27;
  Real t552 = t1*t18+t8*t34;
  Real t557 = t26+p*(t537+2.0*t22*t1)+t8*t85+t33+t112*t545+t46*t94+t40+t128*t552+t62*t104;
  Real t570 = t27*t18+t13*t34;
  Real t575 = t45+t82*t545+t22*t94+t50+q*(t537+2.0*t46*t27)+t13*t115+t55+t128*t570+t62*t119;
  Real t590 = t59+t82*t552+t22*t104+t61+t112*t570+t46*t119+t66+r*(t537+2.0*t62*t34)+t18*t131;
  Real t597 = _lambda*(t76*m+t90*n+t100*o);
  Real t604 = m*t90+t76*n;
  Real t609 = m*t100+t76*o;
  Real t612 = p*(t597+2.0*t109*m)+t112*t604+t128*t609;
  Real t622 = n*t100+t90*o;
  Real t625 = t82*t604+q*(t597+2.0*t91*n)+t128*t622;
  Real t635 = t82*t609+t112*t622+r*(t597+2.0*t101*o);
  Real t642 = _lambda*(t343*m+t348*n+t355*o);
  Real t649 = m*t348+t343*n;
  Real t654 = m*t355+t343*o;
  Real t657 = p*(t642+2.0*t361*m)+t112*t649+t128*t654;
  Real t667 = n*t355+t348*o;
  Real t670 = t82*t649+q*(t642+2.0*t349*n)+t128*t667;
  Real t680 = t82*t654+t112*t667+r*(t642+2.0*t356*o);
  Real t687 = _lambda*(t8*m+t13*n+t18*o);
  Real t695 = m*t13+t8*n;
  Real t702 = m*t18+t8*o;
  Real t707 = t136+p*(t687+2.0*t22*m)+t8*t168+t139+t112*t695+t46*t172+t142+t128*t702+t62*t177;
  Real t720 = n*t18+t13*o;
  Real t725 = t147+t82*t695+t22*t172+t148+q*(t687+2.0*t46*n)+t13*t186+t150+t128*t720+t62*t190;
  Real t740 = t154+t82*t702+t22*t177+t156+t112*t720+t46*t190+t157+r*(t687+2.0*t62*o)+t18*t201;
  Real t747 = _lambda*(t76*p+t90*q+t100*r);
  Real t754 = p*t90+t76*q;
  Real t759 = p*t100+t76*r;
  Real t762 = p*(t747+2.0*t109*p)+t112*t754+t128*t759;
  Real t772 = q*t100+t90*r;
  Real t775 = t82*t754+q*(t747+2.0*t91*q)+t128*t772;
  Real t785 = t82*t759+t112*t772+r*(t747+2.0*t101*r);
  Real t792 = _lambda*(t343*p+t348*q+t355*r);
  Real t799 = p*t348+t343*q;
  Real t804 = p*t355+t343*r;
  Real t807 = p*(t792+2.0*t361*p)+t112*t799+t128*t804;
  Real t817 = q*t355+t348*r;
  Real t820 = t82*t799+q*(t792+2.0*t349*q)+t128*t817;
  Real t830 = t82*t804+t112*t817+r*(t792+2.0*t356*r);
  Real t841 = 2.0*t206+t8*t235+4.0*t207+2.0*t46*t237+4.0*t209+2.0*t62*t240;
  Real t851 = 4.0*t213+2.0*t22*t237+2.0*t215+t13*t249+4.0*t216+2.0*t62*t251;
  Real t861 = 4.0*t220+2.0*t22*t240+4.0*t222+2.0*t46*t251+2.0*t224+t18*t262;
  Real t868 = _lambda*(t76*s+t90*t+t100*u);
  Real t875 = s*t90+t76*t;
  Real t880 = s*t100+t76*u;
  Real t883 = p*(t868+2.0*t109*s)+t112*t875+t128*t880;
  Real t893 = t*t100+t90*u;
  Real t896 = t82*t875+q*(t868+2.0*t91*t)+t128*t893;
  Real t906 = t82*t880+t112*t893+r*(t868+2.0*t101*u);
  Real t913 = _lambda*(t343*s+t348*t+t355*u);
  Real t920 = s*t348+t343*t;
  Real t925 = s*t355+t343*u;
  Real t928 = p*(t913+2.0*t361*s)+t112*t920+t128*t925;
  Real t938 = t*t355+t348*u;
  Real t941 = t82*t920+q*(t913+2.0*t349*t)+t128*t938;
  Real t951 = t82*t925+t112*t938+r*(t913+2.0*t356*u);
  Real t958 = _lambda*(t8*s+t13*t+t18*u);
  Real t966 = s*t13+t8*t;
  Real t973 = s*t18+t8*u;
  Real t978 = t267+p*(t958+2.0*t22*s)+t8*t299+t270+t112*t966+t46*t303+t273+t128*t973+t62*t308;
  Real t991 = t*t18+t13*u;
  Real t996 = t278+t82*t966+t22*t303+t279+q*(t958+2.0*t46*t)+t13*t317+t281+t128*t991+t62*t321;
  Real t1011 = t285+t82*t973+t22*t308+t287+t112*t991+t46*t321+t288+r*(t958+2.0*t62*u)+t18*t332;
  Real t1017 = t41*b10+t56*b11+t67*b12;
  Real t1025 = t143*b10+t151*b11+t158*b12;
  Real t1033 = t211*b10+t218*b11+t225*b12;
  Real t1041 = t274*b10+t282*b11+t289*b12;
  Real t1113 = t41*b20+t56*b21+t67*b22;
  Real t1121 = t143*b20+t151*b21+t158*b22;
  Real t1129 = t211*b20+t218*b21+t225*b22;
  Real t1137 = t274*b20+t282*b21+t289*b22;
  Real t1209 = t41*b30+t56*b31+t67*b32;
  Real t1217 = t143*b30+t151*b31+t158*b32;
  Real t1225 = t211*b30+t218*b31+t225*b32;
  Real t1233 = t274*b30+t282*b31+t289*b32;
  hessian(0,0) = t69;
  hessian(0,1) = 0.0;
  hessian(0,2) = t107*b00+t122*b01+t133*b02;
  hessian(0,3) = t160;
  hessian(0,4) = 0.0;
  hessian(0,5) = t180*b00+t193*b01+t203*b02;
  hessian(0,6) = t227;
  hessian(0,7) = 0.0;
  hessian(0,8) = t243*b00+t254*b01+t264*b02;
  hessian(0,9) = t291;
  hessian(0,10) = 0.0;
  hessian(0,11) = t311*b00+t324*b01+t334*b02;
  hessian(1,0) = 0.0;
  hessian(1,1) = t69;
  hessian(1,2) = t359*b00+t367*b01+t374*b02;
  hessian(1,3) = 0.0;
  hessian(1,4) = t160;
  hessian(1,5) = t382*b00+t389*b01+t396*b02;
  hessian(1,6) = 0.0;
  hessian(1,7) = t227;
  hessian(1,8) = t404*b00+t411*b01+t418*b02;
  hessian(1,9) = 0.0;
  hessian(1,10) = t291;
  hessian(1,11) = t426*b00+t433*b01+t440*b02;
  hessian(2,0) = t462*b00+t475*b01+t485*b02;
  hessian(2,1) = t507*b00+t520*b01+t530*b02;
  hessian(2,2) = t557*b00+t575*b01+t590*b02;
  hessian(2,3) = t612*b00+t625*b01+t635*b02;
  hessian(2,4) = t657*b00+t670*b01+t680*b02;
  hessian(2,5) = t707*b00+t725*b01+t740*b02;
  hessian(2,6) = t762*b00+t775*b01+t785*b02;
  hessian(2,7) = t807*b00+t820*b01+t830*b02;
  hessian(2,8) = t841*b00+t851*b01+t861*b02;
  hessian(2,9) = t883*b00+t896*b01+t906*b02;
  hessian(2,10) = t928*b00+t941*b01+t951*b02;
  hessian(2,11) = t978*b00+t996*b01+t1011*b02;
  hessian(3,0) = t1017;
  hessian(3,1) = 0.0;
  hessian(3,2) = t107*b10+t122*b11+t133*b12;
  hessian(3,3) = t1025;
  hessian(3,4) = 0.0;
  hessian(3,5) = t180*b10+t193*b11+t203*b12;
  hessian(3,6) = t1033;
  hessian(3,7) = 0.0;
  hessian(3,8) = t243*b10+t254*b11+t264*b12;
  hessian(3,9) = t1041;
  hessian(3,10) = 0.0;
  hessian(3,11) = t311*b10+t324*b11+t334*b12;
  hessian(4,0) = 0.0;
  hessian(4,1) = t1017;
  hessian(4,2) = t359*b10+t367*b11+t374*b12;
  hessian(4,3) = 0.0;
  hessian(4,4) = t1025;
  hessian(4,5) = t382*b10+t389*b11+t396*b12;
  hessian(4,6) = 0.0;
  hessian(4,7) = t1033;
  hessian(4,8) = t404*b10+t411*b11+t418*b12;
  hessian(4,9) = 0.0;
  hessian(4,10) = t1041;
  hessian(4,11) = t426*b10+t433*b11+t440*b12;
  hessian(5,0) = t462*b10+t475*b11+t485*b12;
  hessian(5,1) = t507*b10+t520*b11+t530*b12;
  hessian(5,2) = t557*b10+t575*b11+t590*b12;
  hessian(5,3) = t612*b10+t625*b11+t635*b12;
  hessian(5,4) = t657*b10+t670*b11+t680*b12;
  hessian(5,5) = t707*b10+t725*b11+t740*b12;
  hessian(5,6) = t762*b10+t775*b11+t785*b12;
  hessian(5,7) = t807*b10+t820*b11+t830*b12;
  hessian(5,8) = t841*b10+t851*b11+t861*b12;
  hessian(5,9) = t883*b10+t896*b11+t906*b12;
  hessian(5,10) = t928*b10+t941*b11+t951*b12;
  hessian(5,11) = t978*b10+t996*b11+t1011*b12;
  hessian(6,0) = t1113;
  hessian(6,1) = 0.0;
  hessian(6,2) = t107*b20+t122*b21+t133*b22;
  hessian(6,3) = t1121;
  hessian(6,4) = 0.0;
  hessian(6,5) = t180*b20+t193*b21+t203*b22;
  hessian(6,6) = t1129;
  hessian(6,7) = 0.0;
  hessian(6,8) = t243*b20+t254*b21+t264*b22;
  hessian(6,9) = t1137;
  hessian(6,10) = 0.0;
  hessian(6,11) = t311*b20+t324*b21+t334*b22;
  hessian(7,0) = 0.0;
  hessian(7,1) = t1113;
  hessian(7,2) = t359*b20+t367*b21+t374*b22;
  hessian(7,3) = 0.0;
  hessian(7,4) = t1121;
  hessian(7,5) = t382*b20+t389*b21+t396*b22;
  hessian(7,6) = 0.0;
  hessian(7,7) = t1129;
  hessian(7,8) = t404*b20+t411*b21+t418*b22;
  hessian(7,9) = 0.0;
  hessian(7,10) = t1137;
  hessian(7,11) = t426*b20+t433*b21+t440*b22;
  hessian(8,0) = t462*b20+t475*b21+t485*b22;
  hessian(8,1) = t507*b20+t520*b21+t530*b22;
  hessian(8,2) = t557*b20+t575*b21+t590*b22;
  hessian(8,3) = t612*b20+t625*b21+t635*b22;
  hessian(8,4) = t657*b20+t670*b21+t680*b22;
  hessian(8,5) = t707*b20+t725*b21+t740*b22;
  hessian(8,6) = t762*b20+t775*b21+t785*b22;
  hessian(8,7) = t807*b20+t820*b21+t830*b22;
  hessian(8,8) = t841*b20+t851*b21+t861*b22;
  hessian(8,9) = t883*b20+t896*b21+t906*b22;
  hessian(8,10) = t928*b20+t941*b21+t951*b22;
  hessian(8,11) = t978*b20+t996*b21+t1011*b22;
  hessian(9,0) = t1209;
  hessian(9,1) = 0.0;
  hessian(9,2) = t107*b30+t122*b31+t133*b32;
  hessian(9,3) = t1217;
  hessian(9,4) = 0.0;
  hessian(9,5) = t180*b30+t193*b31+t203*b32;
  hessian(9,6) = t1225;
  hessian(9,7) = 0.0;
  hessian(9,8) = t243*b30+t254*b31+t264*b32;
  hessian(9,9) = t1233;
  hessian(9,10) = 0.0;
  hessian(9,11) = t311*b30+t324*b31+t334*b32;
  hessian(10,0) = 0.0;
  hessian(10,1) = t1209;
  hessian(10,2) = t359*b30+t367*b31+t374*b32;
  hessian(10,3) = 0.0;
  hessian(10,4) = t1217;
  hessian(10,5) = t382*b30+t389*b31+t396*b32;
  hessian(10,6) = 0.0;
  hessian(10,7) = t1225;
  hessian(10,8) = t404*b30+t411*b31+t418*b32;
  hessian(10,9) = 0.0;
  hessian(10,10) = t1233;
  hessian(10,11) = t426*b30+t433*b31+t440*b32;
  hessian(11,0) = t462*b30+t475*b31+t485*b32;
  hessian(11,1) = t507*b30+t520*b31+t530*b32;
  hessian(11,2) = t557*b30+t575*b31+t590*b32;
  hessian(11,3) = t612*b30+t625*b31+t635*b32;
  hessian(11,4) = t657*b30+t670*b31+t680*b32;
  hessian(11,5) = t707*b30+t725*b31+t740*b32;
  hessian(11,6) = t762*b30+t775*b31+t785*b32;
  hessian(11,7) = t807*b30+t820*b31+t830*b32;
  hessian(11,8) = t841*b30+t851*b31+t861*b32;
  hessian(11,9) = t883*b30+t896*b31+t906*b32;
  hessian(11,10) = t928*b30+t941*b31+t951*b32;
  hessian(11,11) = t978*b30+t996*b31+t1011*b32;
   
}

void STVK::hessian9(MATRIX3& DmInv, const VEC3F* bVecs, const VEC3F* vertices, MATRIX& hessian)
{
  Real b00 = bVecs[0][0];
  Real b01 = bVecs[0][1];
  Real b02 = bVecs[0][2];
  Real b10 = bVecs[1][0];
  Real b11 = bVecs[1][1];
  Real b12 = bVecs[1][2];
  Real b20 = bVecs[2][0];
  Real b21 = bVecs[2][1];
  Real b22 = bVecs[2][2];
  Real b30 = bVecs[3][0];
  Real b31 = bVecs[3][1];
  Real b32 = bVecs[3][2];

  Real a = vertices[0][0];
  Real b = vertices[0][1];
  Real c = vertices[0][2];

  Real d = vertices[1][0];
  Real e = vertices[1][1];
  Real f = vertices[1][2];

  Real g = vertices[2][0];
  Real h = vertices[2][1];
  Real i = vertices[2][2];

  Real j = vertices[3][0];
  Real k = vertices[3][1];
  Real l = vertices[3][2];
 
  Real m = DmInv(0,0);
  Real n = DmInv(0,1);
  Real o = DmInv(0,2);
  Real p = DmInv(1,0);
  Real q = DmInv(1,1);
  Real r = DmInv(1,2);
  Real s = DmInv(2,0);
  Real t = DmInv(2,1);
  Real u = DmInv(2,2);

  Real t1 = -m-p-s;
  Real t2 = d-a;
  Real t4 = g-a;
  Real t6 = j-a;
  Real t8 = t2*m+t4*p+t6*s;
  Real t13 = t2*n+t4*q+t6*t;
  Real t18 = t2*o+t4*r+t6*u;
  Real t21 = _lambda*(t8*s+t13*t+t18*u);
  Real t22 = _mu*t8;
  Real t25 = t21+2.0*t22*s;
  Real t26 = t1*t25;
  Real t28 = -n-q-t;
  Real t30 = -o-r-u;
  Real t33 = _lambda*(t8*t1+t13*t28+t18*t30);
  Real t42 = _lambda*(s*t1+t*t28+u*t30);
  Real t43 = _mu*s;
  Real t46 = t42+2.0*t43*t1;
  Real t48 = t28*_mu;
  Real t51 = s*t13+t8*t;
  Real t53 = t48*t51;
  Real t54 = t*_mu;
  Real t57 = t1*t13+t8*t28;
  Real t60 = t13*_mu;
  Real t63 = t1*t+s*t28;
  Real t66 = t30*_mu;
  Real t69 = s*t18+t8*u;
  Real t71 = t66*t69;
  Real t72 = u*_mu;
  Real t75 = t1*t18+t8*t30;
  Real t78 = t18*_mu;
  Real t81 = t1*u+s*t30;
  Real t84 = t26+s*(t33+2.0*t22*t1)+t8*t46+t53+t54*t57+t60*t63+t71+t72*t75+t78*t81;
  Real t86 = t1*_mu;
  Real t88 = t86*t51;
  Real t95 = t21+2.0*t60*t;
  Real t96 = t28*t95;
  Real t103 = t42+2.0*t54*t28;
  Real t107 = t*t18+t13*u;
  Real t109 = t66*t107;
  Real t112 = t28*t18+t13*t30;
  Real t117 = t28*u+t*t30;
  Real t120 = t88+t43*t57+t22*t63+t96+t*(t33+2.0*t60*t28)+t13*t103+t109+t72*t112+t78*t117;
  Real t123 = t86*t69;
  Real t129 = t48*t107;
  Real t136 = t21+2.0*t78*u;
  Real t137 = t30*t136;
  Real t144 = t42+2.0*t72*t30;
  Real t146 = t123+t43*t75+t22*t81+t129+t54*t112+t60*t117+t137+u*(t33+2.0*t78*t30)+t18*t144;
  Real t149 = e-b;
  Real t151 = h-b;
  Real t153 = k-b;
  Real t155 = t149*m+t151*p+t153*s;
  Real t160 = t149*n+t151*q+t153*t;
  Real t165 = t149*o+t151*r+t153*u;
  Real t168 = _lambda*(t155*t1+t160*t28+t165*t30);
  Real t169 = _mu*t155;
  Real t176 = t1*t160+t155*t28;
  Real t181 = t1*t165+t155*t30;
  Real t184 = s*(t168+2.0*t169*t1)+t54*t176+t72*t181;
  Real t188 = _mu*t160;
  Real t195 = t28*t165+t160*t30;
  Real t198 = t43*t176+t*(t168+2.0*t188*t28)+t72*t195;
  Real t204 = _mu*t165;
  Real t209 = t43*t181+t54*t195+u*(t168+2.0*t204*t30);
  Real t212 = f-c;
  Real t214 = i-c;
  Real t216 = l-c;
  Real t218 = t212*m+t214*p+t216*s;
  Real t223 = t212*n+t214*q+t216*t;
  Real t228 = t212*o+t214*r+t216*u;
  Real t231 = _lambda*(t218*t1+t223*t28+t228*t30);
  Real t232 = _mu*t218;
  Real t239 = t1*t223+t218*t28;
  Real t244 = t1*t228+t218*t30;
  Real t247 = s*(t231+2.0*t232*t1)+t54*t239+t72*t244;
  Real t251 = _mu*t223;
  Real t258 = t28*t228+t223*t30;
  Real t261 = t43*t239+t*(t231+2.0*t251*t28)+t72*t258;
  Real t267 = _mu*t228;
  Real t272 = t43*t244+t54*t258+u*(t231+2.0*t267*t30);
  Real t275 = m*t25;
  Real t280 = _lambda*(t8*m+t13*n+t18*o);
  Real t289 = _lambda*(s*m+t*n+u*o);
  Real t292 = t289+2.0*t43*m;
  Real t294 = n*_mu;
  Real t296 = t294*t51;
  Real t299 = m*t13+t8*n;
  Real t304 = m*t+s*n;
  Real t307 = o*_mu;
  Real t309 = t307*t69;
  Real t312 = m*t18+t8*o;
  Real t317 = m*u+s*o;
  Real t320 = t275+s*(t280+2.0*t22*m)+t8*t292+t296+t54*t299+t60*t304+t309+t72*t312+t78*t317;
  Real t322 = m*_mu;
  Real t324 = t322*t51;
  Real t329 = n*t95;
  Real t336 = t289+2.0*t54*n;
  Real t339 = t307*t107;
  Real t342 = n*t18+t13*o;
  Real t347 = n*u+t*o;
  Real t350 = t324+t43*t299+t22*t304+t329+t*(t280+2.0*t60*n)+t13*t336+t339+t72*t342+t78*t347;
  Real t353 = t322*t69;
  Real t359 = t294*t107;
  Real t364 = o*t136;
  Real t371 = t289+2.0*t72*o;
  Real t373 = t353+t43*t312+t22*t317+t359+t54*t342+t60*t347+t364+u*(t280+2.0*t78*o)+t18*t371;
  Real t380 = _lambda*(t155*m+t160*n+t165*o);
  Real t387 = m*t160+t155*n;
  Real t392 = m*t165+t155*o;
  Real t395 = s*(t380+2.0*t169*m)+t54*t387+t72*t392;
  Real t405 = n*t165+t160*o;
  Real t408 = t43*t387+t*(t380+2.0*t188*n)+t72*t405;
  Real t418 = t43*t392+t54*t405+u*(t380+2.0*t204*o);
  Real t425 = _lambda*(t218*m+t223*n+t228*o);
  Real t432 = m*t223+t218*n;
  Real t437 = m*t228+t218*o;
  Real t440 = s*(t425+2.0*t232*m)+t54*t432+t72*t437;
  Real t450 = n*t228+t223*o;
  Real t453 = t43*t432+t*(t425+2.0*t251*n)+t72*t450;
  Real t463 = t43*t437+t54*t450+u*(t425+2.0*t267*o);
  Real t466 = p*t25;
  Real t471 = _lambda*(t8*p+t13*q+t18*r);
  Real t480 = _lambda*(p*s+q*t+r*u);
  Real t481 = _mu*p;
  Real t484 = t480+2.0*t481*s;
  Real t486 = q*_mu;
  Real t488 = t486*t51;
  Real t491 = p*t13+t8*q;
  Real t496 = s*q+p*t;
  Real t499 = r*_mu;
  Real t501 = t499*t69;
  Real t504 = p*t18+t8*r;
  Real t509 = s*r+p*u;
  Real t512 = t466+s*(t471+2.0*t22*p)+t8*t484+t488+t54*t491+t60*t496+t501+t72*t504+t78*t509;
  Real t515 = t481*t51;
  Real t520 = q*t95;
  Real t527 = t480+2.0*t486*t;
  Real t530 = t499*t107;
  Real t533 = q*t18+t13*r;
  Real t538 = t*r+q*u;
  Real t541 = t515+t43*t491+t22*t496+t520+t*(t471+2.0*t60*q)+t13*t527+t530+t72*t533+t78*t538;
  Real t544 = t481*t69;
  Real t550 = t486*t107;
  Real t555 = r*t136;
  Real t562 = t480+2.0*t499*u;
  Real t564 = t544+t43*t504+t22*t509+t550+t54*t533+t60*t538+t555+u*(t471+2.0*t78*r)+t18*t562;
  Real t571 = _lambda*(t155*p+t160*q+t165*r);
  Real t578 = p*t160+t155*q;
  Real t583 = p*t165+t155*r;
  Real t586 = s*(t571+2.0*t169*p)+t54*t578+t72*t583;
  Real t596 = q*t165+t160*r;
  Real t599 = t43*t578+t*(t571+2.0*t188*q)+t72*t596;
  Real t609 = t43*t583+t54*t596+u*(t571+2.0*t204*r);
  Real t616 = _lambda*(t218*p+t223*q+t228*r);
  Real t623 = p*t223+t218*q;
  Real t628 = p*t228+t218*r;
  Real t631 = s*(t616+2.0*t232*p)+t54*t623+t72*t628;
  Real t641 = q*t228+t223*r;
  Real t644 = t43*t623+t*(t616+2.0*t251*q)+t72*t641;
  Real t654 = t43*t628+t54*t641+u*(t616+2.0*t267*r);
  Real t657 = s*t25;
  Real t659 = s*s;
  Real t660 = t*t;
  Real t661 = u*u;
  Real t663 = _lambda*(t659+t660+t661);
  Real t666 = t663+2.0*_mu*t659;
  Real t668 = t54*t51/2.0;
  Real t670 = s*t;
  Real t673 = t72*t69/2.0;
  Real t675 = s*u;
  Real t678 = 2.0*t657+t8*t666+4.0*t668+2.0*t60*t670+4.0*t673+2.0*t78*t675;
  Real t680 = t43*t51/2.0;
  Real t684 = t*t95;
  Real t688 = t663+2.0*_mu*t660;
  Real t690 = t72*t107/2.0;
  Real t692 = t*u;
  Real t695 = 4.0*t680+2.0*t22*t670+2.0*t684+t13*t688+4.0*t690+2.0*t78*t692;
  Real t697 = t43*t69/2.0;
  Real t701 = t54*t107/2.0;
  Real t705 = u*t136;
  Real t709 = t663+2.0*_mu*t661;
  Real t711 = 4.0*t697+2.0*t22*t675+4.0*t701+2.0*t60*t692+2.0*t705+t18*t709;
  Real t718 = _lambda*(t155*s+t160*t+t165*u);
  Real t725 = s*t160+t155*t;
  Real t730 = s*t165+t155*u;
  Real t733 = s*(t718+2.0*t169*s)+t54*t725+t72*t730;
  Real t743 = t*t165+t160*u;
  Real t746 = t43*t725+t*(t718+2.0*t188*t)+t72*t743;
  Real t756 = t43*t730+t54*t743+u*(t718+2.0*t204*u);
  Real t763 = _lambda*(t218*s+t223*t+t228*u);
  Real t770 = s*t223+t218*t;
  Real t775 = s*t228+t218*u;
  Real t778 = s*(t763+2.0*t232*s)+t54*t770+t72*t775;
  Real t788 = t*t228+t223*u;
  Real t791 = t43*t770+t*(t763+2.0*t251*t)+t72*t788;
  Real t801 = t43*t775+t54*t788+u*(t763+2.0*t267*u);
  Real t809 = t155*t46+t188*t63+t204*t81;
  Real t816 = t169*t63+t160*t103+t204*t117;
  Real t823 = t169*t81+t188*t117+t165*t144;
  Real t826 = t26+t53+t71;
  Real t828 = t88+t96+t109;
  Real t830 = t123+t129+t137;
  Real t832 = t826*b00+t828*b01+t830*b02;
  Real t838 = t155*t292+t188*t304+t204*t317;
  Real t845 = t169*t304+t160*t336+t204*t347;
  Real t852 = t169*t317+t188*t347+t165*t371;
  Real t855 = t275+t296+t309;
  Real t857 = t324+t329+t339;
  Real t859 = t353+t359+t364;
  Real t861 = t855*b00+t857*b01+t859*b02;
  Real t867 = t155*t484+t188*t496+t204*t509;
  Real t874 = t169*t496+t160*t527+t204*t538;
  Real t881 = t169*t509+t188*t538+t165*t562;
  Real t884 = t466+t488+t501;
  Real t886 = t515+t520+t530;
  Real t888 = t544+t550+t555;
  Real t890 = t884*b00+t886*b01+t888*b02;
  Real t896 = t155*t666+2.0*t188*t670+2.0*t204*t675;
  Real t903 = 2.0*t169*t670+t160*t688+2.0*t204*t692;
  Real t910 = 2.0*t169*t675+2.0*t188*t692+t165*t709;
  Real t915 = t657+2.0*t668+2.0*t673;
  Real t919 = 2.0*t680+t684+2.0*t690;
  Real t923 = 2.0*t697+2.0*t701+t705;
  Real t925 = t915*b00+t919*b01+t923*b02;
  Real t931 = t218*t46+t251*t63+t267*t81;
  Real t938 = t232*t63+t223*t103+t267*t117;
  Real t945 = t232*t81+t251*t117+t228*t144;
  Real t953 = t218*t292+t251*t304+t267*t317;
  Real t960 = t232*t304+t223*t336+t267*t347;
  Real t967 = t232*t317+t251*t347+t228*t371;
  Real t975 = t218*t484+t251*t496+t267*t509;
  Real t982 = t232*t496+t223*t527+t267*t538;
  Real t989 = t232*t509+t251*t538+t228*t562;
  Real t997 = t218*t666+2.0*t251*t670+2.0*t267*t675;
  Real t1004 = 2.0*t232*t670+t223*t688+2.0*t267*t692;
  Real t1011 = 2.0*t232*t675+2.0*t251*t692+t228*t709;
  Real t1069 = t826*b10+t828*b11+t830*b12;
  Real t1077 = t855*b10+t857*b11+t859*b12;
  Real t1085 = t884*b10+t886*b11+t888*b12;
  Real t1093 = t915*b10+t919*b11+t923*b12;
  Real t1165 = t826*b20+t828*b21+t830*b22;
  Real t1173 = t855*b20+t857*b21+t859*b22;
  Real t1181 = t884*b20+t886*b21+t888*b22;
  Real t1189 = t915*b20+t919*b21+t923*b22;
  Real t1261 = t826*b30+t828*b31+t830*b32;
  Real t1269 = t855*b30+t857*b31+t859*b32;
  Real t1277 = t884*b30+t886*b31+t888*b32;
  Real t1285 = t915*b30+t919*b31+t923*b32;
  hessian(0,0) = t84*b00+t120*b01+t146*b02;
  hessian(0,1) = t184*b00+t198*b01+t209*b02;
  hessian(0,2) = t247*b00+t261*b01+t272*b02;
  hessian(0,3) = t320*b00+t350*b01+t373*b02;
  hessian(0,4) = t395*b00+t408*b01+t418*b02;
  hessian(0,5) = t440*b00+t453*b01+t463*b02;
  hessian(0,6) = t512*b00+t541*b01+t564*b02;
  hessian(0,7) = t586*b00+t599*b01+t609*b02;
  hessian(0,8) = t631*b00+t644*b01+t654*b02;
  hessian(0,9) = t678*b00+t695*b01+t711*b02;
  hessian(0,10) = t733*b00+t746*b01+t756*b02;
  hessian(0,11) = t778*b00+t791*b01+t801*b02;
  hessian(1,0) = t809*b00+t816*b01+t823*b02;
  hessian(1,1) = t832;
  hessian(1,2) = 0.0;
  hessian(1,3) = t838*b00+t845*b01+t852*b02;
  hessian(1,4) = t861;
  hessian(1,5) = 0.0;
  hessian(1,6) = t867*b00+t874*b01+t881*b02;
  hessian(1,7) = t890;
  hessian(1,8) = 0.0;
  hessian(1,9) = t896*b00+t903*b01+t910*b02;
  hessian(1,10) = t925;
  hessian(1,11) = 0.0;
  hessian(2,0) = t931*b00+t938*b01+t945*b02;
  hessian(2,1) = 0.0;
  hessian(2,2) = t832;
  hessian(2,3) = t953*b00+t960*b01+t967*b02;
  hessian(2,4) = 0.0;
  hessian(2,5) = t861;
  hessian(2,6) = t975*b00+t982*b01+t989*b02;
  hessian(2,7) = 0.0;
  hessian(2,8) = t890;
  hessian(2,9) = t997*b00+t1004*b01+t1011*b02;
  hessian(2,10) = 0.0;
  hessian(2,11) = t925;
  hessian(3,0) = t84*b10+t120*b11+t146*b12;
  hessian(3,1) = t184*b10+t198*b11+t209*b12;
  hessian(3,2) = t247*b10+t261*b11+t272*b12;
  hessian(3,3) = t320*b10+t350*b11+t373*b12;
  hessian(3,4) = t395*b10+t408*b11+t418*b12;
  hessian(3,5) = t440*b10+t453*b11+t463*b12;
  hessian(3,6) = t512*b10+t541*b11+t564*b12;
  hessian(3,7) = t586*b10+t599*b11+t609*b12;
  hessian(3,8) = t631*b10+t644*b11+t654*b12;
  hessian(3,9) = t678*b10+t695*b11+t711*b12;
  hessian(3,10) = t733*b10+t746*b11+t756*b12;
  hessian(3,11) = t778*b10+t791*b11+t801*b12;
  hessian(4,0) = t809*b10+t816*b11+t823*b12;
  hessian(4,1) = t1069;
  hessian(4,2) = 0.0;
  hessian(4,3) = t838*b10+t845*b11+t852*b12;
  hessian(4,4) = t1077;
  hessian(4,5) = 0.0;
  hessian(4,6) = t867*b10+t874*b11+t881*b12;
  hessian(4,7) = t1085;
  hessian(4,8) = 0.0;
  hessian(4,9) = t896*b10+t903*b11+t910*b12;
  hessian(4,10) = t1093;
  hessian(4,11) = 0.0;
  hessian(5,0) = t931*b10+t938*b11+t945*b12;
  hessian(5,1) = 0.0;
  hessian(5,2) = t1069;
  hessian(5,3) = t953*b10+t960*b11+t967*b12;
  hessian(5,4) = 0.0;
  hessian(5,5) = t1077;
  hessian(5,6) = t975*b10+t982*b11+t989*b12;
  hessian(5,7) = 0.0;
  hessian(5,8) = t1085;
  hessian(5,9) = t997*b10+t1004*b11+t1011*b12;
  hessian(5,10) = 0.0;
  hessian(5,11) = t1093;
  hessian(6,0) = t84*b20+t120*b21+t146*b22;
  hessian(6,1) = t184*b20+t198*b21+t209*b22;
  hessian(6,2) = t247*b20+t261*b21+t272*b22;
  hessian(6,3) = t320*b20+t350*b21+t373*b22;
  hessian(6,4) = t395*b20+t408*b21+t418*b22;
  hessian(6,5) = t440*b20+t453*b21+t463*b22;
  hessian(6,6) = t512*b20+t541*b21+t564*b22;
  hessian(6,7) = t586*b20+t599*b21+t609*b22;
  hessian(6,8) = t631*b20+t644*b21+t654*b22;
  hessian(6,9) = t678*b20+t695*b21+t711*b22;
  hessian(6,10) = t733*b20+t746*b21+t756*b22;
  hessian(6,11) = t778*b20+t791*b21+t801*b22;
  hessian(7,0) = t809*b20+t816*b21+t823*b22;
  hessian(7,1) = t1165;
  hessian(7,2) = 0.0;
  hessian(7,3) = t838*b20+t845*b21+t852*b22;
  hessian(7,4) = t1173;
  hessian(7,5) = 0.0;
  hessian(7,6) = t867*b20+t874*b21+t881*b22;
  hessian(7,7) = t1181;
  hessian(7,8) = 0.0;
  hessian(7,9) = t896*b20+t903*b21+t910*b22;
  hessian(7,10) = t1189;
  hessian(7,11) = 0.0;
  hessian(8,0) = t931*b20+t938*b21+t945*b22;
  hessian(8,1) = 0.0;
  hessian(8,2) = t1165;
  hessian(8,3) = t953*b20+t960*b21+t967*b22;
  hessian(8,4) = 0.0;
  hessian(8,5) = t1173;
  hessian(8,6) = t975*b20+t982*b21+t989*b22;
  hessian(8,7) = 0.0;
  hessian(8,8) = t1181;
  hessian(8,9) = t997*b20+t1004*b21+t1011*b22;
  hessian(8,10) = 0.0;
  hessian(8,11) = t1189;
  hessian(9,0) = t84*b30+t120*b31+t146*b32;
  hessian(9,1) = t184*b30+t198*b31+t209*b32;
  hessian(9,2) = t247*b30+t261*b31+t272*b32;
  hessian(9,3) = t320*b30+t350*b31+t373*b32;
  hessian(9,4) = t395*b30+t408*b31+t418*b32;
  hessian(9,5) = t440*b30+t453*b31+t463*b32;
  hessian(9,6) = t512*b30+t541*b31+t564*b32;
  hessian(9,7) = t586*b30+t599*b31+t609*b32;
  hessian(9,8) = t631*b30+t644*b31+t654*b32;
  hessian(9,9) = t678*b30+t695*b31+t711*b32;
  hessian(9,10) = t733*b30+t746*b31+t756*b32;
  hessian(9,11) = t778*b30+t791*b31+t801*b32;
  hessian(10,0) = t809*b30+t816*b31+t823*b32;
  hessian(10,1) = t1261;
  hessian(10,2) = 0.0;
  hessian(10,3) = t838*b30+t845*b31+t852*b32;
  hessian(10,4) = t1269;
  hessian(10,5) = 0.0;
  hessian(10,6) = t867*b30+t874*b31+t881*b32;
  hessian(10,7) = t1277;
  hessian(10,8) = 0.0;
  hessian(10,9) = t896*b30+t903*b31+t910*b32;
  hessian(10,10) = t1285;
  hessian(10,11) = 0.0;
  hessian(11,0) = t931*b30+t938*b31+t945*b32;
  hessian(11,1) = 0.0;
  hessian(11,2) = t1261;
  hessian(11,3) = t953*b30+t960*b31+t967*b32;
  hessian(11,4) = 0.0;
  hessian(11,5) = t1269;
  hessian(11,6) = t975*b30+t982*b31+t989*b32;
  hessian(11,7) = 0.0;
  hessian(11,8) = t1277;
  hessian(11,9) = t997*b30+t1004*b31+t1011*b32;
  hessian(11,10) = 0.0;
  hessian(11,11) = t1285;
   
}

void STVK::hessian10(MATRIX3& DmInv, const VEC3F* bVecs, const VEC3F* vertices, MATRIX& hessian)
{
  Real b00 = bVecs[0][0];
  Real b01 = bVecs[0][1];
  Real b02 = bVecs[0][2];
  Real b10 = bVecs[1][0];
  Real b11 = bVecs[1][1];
  Real b12 = bVecs[1][2];
  Real b20 = bVecs[2][0];
  Real b21 = bVecs[2][1];
  Real b22 = bVecs[2][2];
  Real b30 = bVecs[3][0];
  Real b31 = bVecs[3][1];
  Real b32 = bVecs[3][2];

  Real a = vertices[0][0];
  Real b = vertices[0][1];
  Real c = vertices[0][2];

  Real d = vertices[1][0];
  Real e = vertices[1][1];
  Real f = vertices[1][2];

  Real g = vertices[2][0];
  Real h = vertices[2][1];
  Real i = vertices[2][2];

  Real j = vertices[3][0];
  Real k = vertices[3][1];
  Real l = vertices[3][2];
 
  Real m = DmInv(0,0);
  Real n = DmInv(0,1);
  Real o = DmInv(0,2);
  Real p = DmInv(1,0);
  Real q = DmInv(1,1);
  Real r = DmInv(1,2);
  Real s = DmInv(2,0);
  Real t = DmInv(2,1);
  Real u = DmInv(2,2);

  Real t1 = -m-p-s;
  Real t2 = e-b;
  Real t4 = h-b;
  Real t6 = k-b;
  Real t8 = t2*m+t4*p+t6*s;
  Real t13 = t2*n+t4*q+t6*t;
  Real t18 = t2*o+t4*r+t6*u;
  Real t21 = _lambda*(t8*s+t13*t+t18*u);
  Real t22 = _mu*t8;
  Real t25 = t21+2.0*t22*s;
  Real t26 = t1*t25;
  Real t27 = -n-q-t;
  Real t28 = t27*_mu;
  Real t31 = s*t13+t8*t;
  Real t33 = t28*t31;
  Real t34 = -o-r-u;
  Real t35 = t34*_mu;
  Real t38 = s*t18+t8*u;
  Real t40 = t35*t38;
  Real t41 = t26+t33+t40;
  Real t43 = t1*_mu;
  Real t45 = t43*t31;
  Real t46 = _mu*t13;
  Real t49 = t21+2.0*t46*t;
  Real t50 = t27*t49;
  Real t53 = t*t18+t13*u;
  Real t55 = t35*t53;
  Real t56 = t45+t50+t55;
  Real t59 = t43*t38;
  Real t61 = t28*t53;
  Real t62 = _mu*t18;
  Real t65 = t21+2.0*t62*u;
  Real t66 = t34*t65;
  Real t67 = t59+t61+t66;
  Real t69 = t41*b00+t56*b01+t67*b02;
  Real t70 = d-a;
  Real t72 = g-a;
  Real t74 = j-a;
  Real t76 = t70*m+t72*p+t74*s;
  Real t81 = _lambda*(s*t1+t*t27+u*t34);
  Real t82 = _mu*s;
  Real t85 = t81+2.0*t82*t1;
  Real t90 = t70*n+t72*q+t74*t;
  Real t91 = t90*_mu;
  Real t94 = t1*t+s*t27;
  Real t100 = t70*o+t72*r+t74*u;
  Real t101 = t100*_mu;
  Real t104 = t1*u+s*t34;
  Real t107 = t76*t85+t91*t94+t101*t104;
  Real t109 = t76*_mu;
  Real t112 = _mu*t;
  Real t115 = t81+2.0*t112*t27;
  Real t119 = t27*u+t*t34;
  Real t122 = t109*t94+t90*t115+t101*t119;
  Real t128 = _mu*u;
  Real t131 = t81+2.0*t128*t34;
  Real t133 = t109*t104+t91*t119+t100*t131;
  Real t136 = m*t25;
  Real t137 = n*_mu;
  Real t139 = t137*t31;
  Real t140 = o*_mu;
  Real t142 = t140*t38;
  Real t143 = t136+t139+t142;
  Real t145 = m*_mu;
  Real t147 = t145*t31;
  Real t148 = n*t49;
  Real t150 = t140*t53;
  Real t151 = t147+t148+t150;
  Real t154 = t145*t38;
  Real t156 = t137*t53;
  Real t157 = o*t65;
  Real t158 = t154+t156+t157;
  Real t160 = t143*b00+t151*b01+t158*b02;
  Real t165 = _lambda*(s*m+t*n+u*o);
  Real t168 = t165+2.0*t82*m;
  Real t172 = m*t+s*n;
  Real t177 = m*u+s*o;
  Real t180 = t76*t168+t91*t172+t101*t177;
  Real t186 = t165+2.0*t112*n;
  Real t190 = n*u+t*o;
  Real t193 = t109*t172+t90*t186+t101*t190;
  Real t201 = t165+2.0*t128*o;
  Real t203 = t109*t177+t91*t190+t100*t201;
  Real t206 = p*t25;
  Real t207 = q*_mu;
  Real t209 = t207*t31;
  Real t210 = r*_mu;
  Real t212 = t210*t38;
  Real t213 = t206+t209+t212;
  Real t215 = p*_mu;
  Real t217 = t215*t31;
  Real t218 = q*t49;
  Real t220 = t210*t53;
  Real t221 = t217+t218+t220;
  Real t224 = t215*t38;
  Real t226 = t207*t53;
  Real t227 = r*t65;
  Real t228 = t224+t226+t227;
  Real t230 = t213*b00+t221*b01+t228*b02;
  Real t235 = _lambda*(p*s+q*t+r*u);
  Real t238 = t235+2.0*t215*s;
  Real t242 = s*q+p*t;
  Real t247 = s*r+p*u;
  Real t250 = t76*t238+t91*t242+t101*t247;
  Real t256 = t235+2.0*t207*t;
  Real t260 = t*r+q*u;
  Real t263 = t109*t242+t90*t256+t101*t260;
  Real t271 = t235+2.0*t210*u;
  Real t273 = t109*t247+t91*t260+t100*t271;
  Real t276 = s*t25;
  Real t277 = t112*t31/2.0;
  Real t279 = t128*t38/2.0;
  Real t281 = t276+2.0*t277+2.0*t279;
  Real t283 = t82*t31/2.0;
  Real t285 = t*t49;
  Real t286 = t128*t53/2.0;
  Real t288 = 2.0*t283+t285+2.0*t286;
  Real t290 = t82*t38/2.0;
  Real t292 = t112*t53/2.0;
  Real t294 = u*t65;
  Real t295 = 2.0*t290+2.0*t292+t294;
  Real t297 = t281*b00+t288*b01+t295*b02;
  Real t298 = s*s;
  Real t299 = t*t;
  Real t300 = u*u;
  Real t302 = _lambda*(t298+t299+t300);
  Real t305 = t302+2.0*_mu*t298;
  Real t307 = s*t;
  Real t310 = s*u;
  Real t313 = t76*t305+2.0*t91*t307+2.0*t101*t310;
  Real t319 = t302+2.0*_mu*t299;
  Real t321 = t*u;
  Real t324 = 2.0*t109*t307+t90*t319+2.0*t101*t321;
  Real t332 = t302+2.0*_mu*t300;
  Real t334 = 2.0*t109*t310+2.0*t91*t321+t100*t332;
  Real t341 = _lambda*(t76*t1+t90*t27+t100*t34);
  Real t348 = t1*t90+t76*t27;
  Real t353 = t1*t100+t76*t34;
  Real t356 = s*(t341+2.0*t109*t1)+t112*t348+t128*t353;
  Real t366 = t27*t100+t90*t34;
  Real t369 = t82*t348+t*(t341+2.0*t91*t27)+t128*t366;
  Real t379 = t82*t353+t112*t366+u*(t341+2.0*t101*t34);
  Real t386 = _lambda*(t8*t1+t13*t27+t18*t34);
  Real t394 = t1*t13+t8*t27;
  Real t401 = t1*t18+t8*t34;
  Real t406 = t26+s*(t386+2.0*t22*t1)+t8*t85+t33+t112*t394+t46*t94+t40+t128*t401+t62*t104;
  Real t419 = t27*t18+t13*t34;
  Real t424 = t45+t82*t394+t22*t94+t50+t*(t386+2.0*t46*t27)+t13*t115+t55+t128*t419+t62*t119;
  Real t439 = t59+t82*t401+t22*t104+t61+t112*t419+t46*t119+t66+u*(t386+2.0*t62*t34)+t18*t131;
  Real t442 = f-c;
  Real t444 = i-c;
  Real t446 = l-c;
  Real t448 = t442*m+t444*p+t446*s;
  Real t453 = t442*n+t444*q+t446*t;
  Real t458 = t442*o+t444*r+t446*u;
  Real t461 = _lambda*(t448*t1+t453*t27+t458*t34);
  Real t462 = _mu*t448;
  Real t469 = t1*t453+t448*t27;
  Real t474 = t1*t458+t448*t34;
  Real t477 = s*(t461+2.0*t462*t1)+t112*t469+t128*t474;
  Real t481 = _mu*t453;
  Real t488 = t27*t458+t453*t34;
  Real t491 = t82*t469+t*(t461+2.0*t481*t27)+t128*t488;
  Real t497 = _mu*t458;
  Real t502 = t82*t474+t112*t488+u*(t461+2.0*t497*t34);
  Real t509 = _lambda*(t76*m+t90*n+t100*o);
  Real t516 = m*t90+t76*n;
  Real t521 = m*t100+t76*o;
  Real t524 = s*(t509+2.0*t109*m)+t112*t516+t128*t521;
  Real t534 = n*t100+t90*o;
  Real t537 = t82*t516+t*(t509+2.0*t91*n)+t128*t534;
  Real t547 = t82*t521+t112*t534+u*(t509+2.0*t101*o);
  Real t554 = _lambda*(t8*m+t13*n+t18*o);
  Real t562 = m*t13+t8*n;
  Real t569 = m*t18+t8*o;
  Real t574 = t136+s*(t554+2.0*t22*m)+t8*t168+t139+t112*t562+t46*t172+t142+t128*t569+t62*t177;
  Real t587 = n*t18+t13*o;
  Real t592 = t147+t82*t562+t22*t172+t148+t*(t554+2.0*t46*n)+t13*t186+t150+t128*t587+t62*t190;
  Real t607 = t154+t82*t569+t22*t177+t156+t112*t587+t46*t190+t157+u*(t554+2.0*t62*o)+t18*t201;
  Real t614 = _lambda*(t448*m+t453*n+t458*o);
  Real t621 = m*t453+t448*n;
  Real t626 = m*t458+t448*o;
  Real t629 = s*(t614+2.0*t462*m)+t112*t621+t128*t626;
  Real t639 = n*t458+t453*o;
  Real t642 = t82*t621+t*(t614+2.0*t481*n)+t128*t639;
  Real t652 = t82*t626+t112*t639+u*(t614+2.0*t497*o);
  Real t659 = _lambda*(t76*p+t90*q+t100*r);
  Real t666 = p*t90+t76*q;
  Real t671 = p*t100+t76*r;
  Real t674 = s*(t659+2.0*t109*p)+t112*t666+t128*t671;
  Real t684 = q*t100+t90*r;
  Real t687 = t82*t666+t*(t659+2.0*t91*q)+t128*t684;
  Real t697 = t82*t671+t112*t684+u*(t659+2.0*t101*r);
  Real t704 = _lambda*(t8*p+t13*q+t18*r);
  Real t712 = p*t13+t8*q;
  Real t719 = p*t18+t8*r;
  Real t724 = t206+s*(t704+2.0*t22*p)+t8*t238+t209+t112*t712+t46*t242+t212+t128*t719+t62*t247;
  Real t737 = q*t18+t13*r;
  Real t742 = t217+t82*t712+t22*t242+t218+t*(t704+2.0*t46*q)+t13*t256+t220+t128*t737+t62*t260;
  Real t757 = t224+t82*t719+t22*t247+t226+t112*t737+t46*t260+t227+u*(t704+2.0*t62*r)+t18*t271;
  Real t764 = _lambda*(t448*p+t453*q+t458*r);
  Real t771 = p*t453+t448*q;
  Real t776 = p*t458+t448*r;
  Real t779 = s*(t764+2.0*t462*p)+t112*t771+t128*t776;
  Real t789 = q*t458+t453*r;
  Real t792 = t82*t771+t*(t764+2.0*t481*q)+t128*t789;
  Real t802 = t82*t776+t112*t789+u*(t764+2.0*t497*r);
  Real t809 = _lambda*(t76*s+t90*t+t100*u);
  Real t816 = s*t90+t76*t;
  Real t821 = s*t100+t76*u;
  Real t824 = s*(t809+2.0*t109*s)+t112*t816+t128*t821;
  Real t834 = t*t100+t90*u;
  Real t837 = t82*t816+t*(t809+2.0*t91*t)+t128*t834;
  Real t847 = t82*t821+t112*t834+u*(t809+2.0*t101*u);
  Real t858 = 2.0*t276+t8*t305+4.0*t277+2.0*t46*t307+4.0*t279+2.0*t62*t310;
  Real t868 = 4.0*t283+2.0*t22*t307+2.0*t285+t13*t319+4.0*t286+2.0*t62*t321;
  Real t878 = 4.0*t290+2.0*t22*t310+4.0*t292+2.0*t46*t321+2.0*t294+t18*t332;
  Real t885 = _lambda*(t448*s+t453*t+t458*u);
  Real t892 = s*t453+t448*t;
  Real t897 = s*t458+t448*u;
  Real t900 = s*(t885+2.0*t462*s)+t112*t892+t128*t897;
  Real t910 = t*t458+t453*u;
  Real t913 = t82*t892+t*(t885+2.0*t481*t)+t128*t910;
  Real t923 = t82*t897+t112*t910+u*(t885+2.0*t497*u);
  Real t931 = t448*t85+t481*t94+t497*t104;
  Real t938 = t462*t94+t453*t115+t497*t119;
  Real t945 = t462*t104+t481*t119+t458*t131;
  Real t953 = t448*t168+t481*t172+t497*t177;
  Real t960 = t462*t172+t453*t186+t497*t190;
  Real t967 = t462*t177+t481*t190+t458*t201;
  Real t975 = t448*t238+t481*t242+t497*t247;
  Real t982 = t462*t242+t453*t256+t497*t260;
  Real t989 = t462*t247+t481*t260+t458*t271;
  Real t997 = t448*t305+2.0*t481*t307+2.0*t497*t310;
  Real t1004 = 2.0*t462*t307+t453*t319+2.0*t497*t321;
  Real t1011 = 2.0*t462*t310+2.0*t481*t321+t458*t332;
  Real t1017 = t41*b10+t56*b11+t67*b12;
  Real t1025 = t143*b10+t151*b11+t158*b12;
  Real t1033 = t213*b10+t221*b11+t228*b12;
  Real t1041 = t281*b10+t288*b11+t295*b12;
  Real t1113 = t41*b20+t56*b21+t67*b22;
  Real t1121 = t143*b20+t151*b21+t158*b22;
  Real t1129 = t213*b20+t221*b21+t228*b22;
  Real t1137 = t281*b20+t288*b21+t295*b22;
  Real t1209 = t41*b30+t56*b31+t67*b32;
  Real t1217 = t143*b30+t151*b31+t158*b32;
  Real t1225 = t213*b30+t221*b31+t228*b32;
  Real t1233 = t281*b30+t288*b31+t295*b32;
  hessian(0,0) = t69;
  hessian(0,1) = t107*b00+t122*b01+t133*b02;
  hessian(0,2) = 0.0;
  hessian(0,3) = t160;
  hessian(0,4) = t180*b00+t193*b01+t203*b02;
  hessian(0,5) = 0.0;
  hessian(0,6) = t230;
  hessian(0,7) = t250*b00+t263*b01+t273*b02;
  hessian(0,8) = 0.0;
  hessian(0,9) = t297;
  hessian(0,10) = t313*b00+t324*b01+t334*b02;
  hessian(0,11) = 0.0;
  hessian(1,0) = t356*b00+t369*b01+t379*b02;
  hessian(1,1) = t406*b00+t424*b01+t439*b02;
  hessian(1,2) = t477*b00+t491*b01+t502*b02;
  hessian(1,3) = t524*b00+t537*b01+t547*b02;
  hessian(1,4) = t574*b00+t592*b01+t607*b02;
  hessian(1,5) = t629*b00+t642*b01+t652*b02;
  hessian(1,6) = t674*b00+t687*b01+t697*b02;
  hessian(1,7) = t724*b00+t742*b01+t757*b02;
  hessian(1,8) = t779*b00+t792*b01+t802*b02;
  hessian(1,9) = t824*b00+t837*b01+t847*b02;
  hessian(1,10) = t858*b00+t868*b01+t878*b02;
  hessian(1,11) = t900*b00+t913*b01+t923*b02;
  hessian(2,0) = 0.0;
  hessian(2,1) = t931*b00+t938*b01+t945*b02;
  hessian(2,2) = t69;
  hessian(2,3) = 0.0;
  hessian(2,4) = t953*b00+t960*b01+t967*b02;
  hessian(2,5) = t160;
  hessian(2,6) = 0.0;
  hessian(2,7) = t975*b00+t982*b01+t989*b02;
  hessian(2,8) = t230;
  hessian(2,9) = 0.0;
  hessian(2,10) = t997*b00+t1004*b01+t1011*b02;
  hessian(2,11) = t297;
  hessian(3,0) = t1017;
  hessian(3,1) = t107*b10+t122*b11+t133*b12;
  hessian(3,2) = 0.0;
  hessian(3,3) = t1025;
  hessian(3,4) = t180*b10+t193*b11+t203*b12;
  hessian(3,5) = 0.0;
  hessian(3,6) = t1033;
  hessian(3,7) = t250*b10+t263*b11+t273*b12;
  hessian(3,8) = 0.0;
  hessian(3,9) = t1041;
  hessian(3,10) = t313*b10+t324*b11+t334*b12;
  hessian(3,11) = 0.0;
  hessian(4,0) = t356*b10+t369*b11+t379*b12;
  hessian(4,1) = t406*b10+t424*b11+t439*b12;
  hessian(4,2) = t477*b10+t491*b11+t502*b12;
  hessian(4,3) = t524*b10+t537*b11+t547*b12;
  hessian(4,4) = t574*b10+t592*b11+t607*b12;
  hessian(4,5) = t629*b10+t642*b11+t652*b12;
  hessian(4,6) = t674*b10+t687*b11+t697*b12;
  hessian(4,7) = t724*b10+t742*b11+t757*b12;
  hessian(4,8) = t779*b10+t792*b11+t802*b12;
  hessian(4,9) = t824*b10+t837*b11+t847*b12;
  hessian(4,10) = t858*b10+t868*b11+t878*b12;
  hessian(4,11) = t900*b10+t913*b11+t923*b12;
  hessian(5,0) = 0.0;
  hessian(5,1) = t931*b10+t938*b11+t945*b12;
  hessian(5,2) = t1017;
  hessian(5,3) = 0.0;
  hessian(5,4) = t953*b10+t960*b11+t967*b12;
  hessian(5,5) = t1025;
  hessian(5,6) = 0.0;
  hessian(5,7) = t975*b10+t982*b11+t989*b12;
  hessian(5,8) = t1033;
  hessian(5,9) = 0.0;
  hessian(5,10) = t997*b10+t1004*b11+t1011*b12;
  hessian(5,11) = t1041;
  hessian(6,0) = t1113;
  hessian(6,1) = t107*b20+t122*b21+t133*b22;
  hessian(6,2) = 0.0;
  hessian(6,3) = t1121;
  hessian(6,4) = t180*b20+t193*b21+t203*b22;
  hessian(6,5) = 0.0;
  hessian(6,6) = t1129;
  hessian(6,7) = t250*b20+t263*b21+t273*b22;
  hessian(6,8) = 0.0;
  hessian(6,9) = t1137;
  hessian(6,10) = t313*b20+t324*b21+t334*b22;
  hessian(6,11) = 0.0;
  hessian(7,0) = t356*b20+t369*b21+t379*b22;
  hessian(7,1) = t406*b20+t424*b21+t439*b22;
  hessian(7,2) = t477*b20+t491*b21+t502*b22;
  hessian(7,3) = t524*b20+t537*b21+t547*b22;
  hessian(7,4) = t574*b20+t592*b21+t607*b22;
  hessian(7,5) = t629*b20+t642*b21+t652*b22;
  hessian(7,6) = t674*b20+t687*b21+t697*b22;
  hessian(7,7) = t724*b20+t742*b21+t757*b22;
  hessian(7,8) = t779*b20+t792*b21+t802*b22;
  hessian(7,9) = t824*b20+t837*b21+t847*b22;
  hessian(7,10) = t858*b20+t868*b21+t878*b22;
  hessian(7,11) = t900*b20+t913*b21+t923*b22;
  hessian(8,0) = 0.0;
  hessian(8,1) = t931*b20+t938*b21+t945*b22;
  hessian(8,2) = t1113;
  hessian(8,3) = 0.0;
  hessian(8,4) = t953*b20+t960*b21+t967*b22;
  hessian(8,5) = t1121;
  hessian(8,6) = 0.0;
  hessian(8,7) = t975*b20+t982*b21+t989*b22;
  hessian(8,8) = t1129;
  hessian(8,9) = 0.0;
  hessian(8,10) = t997*b20+t1004*b21+t1011*b22;
  hessian(8,11) = t1137;
  hessian(9,0) = t1209;
  hessian(9,1) = t107*b30+t122*b31+t133*b32;
  hessian(9,2) = 0.0;
  hessian(9,3) = t1217;
  hessian(9,4) = t180*b30+t193*b31+t203*b32;
  hessian(9,5) = 0.0;
  hessian(9,6) = t1225;
  hessian(9,7) = t250*b30+t263*b31+t273*b32;
  hessian(9,8) = 0.0;
  hessian(9,9) = t1233;
  hessian(9,10) = t313*b30+t324*b31+t334*b32;
  hessian(9,11) = 0.0;
  hessian(10,0) = t356*b30+t369*b31+t379*b32;
  hessian(10,1) = t406*b30+t424*b31+t439*b32;
  hessian(10,2) = t477*b30+t491*b31+t502*b32;
  hessian(10,3) = t524*b30+t537*b31+t547*b32;
  hessian(10,4) = t574*b30+t592*b31+t607*b32;
  hessian(10,5) = t629*b30+t642*b31+t652*b32;
  hessian(10,6) = t674*b30+t687*b31+t697*b32;
  hessian(10,7) = t724*b30+t742*b31+t757*b32;
  hessian(10,8) = t779*b30+t792*b31+t802*b32;
  hessian(10,9) = t824*b30+t837*b31+t847*b32;
  hessian(10,10) = t858*b30+t868*b31+t878*b32;
  hessian(10,11) = t900*b30+t913*b31+t923*b32;
  hessian(11,0) = 0.0;
  hessian(11,1) = t931*b30+t938*b31+t945*b32;
  hessian(11,2) = t1209;
  hessian(11,3) = 0.0;
  hessian(11,4) = t953*b30+t960*b31+t967*b32;
  hessian(11,5) = t1217;
  hessian(11,6) = 0.0;
  hessian(11,7) = t975*b30+t982*b31+t989*b32;
  hessian(11,8) = t1225;
  hessian(11,9) = 0.0;
  hessian(11,10) = t997*b30+t1004*b31+t1011*b32;
  hessian(11,11) = t1233;
   
}

void STVK::hessian11(MATRIX3& DmInv, const VEC3F* bVecs, const VEC3F* vertices, MATRIX& hessian)
{
  Real b00 = bVecs[0][0];
  Real b01 = bVecs[0][1];
  Real b02 = bVecs[0][2];
  Real b10 = bVecs[1][0];
  Real b11 = bVecs[1][1];
  Real b12 = bVecs[1][2];
  Real b20 = bVecs[2][0];
  Real b21 = bVecs[2][1];
  Real b22 = bVecs[2][2];
  Real b30 = bVecs[3][0];
  Real b31 = bVecs[3][1];
  Real b32 = bVecs[3][2];

  Real a = vertices[0][0];
  Real b = vertices[0][1];
  Real c = vertices[0][2];

  Real d = vertices[1][0];
  Real e = vertices[1][1];
  Real f = vertices[1][2];

  Real g = vertices[2][0];
  Real h = vertices[2][1];
  Real i = vertices[2][2];

  Real j = vertices[3][0];
  Real k = vertices[3][1];
  Real l = vertices[3][2];
 
  Real m = DmInv(0,0);
  Real n = DmInv(0,1);
  Real o = DmInv(0,2);
  Real p = DmInv(1,0);
  Real q = DmInv(1,1);
  Real r = DmInv(1,2);
  Real s = DmInv(2,0);
  Real t = DmInv(2,1);
  Real u = DmInv(2,2);

  Real t1 = -m-p-s;
  Real t2 = f-c;
  Real t4 = i-c;
  Real t6 = l-c;
  Real t8 = t2*m+t4*p+t6*s;
  Real t13 = t2*n+t4*q+t6*t;
  Real t18 = t2*o+t4*r+t6*u;
  Real t21 = _lambda*(t8*s+t13*t+t18*u);
  Real t22 = _mu*t8;
  Real t25 = t21+2.0*t22*s;
  Real t26 = t1*t25;
  Real t27 = -n-q-t;
  Real t28 = t27*_mu;
  Real t31 = s*t13+t8*t;
  Real t33 = t28*t31;
  Real t34 = -o-r-u;
  Real t35 = t34*_mu;
  Real t38 = s*t18+t8*u;
  Real t40 = t35*t38;
  Real t41 = t26+t33+t40;
  Real t43 = t1*_mu;
  Real t45 = t43*t31;
  Real t46 = _mu*t13;
  Real t49 = t21+2.0*t46*t;
  Real t50 = t27*t49;
  Real t53 = t*t18+t13*u;
  Real t55 = t35*t53;
  Real t56 = t45+t50+t55;
  Real t59 = t43*t38;
  Real t61 = t28*t53;
  Real t62 = _mu*t18;
  Real t65 = t21+2.0*t62*u;
  Real t66 = t34*t65;
  Real t67 = t59+t61+t66;
  Real t69 = t41*b00+t56*b01+t67*b02;
  Real t70 = d-a;
  Real t72 = g-a;
  Real t74 = j-a;
  Real t76 = t70*m+t72*p+t74*s;
  Real t81 = _lambda*(s*t1+t*t27+u*t34);
  Real t82 = _mu*s;
  Real t85 = t81+2.0*t82*t1;
  Real t90 = t70*n+t72*q+t74*t;
  Real t91 = t90*_mu;
  Real t94 = t1*t+s*t27;
  Real t100 = t70*o+t72*r+t74*u;
  Real t101 = t100*_mu;
  Real t104 = t1*u+s*t34;
  Real t107 = t76*t85+t91*t94+t101*t104;
  Real t109 = t76*_mu;
  Real t112 = _mu*t;
  Real t115 = t81+2.0*t112*t27;
  Real t119 = t27*u+t*t34;
  Real t122 = t109*t94+t90*t115+t101*t119;
  Real t128 = _mu*u;
  Real t131 = t81+2.0*t128*t34;
  Real t133 = t109*t104+t91*t119+t100*t131;
  Real t136 = m*t25;
  Real t137 = n*_mu;
  Real t139 = t137*t31;
  Real t140 = o*_mu;
  Real t142 = t140*t38;
  Real t143 = t136+t139+t142;
  Real t145 = m*_mu;
  Real t147 = t145*t31;
  Real t148 = n*t49;
  Real t150 = t140*t53;
  Real t151 = t147+t148+t150;
  Real t154 = t145*t38;
  Real t156 = t137*t53;
  Real t157 = o*t65;
  Real t158 = t154+t156+t157;
  Real t160 = t143*b00+t151*b01+t158*b02;
  Real t165 = _lambda*(s*m+t*n+u*o);
  Real t168 = t165+2.0*t82*m;
  Real t172 = m*t+s*n;
  Real t177 = m*u+s*o;
  Real t180 = t76*t168+t91*t172+t101*t177;
  Real t186 = t165+2.0*t112*n;
  Real t190 = n*u+t*o;
  Real t193 = t109*t172+t90*t186+t101*t190;
  Real t201 = t165+2.0*t128*o;
  Real t203 = t109*t177+t91*t190+t100*t201;
  Real t206 = p*t25;
  Real t207 = q*_mu;
  Real t209 = t207*t31;
  Real t210 = r*_mu;
  Real t212 = t210*t38;
  Real t213 = t206+t209+t212;
  Real t215 = p*_mu;
  Real t217 = t215*t31;
  Real t218 = q*t49;
  Real t220 = t210*t53;
  Real t221 = t217+t218+t220;
  Real t224 = t215*t38;
  Real t226 = t207*t53;
  Real t227 = r*t65;
  Real t228 = t224+t226+t227;
  Real t230 = t213*b00+t221*b01+t228*b02;
  Real t235 = _lambda*(p*s+q*t+r*u);
  Real t238 = t235+2.0*t215*s;
  Real t242 = s*q+p*t;
  Real t247 = s*r+p*u;
  Real t250 = t76*t238+t91*t242+t101*t247;
  Real t256 = t235+2.0*t207*t;
  Real t260 = t*r+q*u;
  Real t263 = t109*t242+t90*t256+t101*t260;
  Real t271 = t235+2.0*t210*u;
  Real t273 = t109*t247+t91*t260+t100*t271;
  Real t276 = s*t25;
  Real t277 = t112*t31/2.0;
  Real t279 = t128*t38/2.0;
  Real t281 = t276+2.0*t277+2.0*t279;
  Real t283 = t82*t31/2.0;
  Real t285 = t*t49;
  Real t286 = t128*t53/2.0;
  Real t288 = 2.0*t283+t285+2.0*t286;
  Real t290 = t82*t38/2.0;
  Real t292 = t112*t53/2.0;
  Real t294 = u*t65;
  Real t295 = 2.0*t290+2.0*t292+t294;
  Real t297 = t281*b00+t288*b01+t295*b02;
  Real t298 = s*s;
  Real t299 = t*t;
  Real t300 = u*u;
  Real t302 = _lambda*(t298+t299+t300);
  Real t305 = t302+2.0*_mu*t298;
  Real t307 = s*t;
  Real t310 = s*u;
  Real t313 = t76*t305+2.0*t91*t307+2.0*t101*t310;
  Real t319 = t302+2.0*_mu*t299;
  Real t321 = t*u;
  Real t324 = 2.0*t109*t307+t90*t319+2.0*t101*t321;
  Real t332 = t302+2.0*_mu*t300;
  Real t334 = 2.0*t109*t310+2.0*t91*t321+t100*t332;
  Real t337 = e-b;
  Real t339 = h-b;
  Real t341 = k-b;
  Real t343 = t337*m+t339*p+t341*s;
  Real t348 = t337*n+t339*q+t341*t;
  Real t349 = t348*_mu;
  Real t355 = t337*o+t339*r+t341*u;
  Real t356 = t355*_mu;
  Real t359 = t343*t85+t349*t94+t356*t104;
  Real t361 = t343*_mu;
  Real t367 = t361*t94+t348*t115+t356*t119;
  Real t374 = t361*t104+t349*t119+t355*t131;
  Real t382 = t343*t168+t349*t172+t356*t177;
  Real t389 = t361*t172+t348*t186+t356*t190;
  Real t396 = t361*t177+t349*t190+t355*t201;
  Real t404 = t343*t238+t349*t242+t356*t247;
  Real t411 = t361*t242+t348*t256+t356*t260;
  Real t418 = t361*t247+t349*t260+t355*t271;
  Real t426 = t343*t305+2.0*t349*t307+2.0*t356*t310;
  Real t433 = 2.0*t361*t307+t348*t319+2.0*t356*t321;
  Real t440 = 2.0*t361*t310+2.0*t349*t321+t355*t332;
  Real t447 = _lambda*(t76*t1+t90*t27+t100*t34);
  Real t454 = t1*t90+t76*t27;
  Real t459 = t1*t100+t76*t34;
  Real t462 = s*(t447+2.0*t109*t1)+t112*t454+t128*t459;
  Real t472 = t27*t100+t90*t34;
  Real t475 = t82*t454+t*(t447+2.0*t91*t27)+t128*t472;
  Real t485 = t82*t459+t112*t472+u*(t447+2.0*t101*t34);
  Real t492 = _lambda*(t343*t1+t348*t27+t355*t34);
  Real t499 = t1*t348+t343*t27;
  Real t504 = t1*t355+t343*t34;
  Real t507 = s*(t492+2.0*t361*t1)+t112*t499+t128*t504;
  Real t517 = t27*t355+t348*t34;
  Real t520 = t82*t499+t*(t492+2.0*t349*t27)+t128*t517;
  Real t530 = t82*t504+t112*t517+u*(t492+2.0*t356*t34);
  Real t537 = _lambda*(t8*t1+t13*t27+t18*t34);
  Real t545 = t1*t13+t8*t27;
  Real t552 = t1*t18+t8*t34;
  Real t557 = t26+s*(t537+2.0*t22*t1)+t8*t85+t33+t112*t545+t46*t94+t40+t128*t552+t62*t104;
  Real t570 = t27*t18+t13*t34;
  Real t575 = t45+t82*t545+t22*t94+t50+t*(t537+2.0*t46*t27)+t13*t115+t55+t128*t570+t62*t119;
  Real t590 = t59+t82*t552+t22*t104+t61+t112*t570+t46*t119+t66+u*(t537+2.0*t62*t34)+t18*t131;
  Real t597 = _lambda*(t76*m+t90*n+t100*o);
  Real t604 = m*t90+t76*n;
  Real t609 = m*t100+t76*o;
  Real t612 = s*(t597+2.0*t109*m)+t112*t604+t128*t609;
  Real t622 = n*t100+t90*o;
  Real t625 = t82*t604+t*(t597+2.0*t91*n)+t128*t622;
  Real t635 = t82*t609+t112*t622+u*(t597+2.0*t101*o);
  Real t642 = _lambda*(t343*m+t348*n+t355*o);
  Real t649 = m*t348+t343*n;
  Real t654 = m*t355+t343*o;
  Real t657 = s*(t642+2.0*t361*m)+t112*t649+t128*t654;
  Real t667 = n*t355+t348*o;
  Real t670 = t82*t649+t*(t642+2.0*t349*n)+t128*t667;
  Real t680 = t82*t654+t112*t667+u*(t642+2.0*t356*o);
  Real t687 = _lambda*(t8*m+t13*n+t18*o);
  Real t695 = m*t13+t8*n;
  Real t702 = m*t18+t8*o;
  Real t707 = t136+s*(t687+2.0*t22*m)+t8*t168+t139+t112*t695+t46*t172+t142+t128*t702+t62*t177;
  Real t720 = n*t18+t13*o;
  Real t725 = t147+t82*t695+t22*t172+t148+t*(t687+2.0*t46*n)+t13*t186+t150+t128*t720+t62*t190;
  Real t740 = t154+t82*t702+t22*t177+t156+t112*t720+t46*t190+t157+u*(t687+2.0*t62*o)+t18*t201;
  Real t747 = _lambda*(t76*p+t90*q+t100*r);
  Real t754 = p*t90+t76*q;
  Real t759 = p*t100+t76*r;
  Real t762 = s*(t747+2.0*t109*p)+t112*t754+t128*t759;
  Real t772 = q*t100+t90*r;
  Real t775 = t82*t754+t*(t747+2.0*t91*q)+t128*t772;
  Real t785 = t82*t759+t112*t772+u*(t747+2.0*t101*r);
  Real t792 = _lambda*(t343*p+t348*q+t355*r);
  Real t799 = p*t348+t343*q;
  Real t804 = p*t355+t343*r;
  Real t807 = s*(t792+2.0*t361*p)+t112*t799+t128*t804;
  Real t817 = q*t355+t348*r;
  Real t820 = t82*t799+t*(t792+2.0*t349*q)+t128*t817;
  Real t830 = t82*t804+t112*t817+u*(t792+2.0*t356*r);
  Real t837 = _lambda*(t8*p+t13*q+t18*r);
  Real t845 = p*t13+t8*q;
  Real t852 = p*t18+t8*r;
  Real t857 = t206+s*(t837+2.0*t22*p)+t8*t238+t209+t112*t845+t46*t242+t212+t128*t852+t62*t247;
  Real t870 = q*t18+t13*r;
  Real t875 = t217+t82*t845+t22*t242+t218+t*(t837+2.0*t46*q)+t13*t256+t220+t128*t870+t62*t260;
  Real t890 = t224+t82*t852+t22*t247+t226+t112*t870+t46*t260+t227+u*(t837+2.0*t62*r)+t18*t271;
  Real t897 = _lambda*(t76*s+t90*t+t100*u);
  Real t904 = s*t90+t76*t;
  Real t909 = s*t100+t76*u;
  Real t912 = s*(t897+2.0*t109*s)+t112*t904+t128*t909;
  Real t922 = t*t100+t90*u;
  Real t925 = t82*t904+t*(t897+2.0*t91*t)+t128*t922;
  Real t935 = t82*t909+t112*t922+u*(t897+2.0*t101*u);
  Real t942 = _lambda*(t343*s+t348*t+t355*u);
  Real t949 = s*t348+t343*t;
  Real t954 = s*t355+t343*u;
  Real t957 = s*(t942+2.0*t361*s)+t112*t949+t128*t954;
  Real t967 = t*t355+t348*u;
  Real t970 = t82*t949+t*(t942+2.0*t349*t)+t128*t967;
  Real t980 = t82*t954+t112*t967+u*(t942+2.0*t356*u);
  Real t991 = 2.0*t276+t8*t305+4.0*t277+2.0*t46*t307+4.0*t279+2.0*t62*t310;
  Real t1001 = 4.0*t283+2.0*t22*t307+2.0*t285+t13*t319+4.0*t286+2.0*t62*t321;
  Real t1011 = 4.0*t290+2.0*t22*t310+4.0*t292+2.0*t46*t321+2.0*t294+t18*t332;
  Real t1017 = t41*b10+t56*b11+t67*b12;
  Real t1025 = t143*b10+t151*b11+t158*b12;
  Real t1033 = t213*b10+t221*b11+t228*b12;
  Real t1041 = t281*b10+t288*b11+t295*b12;
  Real t1113 = t41*b20+t56*b21+t67*b22;
  Real t1121 = t143*b20+t151*b21+t158*b22;
  Real t1129 = t213*b20+t221*b21+t228*b22;
  Real t1137 = t281*b20+t288*b21+t295*b22;
  Real t1209 = t41*b30+t56*b31+t67*b32;
  Real t1217 = t143*b30+t151*b31+t158*b32;
  Real t1225 = t213*b30+t221*b31+t228*b32;
  Real t1233 = t281*b30+t288*b31+t295*b32;
  hessian(0,0) = t69;
  hessian(0,1) = 0.0;
  hessian(0,2) = t107*b00+t122*b01+t133*b02;
  hessian(0,3) = t160;
  hessian(0,4) = 0.0;
  hessian(0,5) = t180*b00+t193*b01+t203*b02;
  hessian(0,6) = t230;
  hessian(0,7) = 0.0;
  hessian(0,8) = t250*b00+t263*b01+t273*b02;
  hessian(0,9) = t297;
  hessian(0,10) = 0.0;
  hessian(0,11) = t313*b00+t324*b01+t334*b02;
  hessian(1,0) = 0.0;
  hessian(1,1) = t69;
  hessian(1,2) = t359*b00+t367*b01+t374*b02;
  hessian(1,3) = 0.0;
  hessian(1,4) = t160;
  hessian(1,5) = t382*b00+t389*b01+t396*b02;
  hessian(1,6) = 0.0;
  hessian(1,7) = t230;
  hessian(1,8) = t404*b00+t411*b01+t418*b02;
  hessian(1,9) = 0.0;
  hessian(1,10) = t297;
  hessian(1,11) = t426*b00+t433*b01+t440*b02;
  hessian(2,0) = t462*b00+t475*b01+t485*b02;
  hessian(2,1) = t507*b00+t520*b01+t530*b02;
  hessian(2,2) = t557*b00+t575*b01+t590*b02;
  hessian(2,3) = t612*b00+t625*b01+t635*b02;
  hessian(2,4) = t657*b00+t670*b01+t680*b02;
  hessian(2,5) = t707*b00+t725*b01+t740*b02;
  hessian(2,6) = t762*b00+t775*b01+t785*b02;
  hessian(2,7) = t807*b00+t820*b01+t830*b02;
  hessian(2,8) = t857*b00+t875*b01+t890*b02;
  hessian(2,9) = t912*b00+t925*b01+t935*b02;
  hessian(2,10) = t957*b00+t970*b01+t980*b02;
  hessian(2,11) = t991*b00+t1001*b01+t1011*b02;
  hessian(3,0) = t1017;
  hessian(3,1) = 0.0;
  hessian(3,2) = t107*b10+t122*b11+t133*b12;
  hessian(3,3) = t1025;
  hessian(3,4) = 0.0;
  hessian(3,5) = t180*b10+t193*b11+t203*b12;
  hessian(3,6) = t1033;
  hessian(3,7) = 0.0;
  hessian(3,8) = t250*b10+t263*b11+t273*b12;
  hessian(3,9) = t1041;
  hessian(3,10) = 0.0;
  hessian(3,11) = t313*b10+t324*b11+t334*b12;
  hessian(4,0) = 0.0;
  hessian(4,1) = t1017;
  hessian(4,2) = t359*b10+t367*b11+t374*b12;
  hessian(4,3) = 0.0;
  hessian(4,4) = t1025;
  hessian(4,5) = t382*b10+t389*b11+t396*b12;
  hessian(4,6) = 0.0;
  hessian(4,7) = t1033;
  hessian(4,8) = t404*b10+t411*b11+t418*b12;
  hessian(4,9) = 0.0;
  hessian(4,10) = t1041;
  hessian(4,11) = t426*b10+t433*b11+t440*b12;
  hessian(5,0) = t462*b10+t475*b11+t485*b12;
  hessian(5,1) = t507*b10+t520*b11+t530*b12;
  hessian(5,2) = t557*b10+t575*b11+t590*b12;
  hessian(5,3) = t612*b10+t625*b11+t635*b12;
  hessian(5,4) = t657*b10+t670*b11+t680*b12;
  hessian(5,5) = t707*b10+t725*b11+t740*b12;
  hessian(5,6) = t762*b10+t775*b11+t785*b12;
  hessian(5,7) = t807*b10+t820*b11+t830*b12;
  hessian(5,8) = t857*b10+t875*b11+t890*b12;
  hessian(5,9) = t912*b10+t925*b11+t935*b12;
  hessian(5,10) = t957*b10+t970*b11+t980*b12;
  hessian(5,11) = t991*b10+t1001*b11+t1011*b12;
  hessian(6,0) = t1113;
  hessian(6,1) = 0.0;
  hessian(6,2) = t107*b20+t122*b21+t133*b22;
  hessian(6,3) = t1121;
  hessian(6,4) = 0.0;
  hessian(6,5) = t180*b20+t193*b21+t203*b22;
  hessian(6,6) = t1129;
  hessian(6,7) = 0.0;
  hessian(6,8) = t250*b20+t263*b21+t273*b22;
  hessian(6,9) = t1137;
  hessian(6,10) = 0.0;
  hessian(6,11) = t313*b20+t324*b21+t334*b22;
  hessian(7,0) = 0.0;
  hessian(7,1) = t1113;
  hessian(7,2) = t359*b20+t367*b21+t374*b22;
  hessian(7,3) = 0.0;
  hessian(7,4) = t1121;
  hessian(7,5) = t382*b20+t389*b21+t396*b22;
  hessian(7,6) = 0.0;
  hessian(7,7) = t1129;
  hessian(7,8) = t404*b20+t411*b21+t418*b22;
  hessian(7,9) = 0.0;
  hessian(7,10) = t1137;
  hessian(7,11) = t426*b20+t433*b21+t440*b22;
  hessian(8,0) = t462*b20+t475*b21+t485*b22;
  hessian(8,1) = t507*b20+t520*b21+t530*b22;
  hessian(8,2) = t557*b20+t575*b21+t590*b22;
  hessian(8,3) = t612*b20+t625*b21+t635*b22;
  hessian(8,4) = t657*b20+t670*b21+t680*b22;
  hessian(8,5) = t707*b20+t725*b21+t740*b22;
  hessian(8,6) = t762*b20+t775*b21+t785*b22;
  hessian(8,7) = t807*b20+t820*b21+t830*b22;
  hessian(8,8) = t857*b20+t875*b21+t890*b22;
  hessian(8,9) = t912*b20+t925*b21+t935*b22;
  hessian(8,10) = t957*b20+t970*b21+t980*b22;
  hessian(8,11) = t991*b20+t1001*b21+t1011*b22;
  hessian(9,0) = t1209;
  hessian(9,1) = 0.0;
  hessian(9,2) = t107*b30+t122*b31+t133*b32;
  hessian(9,3) = t1217;
  hessian(9,4) = 0.0;
  hessian(9,5) = t180*b30+t193*b31+t203*b32;
  hessian(9,6) = t1225;
  hessian(9,7) = 0.0;
  hessian(9,8) = t250*b30+t263*b31+t273*b32;
  hessian(9,9) = t1233;
  hessian(9,10) = 0.0;
  hessian(9,11) = t313*b30+t324*b31+t334*b32;
  hessian(10,0) = 0.0;
  hessian(10,1) = t1209;
  hessian(10,2) = t359*b30+t367*b31+t374*b32;
  hessian(10,3) = 0.0;
  hessian(10,4) = t1217;
  hessian(10,5) = t382*b30+t389*b31+t396*b32;
  hessian(10,6) = 0.0;
  hessian(10,7) = t1225;
  hessian(10,8) = t404*b30+t411*b31+t418*b32;
  hessian(10,9) = 0.0;
  hessian(10,10) = t1233;
  hessian(10,11) = t426*b30+t433*b31+t440*b32;
  hessian(11,0) = t462*b30+t475*b31+t485*b32;
  hessian(11,1) = t507*b30+t520*b31+t530*b32;
  hessian(11,2) = t557*b30+t575*b31+t590*b32;
  hessian(11,3) = t612*b30+t625*b31+t635*b32;
  hessian(11,4) = t657*b30+t670*b31+t680*b32;
  hessian(11,5) = t707*b30+t725*b31+t740*b32;
  hessian(11,6) = t762*b30+t775*b31+t785*b32;
  hessian(11,7) = t807*b30+t820*b31+t830*b32;
  hessian(11,8) = t857*b30+t875*b31+t890*b32;
  hessian(11,9) = t912*b30+t925*b31+t935*b32;
  hessian(11,10) = t957*b30+t970*b31+t980*b32;
  hessian(11,11) = t991*b30+t1001*b31+t1011*b32;
}

void STVK::hessian0(const Real* F, const VEC3F* b, MATRIX& hessian) {
  Real lam = _lambda;
  Real mu = _mu;
  const double b00 = b[0][0];
  const double b01 = b[0][1];
  const double b02 = b[0][2];
  const double b10 = b[1][0];
  const double b11 = b[1][1];
  const double b12 = b[1][2];
  const double b20 = b[2][0];
  const double b21 = b[2][1];
  const double b22 = b[2][2];
  const double b30 = b[3][0];
  const double b31 = b[3][1];
  const double b32 = b[3][2]; 

 
  Real t1 = lam*F[0];
  Real t3 = mu*F[0];
  Real t5 = 3.0*t1+6.0*t3;
  Real t8 = mu*F[3];
  Real t10 = lam*F[3]+2.0*t8;
  Real t13 = mu*F[6];
  Real t15 = lam*F[6]+2.0*t13;
  Real t19 = mu*F[1];
  Real t21 = lam*F[1]+2.0*t19;
  Real t22 = t21*b00;
  Real t23 = mu*F[4];
  Real t25 = mu*F[7];
  Real t29 = mu*F[2];
  Real t31 = lam*F[2]+2.0*t29;
  Real t32 = t31*b00;
  Real t33 = mu*F[5];
  Real t35 = mu*F[8];
  Real t40 = t1+2.0*t3;
  Real t43 = lam*F[4];
  Real t45 = t19*b01;
  Real t47 = lam*F[5];
  Real t49 = t29*b01;
  Real t54 = lam*F[7];
  Real t56 = t19*b02;
  Real t58 = lam*F[8];
  Real t60 = t29*b02;
  Real t68 = t40*b00+t8*b01+t13*b02;
  Real t73 = t8*b00+t1*b01;
  Real t78 = t13*b00+t1*b02;
  Real t90 = t21*b10;
  Real t94 = t31*b10;
  Real t102 = t19*b11;
  Real t105 = t29*b11;
  Real t111 = t19*b12;
  Real t114 = t29*b12;
  Real t122 = t40*b10+t8*b11+t13*b12;
  Real t127 = t8*b10+t1*b11;
  Real t132 = t13*b10+t1*b12;
  Real t144 = t21*b20;
  Real t148 = t31*b20;
  Real t156 = t19*b21;
  Real t159 = t29*b21;
  Real t165 = t19*b22;
  Real t168 = t29*b22;
  Real t176 = t40*b20+t8*b21+t13*b22;
  Real t181 = t8*b20+t1*b21;
  Real t186 = t13*b20+t1*b22;
  Real t198 = t21*b30;
  Real t202 = t31*b30;
  Real t210 = t19*b31;
  Real t213 = t29*b31;
  Real t219 = t19*b32;
  Real t222 = t29*b32;
  Real t230 = t40*b30+t8*b31+t13*b32;
  Real t235 = t8*b30+t1*b31;
  Real t240 = t13*b30+t1*b32;
  hessian(0,0) = t5*b00+t10*b01+t15*b02;
  hessian(0,1) = t22+t23*b01+t25*b02;
  hessian(0,2) = t32+t33*b01+t35*b02;
  hessian(0,3) = t10*b00+t40*b01;
  hessian(0,4) = t43*b00+t45;
  hessian(0,5) = t47*b00+t49;
  hessian(0,6) = t15*b00+t40*b02;
  hessian(0,7) = t54*b00+t56;
  hessian(0,8) = t58*b00+t60;
  hessian(1,0) = t22+t43*b01+t54*b02;
  hessian(1,1) = t68;
  hessian(1,2) = 0.0;
  hessian(1,3) = t23*b00+t45;
  hessian(1,4) = t73;
  hessian(1,5) = 0.0;
  hessian(1,6) = t25*b00+t56;
  hessian(1,7) = t78;
  hessian(1,8) = 0.0;
  hessian(2,0) = t32+t47*b01+t58*b02;
  hessian(2,1) = 0.0;
  hessian(2,2) = t68;
  hessian(2,3) = t33*b00+t49;
  hessian(2,4) = 0.0;
  hessian(2,5) = t73;
  hessian(2,6) = t35*b00+t60;
  hessian(2,7) = 0.0;
  hessian(2,8) = t78;
  hessian(3,0) = t5*b10+t10*b11+t15*b12;
  hessian(3,1) = t90+t23*b11+t25*b12;
  hessian(3,2) = t94+t33*b11+t35*b12;
  hessian(3,3) = t10*b10+t40*b11;
  hessian(3,4) = t43*b10+t102;
  hessian(3,5) = t47*b10+t105;
  hessian(3,6) = t15*b10+t40*b12;
  hessian(3,7) = t54*b10+t111;
  hessian(3,8) = t58*b10+t114;
  hessian(4,0) = t90+t43*b11+t54*b12;
  hessian(4,1) = t122;
  hessian(4,2) = 0.0;
  hessian(4,3) = t23*b10+t102;
  hessian(4,4) = t127;
  hessian(4,5) = 0.0;
  hessian(4,6) = t25*b10+t111;
  hessian(4,7) = t132;
  hessian(4,8) = 0.0;
  hessian(5,0) = t94+t47*b11+t58*b12;
  hessian(5,1) = 0.0;
  hessian(5,2) = t122;
  hessian(5,3) = t33*b10+t105;
  hessian(5,4) = 0.0;
  hessian(5,5) = t127;
  hessian(5,6) = t35*b10+t114;
  hessian(5,7) = 0.0;
  hessian(5,8) = t132;
  hessian(6,0) = t5*b20+t10*b21+t15*b22;
  hessian(6,1) = t144+t23*b21+t25*b22;
  hessian(6,2) = t148+t33*b21+t35*b22;
  hessian(6,3) = t10*b20+t40*b21;
  hessian(6,4) = t43*b20+t156;
  hessian(6,5) = t47*b20+t159;
  hessian(6,6) = t15*b20+t40*b22;
  hessian(6,7) = t54*b20+t165;
  hessian(6,8) = t58*b20+t168;
  hessian(7,0) = t144+t43*b21+t54*b22;
  hessian(7,1) = t176;
  hessian(7,2) = 0.0;
  hessian(7,3) = t23*b20+t156;
  hessian(7,4) = t181;
  hessian(7,5) = 0.0;
  hessian(7,6) = t25*b20+t165;
  hessian(7,7) = t186;
  hessian(7,8) = 0.0;
  hessian(8,0) = t148+t47*b21+t58*b22;
  hessian(8,1) = 0.0;
  hessian(8,2) = t176;
  hessian(8,3) = t33*b20+t159;
  hessian(8,4) = 0.0;
  hessian(8,5) = t181;
  hessian(8,6) = t35*b20+t168;
  hessian(8,7) = 0.0;
  hessian(8,8) = t186;
  hessian(9,0) = t5*b30+t10*b31+t15*b32;
  hessian(9,1) = t198+t23*b31+t25*b32;
  hessian(9,2) = t202+t33*b31+t35*b32;
  hessian(9,3) = t10*b30+t40*b31;
  hessian(9,4) = t43*b30+t210;
  hessian(9,5) = t47*b30+t213;
  hessian(9,6) = t15*b30+t40*b32;
  hessian(9,7) = t54*b30+t219;
  hessian(9,8) = t58*b30+t222;
  hessian(10,0) = t198+t43*b31+t54*b32;
  hessian(10,1) = t230;
  hessian(10,2) = 0.0;
  hessian(10,3) = t23*b30+t210;
  hessian(10,4) = t235;
  hessian(10,5) = 0.0;
  hessian(10,6) = t25*b30+t219;
  hessian(10,7) = t240;
  hessian(10,8) = 0.0;
  hessian(11,0) = t202+t47*b31+t58*b32;
  hessian(11,1) = 0.0;
  hessian(11,2) = t230;
  hessian(11,3) = t33*b30+t213;
  hessian(11,4) = 0.0;
  hessian(11,5) = t235;
  hessian(11,6) = t35*b30+t222;
  hessian(11,7) = 0.0;
  hessian(11,8) = t240;
 
 
}

void STVK::hessian1(const Real* F, const VEC3F* b, MATRIX& hessian) {
  Real lam = _lambda;
  Real mu = _mu;
  const double b00 = b[0][0];
  const double b01 = b[0][1];
  const double b02 = b[0][2];
  const double b10 = b[1][0];
  const double b11 = b[1][1];
  const double b12 = b[1][2];
  const double b20 = b[2][0];
  const double b21 = b[2][1];
  const double b22 = b[2][2];
  const double b30 = b[3][0];
  const double b31 = b[3][1];
  const double b32 = b[3][2]; 

 
  Real t1 = lam*F[1];
  Real t2 = mu*F[1];
  Real t4 = t1+2.0*t2;
  Real t6 = mu*F[4];
  Real t8 = mu*F[7];
  Real t10 = t4*b00+t6*b01+t8*b02;
  Real t12 = mu*F[0];
  Real t14 = lam*F[0]+2.0*t12;
  Real t15 = t14*b00;
  Real t16 = lam*F[3];
  Real t18 = lam*F[6];
  Real t23 = t6*b00+t1*b01;
  Real t24 = mu*F[3];
  Real t26 = t12*b01;
  Real t30 = t8*b00+t1*b02;
  Real t31 = mu*F[6];
  Real t33 = t12*b02;
  Real t40 = 3.0*t1+6.0*t2;
  Real t44 = lam*F[4]+2.0*t6;
  Real t48 = lam*F[7]+2.0*t8;
  Real t52 = mu*F[2];
  Real t54 = lam*F[2]+2.0*t52;
  Real t55 = t54*b00;
  Real t56 = mu*F[5];
  Real t58 = mu*F[8];
  Real t66 = lam*F[5];
  Real t68 = t52*b01;
  Real t75 = lam*F[8];
  Real t77 = t52*b02;
  Real t89 = t4*b10+t6*b11+t8*b12;
  Real t90 = t14*b10;
  Real t96 = t6*b10+t1*b11;
  Real t98 = t12*b11;
  Real t102 = t8*b10+t1*b12;
  Real t104 = t12*b12;
  Real t113 = t54*b10;
  Real t123 = t52*b11;
  Real t131 = t52*b12;
  Real t143 = t4*b20+t6*b21+t8*b22;
  Real t144 = t14*b20;
  Real t150 = t6*b20+t1*b21;
  Real t152 = t12*b21;
  Real t156 = t8*b20+t1*b22;
  Real t158 = t12*b22;
  Real t167 = t54*b20;
  Real t177 = t52*b21;
  Real t185 = t52*b22;
  Real t197 = t4*b30+t6*b31+t8*b32;
  Real t198 = t14*b30;
  Real t204 = t6*b30+t1*b31;
  Real t206 = t12*b31;
  Real t210 = t8*b30+t1*b32;
  Real t212 = t12*b32;
  Real t221 = t54*b30;
  Real t231 = t52*b31;
  Real t239 = t52*b32;
  hessian(0,0) = t10;
  hessian(0,1) = t15+t16*b01+t18*b02;
  hessian(0,2) = 0.0;
  hessian(0,3) = t23;
  hessian(0,4) = t24*b00+t26;
  hessian(0,5) = 0.0;
  hessian(0,6) = t30;
  hessian(0,7) = t31*b00+t33;
  hessian(0,8) = 0.0;
  hessian(1,0) = t15+t24*b01+t31*b02;
  hessian(1,1) = t40*b00+t44*b01+t48*b02;
  hessian(1,2) = t55+t56*b01+t58*b02;
  hessian(1,3) = t16*b00+t26;
  hessian(1,4) = t44*b00+t4*b01;
  hessian(1,5) = t66*b00+t68;
  hessian(1,6) = t18*b00+t33;
  hessian(1,7) = t48*b00+t4*b02;
  hessian(1,8) = t75*b00+t77;
  hessian(2,0) = 0.0;
  hessian(2,1) = t55+t66*b01+t75*b02;
  hessian(2,2) = t10;
  hessian(2,3) = 0.0;
  hessian(2,4) = t56*b00+t68;
  hessian(2,5) = t23;
  hessian(2,6) = 0.0;
  hessian(2,7) = t58*b00+t77;
  hessian(2,8) = t30;
  hessian(3,0) = t89;
  hessian(3,1) = t90+t16*b11+t18*b12;
  hessian(3,2) = 0.0;
  hessian(3,3) = t96;
  hessian(3,4) = t24*b10+t98;
  hessian(3,5) = 0.0;
  hessian(3,6) = t102;
  hessian(3,7) = t31*b10+t104;
  hessian(3,8) = 0.0;
  hessian(4,0) = t90+t24*b11+t31*b12;
  hessian(4,1) = t40*b10+t44*b11+t48*b12;
  hessian(4,2) = t113+t56*b11+t58*b12;
  hessian(4,3) = t16*b10+t98;
  hessian(4,4) = t44*b10+t4*b11;
  hessian(4,5) = t66*b10+t123;
  hessian(4,6) = t18*b10+t104;
  hessian(4,7) = t48*b10+t4*b12;
  hessian(4,8) = t75*b10+t131;
  hessian(5,0) = 0.0;
  hessian(5,1) = t113+t66*b11+t75*b12;
  hessian(5,2) = t89;
  hessian(5,3) = 0.0;
  hessian(5,4) = t56*b10+t123;
  hessian(5,5) = t96;
  hessian(5,6) = 0.0;
  hessian(5,7) = t58*b10+t131;
  hessian(5,8) = t102;
  hessian(6,0) = t143;
  hessian(6,1) = t144+t16*b21+t18*b22;
  hessian(6,2) = 0.0;
  hessian(6,3) = t150;
  hessian(6,4) = t24*b20+t152;
  hessian(6,5) = 0.0;
  hessian(6,6) = t156;
  hessian(6,7) = t31*b20+t158;
  hessian(6,8) = 0.0;
  hessian(7,0) = t144+t24*b21+t31*b22;
  hessian(7,1) = t40*b20+t44*b21+t48*b22;
  hessian(7,2) = t167+t56*b21+t58*b22;
  hessian(7,3) = t16*b20+t152;
  hessian(7,4) = t44*b20+t4*b21;
  hessian(7,5) = t66*b20+t177;
  hessian(7,6) = t18*b20+t158;
  hessian(7,7) = t48*b20+t4*b22;
  hessian(7,8) = t75*b20+t185;
  hessian(8,0) = 0.0;
  hessian(8,1) = t167+t66*b21+t75*b22;
  hessian(8,2) = t143;
  hessian(8,3) = 0.0;
  hessian(8,4) = t56*b20+t177;
  hessian(8,5) = t150;
  hessian(8,6) = 0.0;
  hessian(8,7) = t58*b20+t185;
  hessian(8,8) = t156;
  hessian(9,0) = t197;
  hessian(9,1) = t198+t16*b31+t18*b32;
  hessian(9,2) = 0.0;
  hessian(9,3) = t204;
  hessian(9,4) = t24*b30+t206;
  hessian(9,5) = 0.0;
  hessian(9,6) = t210;
  hessian(9,7) = t31*b30+t212;
  hessian(9,8) = 0.0;
  hessian(10,0) = t198+t24*b31+t31*b32;
  hessian(10,1) = t40*b30+t44*b31+t48*b32;
  hessian(10,2) = t221+t56*b31+t58*b32;
  hessian(10,3) = t16*b30+t206;
  hessian(10,4) = t44*b30+t4*b31;
  hessian(10,5) = t66*b30+t231;
  hessian(10,6) = t18*b30+t212;
  hessian(10,7) = t48*b30+t4*b32;
  hessian(10,8) = t75*b30+t239;
  hessian(11,0) = 0.0;
  hessian(11,1) = t221+t66*b31+t75*b32;
  hessian(11,2) = t197;
  hessian(11,3) = 0.0;
  hessian(11,4) = t56*b30+t231;
  hessian(11,5) = t204;
  hessian(11,6) = 0.0;
  hessian(11,7) = t58*b30+t239;
  hessian(11,8) = t210;
 
 
}

void STVK::hessian2(const Real* F, const VEC3F* b, MATRIX& hessian) {
  Real lam = _lambda;
  Real mu = _mu;
  const double b00 = b[0][0];
  const double b01 = b[0][1];
  const double b02 = b[0][2];
  const double b10 = b[1][0];
  const double b11 = b[1][1];
  const double b12 = b[1][2];
  const double b20 = b[2][0];
  const double b21 = b[2][1];
  const double b22 = b[2][2];
  const double b30 = b[3][0];
  const double b31 = b[3][1];
  const double b32 = b[3][2]; 

 
  Real t1 = lam*F[2];
  Real t2 = mu*F[2];
  Real t4 = t1+2.0*t2;
  Real t6 = mu*F[5];
  Real t8 = mu*F[8];
  Real t10 = t4*b00+t6*b01+t8*b02;
  Real t12 = mu*F[0];
  Real t14 = lam*F[0]+2.0*t12;
  Real t15 = t14*b00;
  Real t16 = lam*F[3];
  Real t18 = lam*F[6];
  Real t23 = t6*b00+t1*b01;
  Real t24 = mu*F[3];
  Real t26 = t12*b01;
  Real t30 = t8*b00+t1*b02;
  Real t31 = mu*F[6];
  Real t33 = t12*b02;
  Real t36 = mu*F[1];
  Real t38 = lam*F[1]+2.0*t36;
  Real t39 = t38*b00;
  Real t40 = lam*F[4];
  Real t42 = lam*F[7];
  Real t45 = mu*F[4];
  Real t47 = t36*b01;
  Real t49 = mu*F[7];
  Real t51 = t36*b02;
  Real t61 = 3.0*t1+6.0*t2;
  Real t65 = lam*F[5]+2.0*t6;
  Real t69 = lam*F[8]+2.0*t8;
  Real t89 = t4*b10+t6*b11+t8*b12;
  Real t90 = t14*b10;
  Real t96 = t6*b10+t1*b11;
  Real t98 = t12*b11;
  Real t102 = t8*b10+t1*b12;
  Real t104 = t12*b12;
  Real t106 = t38*b10;
  Real t111 = t36*b11;
  Real t114 = t36*b12;
  Real t143 = t4*b20+t6*b21+t8*b22;
  Real t144 = t14*b20;
  Real t150 = t6*b20+t1*b21;
  Real t152 = t12*b21;
  Real t156 = t8*b20+t1*b22;
  Real t158 = t12*b22;
  Real t160 = t38*b20;
  Real t165 = t36*b21;
  Real t168 = t36*b22;
  Real t197 = t4*b30+t6*b31+t8*b32;
  Real t198 = t14*b30;
  Real t204 = t6*b30+t1*b31;
  Real t206 = t12*b31;
  Real t210 = t8*b30+t1*b32;
  Real t212 = t12*b32;
  Real t214 = t38*b30;
  Real t219 = t36*b31;
  Real t222 = t36*b32;
  hessian(0,0) = t10;
  hessian(0,1) = 0.0;
  hessian(0,2) = t15+t16*b01+t18*b02;
  hessian(0,3) = t23;
  hessian(0,4) = 0.0;
  hessian(0,5) = t24*b00+t26;
  hessian(0,6) = t30;
  hessian(0,7) = 0.0;
  hessian(0,8) = t31*b00+t33;
  hessian(1,0) = 0.0;
  hessian(1,1) = t10;
  hessian(1,2) = t39+t40*b01+t42*b02;
  hessian(1,3) = 0.0;
  hessian(1,4) = t23;
  hessian(1,5) = t45*b00+t47;
  hessian(1,6) = 0.0;
  hessian(1,7) = t30;
  hessian(1,8) = t49*b00+t51;
  hessian(2,0) = t15+t24*b01+t31*b02;
  hessian(2,1) = t39+t45*b01+t49*b02;
  hessian(2,2) = t61*b00+t65*b01+t69*b02;
  hessian(2,3) = t16*b00+t26;
  hessian(2,4) = t40*b00+t47;
  hessian(2,5) = t65*b00+t4*b01;
  hessian(2,6) = t18*b00+t33;
  hessian(2,7) = t42*b00+t51;
  hessian(2,8) = t69*b00+t4*b02;
  hessian(3,0) = t89;
  hessian(3,1) = 0.0;
  hessian(3,2) = t90+t16*b11+t18*b12;
  hessian(3,3) = t96;
  hessian(3,4) = 0.0;
  hessian(3,5) = t24*b10+t98;
  hessian(3,6) = t102;
  hessian(3,7) = 0.0;
  hessian(3,8) = t31*b10+t104;
  hessian(4,0) = 0.0;
  hessian(4,1) = t89;
  hessian(4,2) = t106+t40*b11+t42*b12;
  hessian(4,3) = 0.0;
  hessian(4,4) = t96;
  hessian(4,5) = t45*b10+t111;
  hessian(4,6) = 0.0;
  hessian(4,7) = t102;
  hessian(4,8) = t49*b10+t114;
  hessian(5,0) = t90+t24*b11+t31*b12;
  hessian(5,1) = t106+t45*b11+t49*b12;
  hessian(5,2) = t61*b10+t65*b11+t69*b12;
  hessian(5,3) = t16*b10+t98;
  hessian(5,4) = t40*b10+t111;
  hessian(5,5) = t65*b10+t4*b11;
  hessian(5,6) = t18*b10+t104;
  hessian(5,7) = t42*b10+t114;
  hessian(5,8) = t69*b10+t4*b12;
  hessian(6,0) = t143;
  hessian(6,1) = 0.0;
  hessian(6,2) = t144+t16*b21+t18*b22;
  hessian(6,3) = t150;
  hessian(6,4) = 0.0;
  hessian(6,5) = t24*b20+t152;
  hessian(6,6) = t156;
  hessian(6,7) = 0.0;
  hessian(6,8) = t31*b20+t158;
  hessian(7,0) = 0.0;
  hessian(7,1) = t143;
  hessian(7,2) = t160+t40*b21+t42*b22;
  hessian(7,3) = 0.0;
  hessian(7,4) = t150;
  hessian(7,5) = t45*b20+t165;
  hessian(7,6) = 0.0;
  hessian(7,7) = t156;
  hessian(7,8) = t49*b20+t168;
  hessian(8,0) = t144+t24*b21+t31*b22;
  hessian(8,1) = t160+t45*b21+t49*b22;
  hessian(8,2) = t61*b20+t65*b21+t69*b22;
  hessian(8,3) = t16*b20+t152;
  hessian(8,4) = t40*b20+t165;
  hessian(8,5) = t65*b20+t4*b21;
  hessian(8,6) = t18*b20+t158;
  hessian(8,7) = t42*b20+t168;
  hessian(8,8) = t69*b20+t4*b22;
  hessian(9,0) = t197;
  hessian(9,1) = 0.0;
  hessian(9,2) = t198+t16*b31+t18*b32;
  hessian(9,3) = t204;
  hessian(9,4) = 0.0;
  hessian(9,5) = t24*b30+t206;
  hessian(9,6) = t210;
  hessian(9,7) = 0.0;
  hessian(9,8) = t31*b30+t212;
  hessian(10,0) = 0.0;
  hessian(10,1) = t197;
  hessian(10,2) = t214+t40*b31+t42*b32;
  hessian(10,3) = 0.0;
  hessian(10,4) = t204;
  hessian(10,5) = t45*b30+t219;
  hessian(10,6) = 0.0;
  hessian(10,7) = t210;
  hessian(10,8) = t49*b30+t222;
  hessian(11,0) = t198+t24*b31+t31*b32;
  hessian(11,1) = t214+t45*b31+t49*b32;
  hessian(11,2) = t61*b30+t65*b31+t69*b32;
  hessian(11,3) = t16*b30+t206;
  hessian(11,4) = t40*b30+t219;
  hessian(11,5) = t65*b30+t4*b31;
  hessian(11,6) = t18*b30+t212;
  hessian(11,7) = t42*b30+t222;
  hessian(11,8) = t69*b30+t4*b32;
 
 
}

void STVK::hessian3(const Real* F, const VEC3F* b, MATRIX& hessian) {
  Real lam = _lambda;
  Real mu = _mu;
  const double b00 = b[0][0];
  const double b01 = b[0][1];
  const double b02 = b[0][2];
  const double b10 = b[1][0];
  const double b11 = b[1][1];
  const double b12 = b[1][2];
  const double b20 = b[2][0];
  const double b21 = b[2][1];
  const double b22 = b[2][2];
  const double b30 = b[3][0];
  const double b31 = b[3][1];
  const double b32 = b[3][2]; 

 
  Real t1 = lam*F[3];
  Real t2 = mu*F[3];
  Real t4 = t1+2.0*t2;
  Real t7 = mu*F[0];
  Real t9 = lam*F[0]+2.0*t7;
  Real t12 = mu*F[4];
  Real t13 = t12*b00;
  Real t14 = lam*F[1];
  Real t17 = mu*F[5];
  Real t18 = t17*b00;
  Real t19 = lam*F[2];
  Real t25 = 3.0*t1+6.0*t2;
  Real t28 = mu*F[6];
  Real t30 = lam*F[6]+2.0*t28;
  Real t33 = mu*F[1];
  Real t37 = lam*F[4]+2.0*t12;
  Real t38 = t37*b01;
  Real t39 = mu*F[7];
  Real t42 = mu*F[2];
  Real t46 = lam*F[5]+2.0*t17;
  Real t47 = t46*b01;
  Real t48 = mu*F[8];
  Real t54 = lam*F[7];
  Real t56 = t12*b02;
  Real t58 = lam*F[8];
  Real t60 = t17*b02;
  Real t66 = t1*b00+t7*b01;
  Real t73 = t7*b00+t4*b01+t28*b02;
  Real t78 = t28*b01+t1*b02;
  Real t89 = t12*b10;
  Real t92 = t17*b10;
  Real t100 = t37*b11;
  Real t104 = t46*b11;
  Real t111 = t12*b12;
  Real t114 = t17*b12;
  Real t120 = t1*b10+t7*b11;
  Real t127 = t7*b10+t4*b11+t28*b12;
  Real t132 = t28*b11+t1*b12;
  Real t143 = t12*b20;
  Real t146 = t17*b20;
  Real t154 = t37*b21;
  Real t158 = t46*b21;
  Real t165 = t12*b22;
  Real t168 = t17*b22;
  Real t174 = t1*b20+t7*b21;
  Real t181 = t7*b20+t4*b21+t28*b22;
  Real t186 = t28*b21+t1*b22;
  Real t197 = t12*b30;
  Real t200 = t17*b30;
  Real t208 = t37*b31;
  Real t212 = t46*b31;
  Real t219 = t12*b32;
  Real t222 = t17*b32;
  Real t228 = t1*b30+t7*b31;
  Real t235 = t7*b30+t4*b31+t28*b32;
  Real t240 = t28*b31+t1*b32;
  hessian(0,0) = t4*b00+t9*b01;
  hessian(0,1) = t13+t14*b01;
  hessian(0,2) = t18+t19*b01;
  hessian(0,3) = t9*b00+t25*b01+t30*b02;
  hessian(0,4) = t33*b00+t38+t39*b02;
  hessian(0,5) = t42*b00+t47+t48*b02;
  hessian(0,6) = t30*b01+t4*b02;
  hessian(0,7) = t54*b01+t56;
  hessian(0,8) = t58*b01+t60;
  hessian(1,0) = t13+t33*b01;
  hessian(1,1) = t66;
  hessian(1,2) = 0.0;
  hessian(1,3) = t14*b00+t38+t54*b02;
  hessian(1,4) = t73;
  hessian(1,5) = 0.0;
  hessian(1,6) = t39*b01+t56;
  hessian(1,7) = t78;
  hessian(1,8) = 0.0;
  hessian(2,0) = t18+t42*b01;
  hessian(2,1) = 0.0;
  hessian(2,2) = t66;
  hessian(2,3) = t19*b00+t47+t58*b02;
  hessian(2,4) = 0.0;
  hessian(2,5) = t73;
  hessian(2,6) = t48*b01+t60;
  hessian(2,7) = 0.0;
  hessian(2,8) = t78;
  hessian(3,0) = t4*b10+t9*b11;
  hessian(3,1) = t89+t14*b11;
  hessian(3,2) = t92+t19*b11;
  hessian(3,3) = t9*b10+t25*b11+t30*b12;
  hessian(3,4) = t33*b10+t100+t39*b12;
  hessian(3,5) = t42*b10+t104+t48*b12;
  hessian(3,6) = t30*b11+t4*b12;
  hessian(3,7) = t54*b11+t111;
  hessian(3,8) = t58*b11+t114;
  hessian(4,0) = t89+t33*b11;
  hessian(4,1) = t120;
  hessian(4,2) = 0.0;
  hessian(4,3) = t14*b10+t100+t54*b12;
  hessian(4,4) = t127;
  hessian(4,5) = 0.0;
  hessian(4,6) = t39*b11+t111;
  hessian(4,7) = t132;
  hessian(4,8) = 0.0;
  hessian(5,0) = t92+t42*b11;
  hessian(5,1) = 0.0;
  hessian(5,2) = t120;
  hessian(5,3) = t19*b10+t104+t58*b12;
  hessian(5,4) = 0.0;
  hessian(5,5) = t127;
  hessian(5,6) = t48*b11+t114;
  hessian(5,7) = 0.0;
  hessian(5,8) = t132;
  hessian(6,0) = t4*b20+t9*b21;
  hessian(6,1) = t143+t14*b21;
  hessian(6,2) = t146+t19*b21;
  hessian(6,3) = t9*b20+t25*b21+t30*b22;
  hessian(6,4) = t33*b20+t154+t39*b22;
  hessian(6,5) = t42*b20+t158+t48*b22;
  hessian(6,6) = t30*b21+t4*b22;
  hessian(6,7) = t54*b21+t165;
  hessian(6,8) = t58*b21+t168;
  hessian(7,0) = t143+t33*b21;
  hessian(7,1) = t174;
  hessian(7,2) = 0.0;
  hessian(7,3) = t14*b20+t154+t54*b22;
  hessian(7,4) = t181;
  hessian(7,5) = 0.0;
  hessian(7,6) = t39*b21+t165;
  hessian(7,7) = t186;
  hessian(7,8) = 0.0;
  hessian(8,0) = t146+t42*b21;
  hessian(8,1) = 0.0;
  hessian(8,2) = t174;
  hessian(8,3) = t19*b20+t158+t58*b22;
  hessian(8,4) = 0.0;
  hessian(8,5) = t181;
  hessian(8,6) = t48*b21+t168;
  hessian(8,7) = 0.0;
  hessian(8,8) = t186;
  hessian(9,0) = t4*b30+t9*b31;
  hessian(9,1) = t197+t14*b31;
  hessian(9,2) = t200+t19*b31;
  hessian(9,3) = t9*b30+t25*b31+t30*b32;
  hessian(9,4) = t33*b30+t208+t39*b32;
  hessian(9,5) = t42*b30+t212+t48*b32;
  hessian(9,6) = t30*b31+t4*b32;
  hessian(9,7) = t54*b31+t219;
  hessian(9,8) = t58*b31+t222;
  hessian(10,0) = t197+t33*b31;
  hessian(10,1) = t228;
  hessian(10,2) = 0.0;
  hessian(10,3) = t14*b30+t208+t54*b32;
  hessian(10,4) = t235;
  hessian(10,5) = 0.0;
  hessian(10,6) = t39*b31+t219;
  hessian(10,7) = t240;
  hessian(10,8) = 0.0;
  hessian(11,0) = t200+t42*b31;
  hessian(11,1) = 0.0;
  hessian(11,2) = t228;
  hessian(11,3) = t19*b30+t212+t58*b32;
  hessian(11,4) = 0.0;
  hessian(11,5) = t235;
  hessian(11,6) = t48*b31+t222;
  hessian(11,7) = 0.0;
  hessian(11,8) = t240;
 
 
}

void STVK::hessian4(const Real* F, const VEC3F* b, MATRIX& hessian) {
  Real lam = _lambda;
  Real mu = _mu;
  const double b00 = b[0][0];
  const double b01 = b[0][1];
  const double b02 = b[0][2];
  const double b10 = b[1][0];
  const double b11 = b[1][1];
  const double b12 = b[1][2];
  const double b20 = b[2][0];
  const double b21 = b[2][1];
  const double b22 = b[2][2];
  const double b30 = b[3][0];
  const double b31 = b[3][1];
  const double b32 = b[3][2]; 

 
  Real t1 = lam*F[4];
  Real t3 = mu*F[1];
  Real t5 = t1*b00+t3*b01;
  Real t6 = mu*F[3];
  Real t7 = t6*b00;
  Real t8 = mu*F[0];
  Real t12 = mu*F[4];
  Real t14 = t1+2.0*t12;
  Real t16 = mu*F[7];
  Real t18 = t3*b00+t14*b01+t16*b02;
  Real t19 = lam*F[0];
  Real t23 = lam*F[3]+2.0*t6;
  Real t24 = t23*b01;
  Real t25 = lam*F[6];
  Real t30 = t16*b01+t1*b02;
  Real t31 = mu*F[6];
  Real t33 = t6*b02;
  Real t40 = lam*F[1]+2.0*t3;
  Real t43 = mu*F[5];
  Real t44 = t43*b00;
  Real t45 = lam*F[2];
  Real t54 = 3.0*t1+6.0*t12;
  Real t58 = lam*F[7]+2.0*t16;
  Real t61 = mu*F[2];
  Real t65 = lam*F[5]+2.0*t43;
  Real t66 = t65*b01;
  Real t67 = mu*F[8];
  Real t75 = lam*F[8];
  Real t77 = t43*b02;
  Real t88 = t1*b10+t3*b11;
  Real t89 = t6*b10;
  Real t95 = t3*b10+t14*b11+t16*b12;
  Real t97 = t23*b11;
  Real t102 = t16*b11+t1*b12;
  Real t104 = t6*b12;
  Real t111 = t43*b10;
  Real t122 = t65*b11;
  Real t131 = t43*b12;
  Real t142 = t1*b20+t3*b21;
  Real t143 = t6*b20;
  Real t149 = t3*b20+t14*b21+t16*b22;
  Real t151 = t23*b21;
  Real t156 = t16*b21+t1*b22;
  Real t158 = t6*b22;
  Real t165 = t43*b20;
  Real t176 = t65*b21;
  Real t185 = t43*b22;
  Real t196 = t1*b30+t3*b31;
  Real t197 = t6*b30;
  Real t203 = t3*b30+t14*b31+t16*b32;
  Real t205 = t23*b31;
  Real t210 = t16*b31+t1*b32;
  Real t212 = t6*b32;
  Real t219 = t43*b30;
  Real t230 = t65*b31;
  Real t239 = t43*b32;
  hessian(0,0) = t5;
  hessian(0,1) = t7+t8*b01;
  hessian(0,2) = 0.0;
  hessian(0,3) = t18;
  hessian(0,4) = t19*b00+t24+t25*b02;
  hessian(0,5) = 0.0;
  hessian(0,6) = t30;
  hessian(0,7) = t31*b01+t33;
  hessian(0,8) = 0.0;
  hessian(1,0) = t7+t19*b01;
  hessian(1,1) = t14*b00+t40*b01;
  hessian(1,2) = t44+t45*b01;
  hessian(1,3) = t8*b00+t24+t31*b02;
  hessian(1,4) = t40*b00+t54*b01+t58*b02;
  hessian(1,5) = t61*b00+t66+t67*b02;
  hessian(1,6) = t25*b01+t33;
  hessian(1,7) = t58*b01+t14*b02;
  hessian(1,8) = t75*b01+t77;
  hessian(2,0) = 0.0;
  hessian(2,1) = t44+t61*b01;
  hessian(2,2) = t5;
  hessian(2,3) = 0.0;
  hessian(2,4) = t45*b00+t66+t75*b02;
  hessian(2,5) = t18;
  hessian(2,6) = 0.0;
  hessian(2,7) = t67*b01+t77;
  hessian(2,8) = t30;
  hessian(3,0) = t88;
  hessian(3,1) = t89+t8*b11;
  hessian(3,2) = 0.0;
  hessian(3,3) = t95;
  hessian(3,4) = t19*b10+t97+t25*b12;
  hessian(3,5) = 0.0;
  hessian(3,6) = t102;
  hessian(3,7) = t31*b11+t104;
  hessian(3,8) = 0.0;
  hessian(4,0) = t89+t19*b11;
  hessian(4,1) = t14*b10+t40*b11;
  hessian(4,2) = t111+t45*b11;
  hessian(4,3) = t8*b10+t97+t31*b12;
  hessian(4,4) = t40*b10+t54*b11+t58*b12;
  hessian(4,5) = t61*b10+t122+t67*b12;
  hessian(4,6) = t25*b11+t104;
  hessian(4,7) = t58*b11+t14*b12;
  hessian(4,8) = t75*b11+t131;
  hessian(5,0) = 0.0;
  hessian(5,1) = t111+t61*b11;
  hessian(5,2) = t88;
  hessian(5,3) = 0.0;
  hessian(5,4) = t45*b10+t122+t75*b12;
  hessian(5,5) = t95;
  hessian(5,6) = 0.0;
  hessian(5,7) = t67*b11+t131;
  hessian(5,8) = t102;
  hessian(6,0) = t142;
  hessian(6,1) = t143+t8*b21;
  hessian(6,2) = 0.0;
  hessian(6,3) = t149;
  hessian(6,4) = t19*b20+t151+t25*b22;
  hessian(6,5) = 0.0;
  hessian(6,6) = t156;
  hessian(6,7) = t31*b21+t158;
  hessian(6,8) = 0.0;
  hessian(7,0) = t143+t19*b21;
  hessian(7,1) = t14*b20+t40*b21;
  hessian(7,2) = t165+t45*b21;
  hessian(7,3) = t8*b20+t151+t31*b22;
  hessian(7,4) = t40*b20+t54*b21+t58*b22;
  hessian(7,5) = t61*b20+t176+t67*b22;
  hessian(7,6) = t25*b21+t158;
  hessian(7,7) = t58*b21+t14*b22;
  hessian(7,8) = t75*b21+t185;
  hessian(8,0) = 0.0;
  hessian(8,1) = t165+t61*b21;
  hessian(8,2) = t142;
  hessian(8,3) = 0.0;
  hessian(8,4) = t45*b20+t176+t75*b22;
  hessian(8,5) = t149;
  hessian(8,6) = 0.0;
  hessian(8,7) = t67*b21+t185;
  hessian(8,8) = t156;
  hessian(9,0) = t196;
  hessian(9,1) = t197+t8*b31;
  hessian(9,2) = 0.0;
  hessian(9,3) = t203;
  hessian(9,4) = t19*b30+t205+t25*b32;
  hessian(9,5) = 0.0;
  hessian(9,6) = t210;
  hessian(9,7) = t31*b31+t212;
  hessian(9,8) = 0.0;
  hessian(10,0) = t197+t19*b31;
  hessian(10,1) = t14*b30+t40*b31;
  hessian(10,2) = t219+t45*b31;
  hessian(10,3) = t8*b30+t205+t31*b32;
  hessian(10,4) = t40*b30+t54*b31+t58*b32;
  hessian(10,5) = t61*b30+t230+t67*b32;
  hessian(10,6) = t25*b31+t212;
  hessian(10,7) = t58*b31+t14*b32;
  hessian(10,8) = t75*b31+t239;
  hessian(11,0) = 0.0;
  hessian(11,1) = t219+t61*b31;
  hessian(11,2) = t196;
  hessian(11,3) = 0.0;
  hessian(11,4) = t45*b30+t230+t75*b32;
  hessian(11,5) = t203;
  hessian(11,6) = 0.0;
  hessian(11,7) = t67*b31+t239;
  hessian(11,8) = t210;
 
 
}

void STVK::hessian5(const Real* F, const VEC3F* b, MATRIX& hessian) {
  Real lam = _lambda;
  Real mu = _mu;
  const double b00 = b[0][0];
  const double b01 = b[0][1];
  const double b02 = b[0][2];
  const double b10 = b[1][0];
  const double b11 = b[1][1];
  const double b12 = b[1][2];
  const double b20 = b[2][0];
  const double b21 = b[2][1];
  const double b22 = b[2][2];
  const double b30 = b[3][0];
  const double b31 = b[3][1];
  const double b32 = b[3][2]; 

 
  Real t1 = lam*F[5];
  Real t3 = mu*F[2];
  Real t5 = t1*b00+t3*b01;
  Real t6 = mu*F[3];
  Real t7 = t6*b00;
  Real t8 = mu*F[0];
  Real t12 = mu*F[5];
  Real t14 = t1+2.0*t12;
  Real t16 = mu*F[8];
  Real t18 = t3*b00+t14*b01+t16*b02;
  Real t19 = lam*F[0];
  Real t23 = lam*F[3]+2.0*t6;
  Real t24 = t23*b01;
  Real t25 = lam*F[6];
  Real t30 = t16*b01+t1*b02;
  Real t31 = mu*F[6];
  Real t33 = t6*b02;
  Real t35 = mu*F[4];
  Real t36 = t35*b00;
  Real t37 = mu*F[1];
  Real t40 = lam*F[1];
  Real t44 = lam*F[4]+2.0*t35;
  Real t45 = t44*b01;
  Real t46 = lam*F[7];
  Real t49 = mu*F[7];
  Real t51 = t35*b02;
  Real t60 = lam*F[2]+2.0*t3;
  Real t72 = 3.0*t1+6.0*t12;
  Real t76 = lam*F[8]+2.0*t16;
  Real t88 = t1*b10+t3*b11;
  Real t89 = t6*b10;
  Real t95 = t3*b10+t14*b11+t16*b12;
  Real t97 = t23*b11;
  Real t102 = t16*b11+t1*b12;
  Real t104 = t6*b12;
  Real t106 = t35*b10;
  Real t110 = t44*b11;
  Real t114 = t35*b12;
  Real t142 = t1*b20+t3*b21;
  Real t143 = t6*b20;
  Real t149 = t3*b20+t14*b21+t16*b22;
  Real t151 = t23*b21;
  Real t156 = t16*b21+t1*b22;
  Real t158 = t6*b22;
  Real t160 = t35*b20;
  Real t164 = t44*b21;
  Real t168 = t35*b22;
  Real t196 = t1*b30+t3*b31;
  Real t197 = t6*b30;
  Real t203 = t3*b30+t14*b31+t16*b32;
  Real t205 = t23*b31;
  Real t210 = t16*b31+t1*b32;
  Real t212 = t6*b32;
  Real t214 = t35*b30;
  Real t218 = t44*b31;
  Real t222 = t35*b32;
  hessian(0,0) = t5;
  hessian(0,1) = 0.0;
  hessian(0,2) = t7+t8*b01;
  hessian(0,3) = t18;
  hessian(0,4) = 0.0;
  hessian(0,5) = t19*b00+t24+t25*b02;
  hessian(0,6) = t30;
  hessian(0,7) = 0.0;
  hessian(0,8) = t31*b01+t33;
  hessian(1,0) = 0.0;
  hessian(1,1) = t5;
  hessian(1,2) = t36+t37*b01;
  hessian(1,3) = 0.0;
  hessian(1,4) = t18;
  hessian(1,5) = t40*b00+t45+t46*b02;
  hessian(1,6) = 0.0;
  hessian(1,7) = t30;
  hessian(1,8) = t49*b01+t51;
  hessian(2,0) = t7+t19*b01;
  hessian(2,1) = t36+t40*b01;
  hessian(2,2) = t14*b00+t60*b01;
  hessian(2,3) = t8*b00+t24+t31*b02;
  hessian(2,4) = t37*b00+t45+t49*b02;
  hessian(2,5) = t60*b00+t72*b01+t76*b02;
  hessian(2,6) = t25*b01+t33;
  hessian(2,7) = t46*b01+t51;
  hessian(2,8) = t76*b01+t14*b02;
  hessian(3,0) = t88;
  hessian(3,1) = 0.0;
  hessian(3,2) = t89+t8*b11;
  hessian(3,3) = t95;
  hessian(3,4) = 0.0;
  hessian(3,5) = t19*b10+t97+t25*b12;
  hessian(3,6) = t102;
  hessian(3,7) = 0.0;
  hessian(3,8) = t31*b11+t104;
  hessian(4,0) = 0.0;
  hessian(4,1) = t88;
  hessian(4,2) = t106+t37*b11;
  hessian(4,3) = 0.0;
  hessian(4,4) = t95;
  hessian(4,5) = t40*b10+t110+t46*b12;
  hessian(4,6) = 0.0;
  hessian(4,7) = t102;
  hessian(4,8) = t49*b11+t114;
  hessian(5,0) = t89+t19*b11;
  hessian(5,1) = t106+t40*b11;
  hessian(5,2) = t14*b10+t60*b11;
  hessian(5,3) = t8*b10+t97+t31*b12;
  hessian(5,4) = t37*b10+t110+t49*b12;
  hessian(5,5) = t60*b10+t72*b11+t76*b12;
  hessian(5,6) = t25*b11+t104;
  hessian(5,7) = t46*b11+t114;
  hessian(5,8) = t76*b11+t14*b12;
  hessian(6,0) = t142;
  hessian(6,1) = 0.0;
  hessian(6,2) = t143+t8*b21;
  hessian(6,3) = t149;
  hessian(6,4) = 0.0;
  hessian(6,5) = t19*b20+t151+t25*b22;
  hessian(6,6) = t156;
  hessian(6,7) = 0.0;
  hessian(6,8) = t31*b21+t158;
  hessian(7,0) = 0.0;
  hessian(7,1) = t142;
  hessian(7,2) = t160+t37*b21;
  hessian(7,3) = 0.0;
  hessian(7,4) = t149;
  hessian(7,5) = t40*b20+t164+t46*b22;
  hessian(7,6) = 0.0;
  hessian(7,7) = t156;
  hessian(7,8) = t49*b21+t168;
  hessian(8,0) = t143+t19*b21;
  hessian(8,1) = t160+t40*b21;
  hessian(8,2) = t14*b20+t60*b21;
  hessian(8,3) = t8*b20+t151+t31*b22;
  hessian(8,4) = t37*b20+t164+t49*b22;
  hessian(8,5) = t60*b20+t72*b21+t76*b22;
  hessian(8,6) = t25*b21+t158;
  hessian(8,7) = t46*b21+t168;
  hessian(8,8) = t76*b21+t14*b22;
  hessian(9,0) = t196;
  hessian(9,1) = 0.0;
  hessian(9,2) = t197+t8*b31;
  hessian(9,3) = t203;
  hessian(9,4) = 0.0;
  hessian(9,5) = t19*b30+t205+t25*b32;
  hessian(9,6) = t210;
  hessian(9,7) = 0.0;
  hessian(9,8) = t31*b31+t212;
  hessian(10,0) = 0.0;
  hessian(10,1) = t196;
  hessian(10,2) = t214+t37*b31;
  hessian(10,3) = 0.0;
  hessian(10,4) = t203;
  hessian(10,5) = t40*b30+t218+t46*b32;
  hessian(10,6) = 0.0;
  hessian(10,7) = t210;
  hessian(10,8) = t49*b31+t222;
  hessian(11,0) = t197+t19*b31;
  hessian(11,1) = t214+t40*b31;
  hessian(11,2) = t14*b30+t60*b31;
  hessian(11,3) = t8*b30+t205+t31*b32;
  hessian(11,4) = t37*b30+t218+t49*b32;
  hessian(11,5) = t60*b30+t72*b31+t76*b32;
  hessian(11,6) = t25*b31+t212;
  hessian(11,7) = t46*b31+t222;
  hessian(11,8) = t76*b31+t14*b32;
 
 
}

void STVK::hessian6(const Real* F, const VEC3F* b, MATRIX& hessian) {
  Real lam = _lambda;
  Real mu = _mu;
  const double b00 = b[0][0];
  const double b01 = b[0][1];
  const double b02 = b[0][2];
  const double b10 = b[1][0];
  const double b11 = b[1][1];
  const double b12 = b[1][2];
  const double b20 = b[2][0];
  const double b21 = b[2][1];
  const double b22 = b[2][2];
  const double b30 = b[3][0];
  const double b31 = b[3][1];
  const double b32 = b[3][2]; 

 
  Real t1 = lam*F[6];
  Real t2 = mu*F[6];
  Real t4 = t1+2.0*t2;
  Real t7 = mu*F[0];
  Real t9 = lam*F[0]+2.0*t7;
  Real t12 = mu*F[7];
  Real t13 = t12*b00;
  Real t14 = lam*F[1];
  Real t17 = mu*F[8];
  Real t18 = t17*b00;
  Real t19 = lam*F[2];
  Real t24 = mu*F[3];
  Real t26 = lam*F[3]+2.0*t24;
  Real t29 = t12*b01;
  Real t30 = lam*F[4];
  Real t33 = t17*b01;
  Real t34 = lam*F[5];
  Real t41 = 3.0*t1+6.0*t2;
  Real t44 = mu*F[1];
  Real t46 = mu*F[4];
  Real t50 = lam*F[7]+2.0*t12;
  Real t51 = t50*b02;
  Real t53 = mu*F[2];
  Real t55 = mu*F[5];
  Real t59 = lam*F[8]+2.0*t17;
  Real t60 = t59*b02;
  Real t66 = t1*b00+t7*b02;
  Real t71 = t1*b01+t24*b02;
  Real t78 = t7*b00+t24*b01+t4*b02;
  Real t89 = t12*b10;
  Real t92 = t17*b10;
  Real t98 = t12*b11;
  Real t101 = t17*b11;
  Real t110 = t50*b12;
  Real t114 = t59*b12;
  Real t120 = t1*b10+t7*b12;
  Real t125 = t1*b11+t24*b12;
  Real t132 = t7*b10+t24*b11+t4*b12;
  Real t143 = t12*b20;
  Real t146 = t17*b20;
  Real t152 = t12*b21;
  Real t155 = t17*b21;
  Real t164 = t50*b22;
  Real t168 = t59*b22;
  Real t174 = t1*b20+t7*b22;
  Real t179 = t1*b21+t24*b22;
  Real t186 = t7*b20+t24*b21+t4*b22;
  Real t197 = t12*b30;
  Real t200 = t17*b30;
  Real t206 = t12*b31;
  Real t209 = t17*b31;
  Real t218 = t50*b32;
  Real t222 = t59*b32;
  Real t228 = t1*b30+t7*b32;
  Real t233 = t1*b31+t24*b32;
  Real t240 = t7*b30+t24*b31+t4*b32;
  hessian(0,0) = t4*b00+t9*b02;
  hessian(0,1) = t13+t14*b02;
  hessian(0,2) = t18+t19*b02;
  hessian(0,3) = t4*b01+t26*b02;
  hessian(0,4) = t29+t30*b02;
  hessian(0,5) = t33+t34*b02;
  hessian(0,6) = t9*b00+t26*b01+t41*b02;
  hessian(0,7) = t44*b00+t46*b01+t51;
  hessian(0,8) = t53*b00+t55*b01+t60;
  hessian(1,0) = t13+t44*b02;
  hessian(1,1) = t66;
  hessian(1,2) = 0.0;
  hessian(1,3) = t29+t46*b02;
  hessian(1,4) = t71;
  hessian(1,5) = 0.0;
  hessian(1,6) = t14*b00+t30*b01+t51;
  hessian(1,7) = t78;
  hessian(1,8) = 0.0;
  hessian(2,0) = t18+t53*b02;
  hessian(2,1) = 0.0;
  hessian(2,2) = t66;
  hessian(2,3) = t33+t55*b02;
  hessian(2,4) = 0.0;
  hessian(2,5) = t71;
  hessian(2,6) = t19*b00+t34*b01+t60;
  hessian(2,7) = 0.0;
  hessian(2,8) = t78;
  hessian(3,0) = t4*b10+t9*b12;
  hessian(3,1) = t89+t14*b12;
  hessian(3,2) = t92+t19*b12;
  hessian(3,3) = t4*b11+t26*b12;
  hessian(3,4) = t98+t30*b12;
  hessian(3,5) = t101+t34*b12;
  hessian(3,6) = t9*b10+t26*b11+t41*b12;
  hessian(3,7) = t44*b10+t46*b11+t110;
  hessian(3,8) = t53*b10+t55*b11+t114;
  hessian(4,0) = t89+t44*b12;
  hessian(4,1) = t120;
  hessian(4,2) = 0.0;
  hessian(4,3) = t98+t46*b12;
  hessian(4,4) = t125;
  hessian(4,5) = 0.0;
  hessian(4,6) = t14*b10+t110+t30*b11;
  hessian(4,7) = t132;
  hessian(4,8) = 0.0;
  hessian(5,0) = t92+t53*b12;
  hessian(5,1) = 0.0;
  hessian(5,2) = t120;
  hessian(5,3) = t101+t55*b12;
  hessian(5,4) = 0.0;
  hessian(5,5) = t125;
  hessian(5,6) = t19*b10+t34*b11+t114;
  hessian(5,7) = 0.0;
  hessian(5,8) = t132;
  hessian(6,0) = t4*b20+t9*b22;
  hessian(6,1) = t143+t14*b22;
  hessian(6,2) = t146+t19*b22;
  hessian(6,3) = t4*b21+t26*b22;
  hessian(6,4) = t152+t30*b22;
  hessian(6,5) = t155+t34*b22;
  hessian(6,6) = t9*b20+t26*b21+t41*b22;
  hessian(6,7) = t44*b20+t46*b21+t164;
  hessian(6,8) = t53*b20+t55*b21+t168;
  hessian(7,0) = t143+t44*b22;
  hessian(7,1) = t174;
  hessian(7,2) = 0.0;
  hessian(7,3) = t152+t46*b22;
  hessian(7,4) = t179;
  hessian(7,5) = 0.0;
  hessian(7,6) = t14*b20+t164+t30*b21;
  hessian(7,7) = t186;
  hessian(7,8) = 0.0;
  hessian(8,0) = t146+t53*b22;
  hessian(8,1) = 0.0;
  hessian(8,2) = t174;
  hessian(8,3) = t155+t55*b22;
  hessian(8,4) = 0.0;
  hessian(8,5) = t179;
  hessian(8,6) = t19*b20+t34*b21+t168;
  hessian(8,7) = 0.0;
  hessian(8,8) = t186;
  hessian(9,0) = t4*b30+t9*b32;
  hessian(9,1) = t197+t14*b32;
  hessian(9,2) = t200+t19*b32;
  hessian(9,3) = t4*b31+t26*b32;
  hessian(9,4) = t206+t30*b32;
  hessian(9,5) = t209+t34*b32;
  hessian(9,6) = t9*b30+t26*b31+t41*b32;
  hessian(9,7) = t44*b30+t46*b31+t218;
  hessian(9,8) = t53*b30+t55*b31+t222;
  hessian(10,0) = t197+t44*b32;
  hessian(10,1) = t228;
  hessian(10,2) = 0.0;
  hessian(10,3) = t206+t46*b32;
  hessian(10,4) = t233;
  hessian(10,5) = 0.0;
  hessian(10,6) = t14*b30+t218+t30*b31;
  hessian(10,7) = t240;
  hessian(10,8) = 0.0;
  hessian(11,0) = t200+t53*b32;
  hessian(11,1) = 0.0;
  hessian(11,2) = t228;
  hessian(11,3) = t209+t55*b32;
  hessian(11,4) = 0.0;
  hessian(11,5) = t233;
  hessian(11,6) = t19*b30+t34*b31+t222;
  hessian(11,7) = 0.0;
  hessian(11,8) = t240;
 
 
}

void STVK::hessian7(const Real* F, const VEC3F* b, MATRIX& hessian) {
  Real lam = _lambda;
  Real mu = _mu;
  const double b00 = b[0][0];
  const double b01 = b[0][1];
  const double b02 = b[0][2];
  const double b10 = b[1][0];
  const double b11 = b[1][1];
  const double b12 = b[1][2];
  const double b20 = b[2][0];
  const double b21 = b[2][1];
  const double b22 = b[2][2];
  const double b30 = b[3][0];
  const double b31 = b[3][1];
  const double b32 = b[3][2]; 

 
  Real t1 = lam*F[7];
  Real t3 = mu*F[1];
  Real t5 = t1*b00+t3*b02;
  Real t6 = mu*F[6];
  Real t7 = t6*b00;
  Real t8 = mu*F[0];
  Real t12 = mu*F[4];
  Real t14 = t1*b01+t12*b02;
  Real t15 = t6*b01;
  Real t16 = mu*F[3];
  Real t21 = mu*F[7];
  Real t23 = t1+2.0*t21;
  Real t25 = t3*b00+t12*b01+t23*b02;
  Real t26 = lam*F[0];
  Real t28 = lam*F[3];
  Real t32 = lam*F[6]+2.0*t6;
  Real t33 = t32*b02;
  Real t40 = lam*F[1]+2.0*t3;
  Real t43 = mu*F[8];
  Real t44 = t43*b00;
  Real t45 = lam*F[2];
  Real t53 = lam*F[4]+2.0*t12;
  Real t56 = t43*b01;
  Real t57 = lam*F[5];
  Real t67 = 3.0*t1+6.0*t21;
  Real t70 = mu*F[2];
  Real t72 = mu*F[5];
  Real t76 = lam*F[8]+2.0*t43;
  Real t77 = t76*b02;
  Real t88 = t1*b10+t3*b12;
  Real t89 = t6*b10;
  Real t94 = t1*b11+t12*b12;
  Real t95 = t6*b11;
  Real t101 = t3*b10+t12*b11+t23*b12;
  Real t104 = t32*b12;
  Real t111 = t43*b10;
  Real t119 = t43*b11;
  Real t131 = t76*b12;
  Real t142 = t1*b20+t3*b22;
  Real t143 = t6*b20;
  Real t148 = t1*b21+t12*b22;
  Real t149 = t6*b21;
  Real t155 = t3*b20+t12*b21+t23*b22;
  Real t158 = t32*b22;
  Real t165 = t43*b20;
  Real t173 = t43*b21;
  Real t185 = t76*b22;
  Real t196 = t1*b30+t3*b32;
  Real t197 = t6*b30;
  Real t202 = t1*b31+t12*b32;
  Real t203 = t6*b31;
  Real t209 = t3*b30+t12*b31+t23*b32;
  Real t212 = t32*b32;
  Real t219 = t43*b30;
  Real t227 = t43*b31;
  Real t239 = t76*b32;
  hessian(0,0) = t5;
  hessian(0,1) = t7+t8*b02;
  hessian(0,2) = 0.0;
  hessian(0,3) = t14;
  hessian(0,4) = t15+t16*b02;
  hessian(0,5) = 0.0;
  hessian(0,6) = t25;
  hessian(0,7) = t26*b00+t28*b01+t33;
  hessian(0,8) = 0.0;
  hessian(1,0) = t7+t26*b02;
  hessian(1,1) = t23*b00+t40*b02;
  hessian(1,2) = t44+t45*b02;
  hessian(1,3) = t15+t28*b02;
  hessian(1,4) = t23*b01+t53*b02;
  hessian(1,5) = t56+t57*b02;
  hessian(1,6) = t8*b00+t16*b01+t33;
  hessian(1,7) = t40*b00+t53*b01+t67*b02;
  hessian(1,8) = t70*b00+t72*b01+t77;
  hessian(2,0) = 0.0;
  hessian(2,1) = t44+t70*b02;
  hessian(2,2) = t5;
  hessian(2,3) = 0.0;
  hessian(2,4) = t56+t72*b02;
  hessian(2,5) = t14;
  hessian(2,6) = 0.0;
  hessian(2,7) = t45*b00+t57*b01+t77;
  hessian(2,8) = t25;
  hessian(3,0) = t88;
  hessian(3,1) = t89+t8*b12;
  hessian(3,2) = 0.0;
  hessian(3,3) = t94;
  hessian(3,4) = t95+t16*b12;
  hessian(3,5) = 0.0;
  hessian(3,6) = t101;
  hessian(3,7) = t26*b10+t28*b11+t104;
  hessian(3,8) = 0.0;
  hessian(4,0) = t89+t26*b12;
  hessian(4,1) = t23*b10+t40*b12;
  hessian(4,2) = t111+t45*b12;
  hessian(4,3) = t95+t28*b12;
  hessian(4,4) = t23*b11+t53*b12;
  hessian(4,5) = t119+t57*b12;
  hessian(4,6) = t8*b10+t16*b11+t104;
  hessian(4,7) = t40*b10+t53*b11+t67*b12;
  hessian(4,8) = t70*b10+t72*b11+t131;
  hessian(5,0) = 0.0;
  hessian(5,1) = t111+t70*b12;
  hessian(5,2) = t88;
  hessian(5,3) = 0.0;
  hessian(5,4) = t119+t72*b12;
  hessian(5,5) = t94;
  hessian(5,6) = 0.0;
  hessian(5,7) = t45*b10+t57*b11+t131;
  hessian(5,8) = t101;
  hessian(6,0) = t142;
  hessian(6,1) = t143+t8*b22;
  hessian(6,2) = 0.0;
  hessian(6,3) = t148;
  hessian(6,4) = t149+t16*b22;
  hessian(6,5) = 0.0;
  hessian(6,6) = t155;
  hessian(6,7) = t26*b20+t28*b21+t158;
  hessian(6,8) = 0.0;
  hessian(7,0) = t143+t26*b22;
  hessian(7,1) = t23*b20+t40*b22;
  hessian(7,2) = t165+t45*b22;
  hessian(7,3) = t149+t28*b22;
  hessian(7,4) = t23*b21+t53*b22;
  hessian(7,5) = t173+t57*b22;
  hessian(7,6) = t8*b20+t16*b21+t158;
  hessian(7,7) = t40*b20+t53*b21+t67*b22;
  hessian(7,8) = t70*b20+t72*b21+t185;
  hessian(8,0) = 0.0;
  hessian(8,1) = t165+t70*b22;
  hessian(8,2) = t142;
  hessian(8,3) = 0.0;
  hessian(8,4) = t173+t72*b22;
  hessian(8,5) = t148;
  hessian(8,6) = 0.0;
  hessian(8,7) = t45*b20+t57*b21+t185;
  hessian(8,8) = t155;
  hessian(9,0) = t196;
  hessian(9,1) = t197+t8*b32;
  hessian(9,2) = 0.0;
  hessian(9,3) = t202;
  hessian(9,4) = t203+t16*b32;
  hessian(9,5) = 0.0;
  hessian(9,6) = t209;
  hessian(9,7) = t26*b30+t28*b31+t212;
  hessian(9,8) = 0.0;
  hessian(10,0) = t197+t26*b32;
  hessian(10,1) = t23*b30+t40*b32;
  hessian(10,2) = t219+t45*b32;
  hessian(10,3) = t203+t28*b32;
  hessian(10,4) = t23*b31+t53*b32;
  hessian(10,5) = t227+t57*b32;
  hessian(10,6) = t8*b30+t16*b31+t212;
  hessian(10,7) = t40*b30+t53*b31+t67*b32;
  hessian(10,8) = t70*b30+t72*b31+t239;
  hessian(11,0) = 0.0;
  hessian(11,1) = t219+t70*b32;
  hessian(11,2) = t196;
  hessian(11,3) = 0.0;
  hessian(11,4) = t227+t72*b32;
  hessian(11,5) = t202;
  hessian(11,6) = 0.0;
  hessian(11,7) = t45*b30+t57*b31+t239;
  hessian(11,8) = t209;
 
 
}

void STVK::hessian8(const Real* F, const VEC3F* b, MATRIX& hessian) {
  Real lam = _lambda;
  Real mu = _mu;
  const double b00 = b[0][0];
  const double b01 = b[0][1];
  const double b02 = b[0][2];
  const double b10 = b[1][0];
  const double b11 = b[1][1];
  const double b12 = b[1][2];
  const double b20 = b[2][0];
  const double b21 = b[2][1];
  const double b22 = b[2][2];
  const double b30 = b[3][0];
  const double b31 = b[3][1];
  const double b32 = b[3][2]; 

 
  Real t1 = lam*F[8];
  Real t3 = mu*F[2];
  Real t5 = t1*b00+t3*b02;
  Real t6 = mu*F[6];
  Real t7 = t6*b00;
  Real t8 = mu*F[0];
  Real t12 = mu*F[5];
  Real t14 = t1*b01+t12*b02;
  Real t15 = t6*b01;
  Real t16 = mu*F[3];
  Real t21 = mu*F[8];
  Real t23 = t1+2.0*t21;
  Real t25 = t3*b00+t12*b01+t23*b02;
  Real t26 = lam*F[0];
  Real t28 = lam*F[3];
  Real t32 = lam*F[6]+2.0*t6;
  Real t33 = t32*b02;
  Real t35 = mu*F[7];
  Real t36 = t35*b00;
  Real t37 = mu*F[1];
  Real t40 = t35*b01;
  Real t41 = mu*F[4];
  Real t44 = lam*F[1];
  Real t46 = lam*F[4];
  Real t50 = lam*F[7]+2.0*t35;
  Real t51 = t50*b02;
  Real t60 = lam*F[2]+2.0*t3;
  Real t70 = lam*F[5]+2.0*t12;
  Real t83 = 3.0*t1+6.0*t21;
  Real t88 = t1*b10+t3*b12;
  Real t89 = t6*b10;
  Real t94 = t1*b11+t12*b12;
  Real t95 = t6*b11;
  Real t101 = t3*b10+t12*b11+t23*b12;
  Real t104 = t32*b12;
  Real t106 = t35*b10;
  Real t109 = t35*b11;
  Real t114 = t50*b12;
  Real t142 = t1*b20+t3*b22;
  Real t143 = t6*b20;
  Real t148 = t1*b21+t12*b22;
  Real t149 = t6*b21;
  Real t155 = t3*b20+t12*b21+t23*b22;
  Real t158 = t32*b22;
  Real t160 = t35*b20;
  Real t163 = t35*b21;
  Real t168 = t50*b22;
  Real t196 = t1*b30+t3*b32;
  Real t197 = t6*b30;
  Real t202 = t1*b31+t12*b32;
  Real t203 = t6*b31;
  Real t209 = t3*b30+t12*b31+t23*b32;
  Real t212 = t32*b32;
  Real t214 = t35*b30;
  Real t217 = t35*b31;
  Real t222 = t50*b32;
  hessian(0,0) = t5;
  hessian(0,1) = 0.0;
  hessian(0,2) = t7+t8*b02;
  hessian(0,3) = t14;
  hessian(0,4) = 0.0;
  hessian(0,5) = t15+t16*b02;
  hessian(0,6) = t25;
  hessian(0,7) = 0.0;
  hessian(0,8) = t26*b00+t28*b01+t33;
  hessian(1,0) = 0.0;
  hessian(1,1) = t5;
  hessian(1,2) = t36+t37*b02;
  hessian(1,3) = 0.0;
  hessian(1,4) = t14;
  hessian(1,5) = t40+t41*b02;
  hessian(1,6) = 0.0;
  hessian(1,7) = t25;
  hessian(1,8) = t44*b00+t46*b01+t51;
  hessian(2,0) = t7+t26*b02;
  hessian(2,1) = t36+t44*b02;
  hessian(2,2) = t23*b00+t60*b02;
  hessian(2,3) = t15+t28*b02;
  hessian(2,4) = t40+t46*b02;
  hessian(2,5) = t23*b01+t70*b02;
  hessian(2,6) = t8*b00+t16*b01+t33;
  hessian(2,7) = t37*b00+t41*b01+t51;
  hessian(2,8) = t60*b00+t70*b01+t83*b02;
  hessian(3,0) = t88;
  hessian(3,1) = 0.0;
  hessian(3,2) = t89+t8*b12;
  hessian(3,3) = t94;
  hessian(3,4) = 0.0;
  hessian(3,5) = t95+t16*b12;
  hessian(3,6) = t101;
  hessian(3,7) = 0.0;
  hessian(3,8) = t26*b10+t28*b11+t104;
  hessian(4,0) = 0.0;
  hessian(4,1) = t88;
  hessian(4,2) = t106+t37*b12;
  hessian(4,3) = 0.0;
  hessian(4,4) = t94;
  hessian(4,5) = t109+t41*b12;
  hessian(4,6) = 0.0;
  hessian(4,7) = t101;
  hessian(4,8) = t44*b10+t46*b11+t114;
  hessian(5,0) = t89+t26*b12;
  hessian(5,1) = t106+t44*b12;
  hessian(5,2) = t23*b10+t60*b12;
  hessian(5,3) = t95+t28*b12;
  hessian(5,4) = t109+t46*b12;
  hessian(5,5) = t23*b11+t70*b12;
  hessian(5,6) = t8*b10+t16*b11+t104;
  hessian(5,7) = t37*b10+t41*b11+t114;
  hessian(5,8) = t60*b10+t70*b11+t83*b12;
  hessian(6,0) = t142;
  hessian(6,1) = 0.0;
  hessian(6,2) = t143+t8*b22;
  hessian(6,3) = t148;
  hessian(6,4) = 0.0;
  hessian(6,5) = t149+t16*b22;
  hessian(6,6) = t155;
  hessian(6,7) = 0.0;
  hessian(6,8) = t26*b20+t28*b21+t158;
  hessian(7,0) = 0.0;
  hessian(7,1) = t142;
  hessian(7,2) = t160+t37*b22;
  hessian(7,3) = 0.0;
  hessian(7,4) = t148;
  hessian(7,5) = t163+t41*b22;
  hessian(7,6) = 0.0;
  hessian(7,7) = t155;
  hessian(7,8) = t44*b20+t46*b21+t168;
  hessian(8,0) = t143+t26*b22;
  hessian(8,1) = t160+t44*b22;
  hessian(8,2) = t23*b20+t60*b22;
  hessian(8,3) = t149+t28*b22;
  hessian(8,4) = t163+t46*b22;
  hessian(8,5) = t23*b21+t70*b22;
  hessian(8,6) = t8*b20+t16*b21+t158;
  hessian(8,7) = t37*b20+t41*b21+t168;
  hessian(8,8) = t60*b20+t70*b21+t83*b22;
  hessian(9,0) = t196;
  hessian(9,1) = 0.0;
  hessian(9,2) = t197+t8*b32;
  hessian(9,3) = t202;
  hessian(9,4) = 0.0;
  hessian(9,5) = t203+t16*b32;
  hessian(9,6) = t209;
  hessian(9,7) = 0.0;
  hessian(9,8) = t26*b30+t28*b31+t212;
  hessian(10,0) = 0.0;
  hessian(10,1) = t196;
  hessian(10,2) = t214+t37*b32;
  hessian(10,3) = 0.0;
  hessian(10,4) = t202;
  hessian(10,5) = t217+t41*b32;
  hessian(10,6) = 0.0;
  hessian(10,7) = t209;
  hessian(10,8) = t44*b30+t46*b31+t222;
  hessian(11,0) = t197+t26*b32;
  hessian(11,1) = t214+t44*b32;
  hessian(11,2) = t23*b30+t60*b32;
  hessian(11,3) = t203+t28*b32;
  hessian(11,4) = t217+t46*b32;
  hessian(11,5) = t23*b31+t70*b32;
  hessian(11,6) = t8*b30+t16*b31+t212;
  hessian(11,7) = t37*b30+t41*b31+t222;
  hessian(11,8) = t60*b30+t70*b31+t83*b32;
 
 
}

